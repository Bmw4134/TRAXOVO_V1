{% extends 'base.html' %} {% block title %}Reports Dashboard{% endblock %} {%
block content %}
<div class="container mt-4">
  <h1 class="mb-4">Reports Dashboard</h1>
  <div class="row mb-5">
    <div class="col-md-12">
      <div class="card">
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <h4 class="mb-0">Daily Driver Reports</h4>
          <a
            href="{{ url_for('attendance_trends') }}"
            class="btn btn-sm btn-outline-light"
            ><i class="bi bi-graph-up"></i> View Trends
          </a>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">Prior Day Reports</h5>
                </div>
                <div class="card-body">
                  <p>
                    Generate late start, early end, and not on job reports for
                    the previous day.
                  </p>
                  <form
                    action="{{ url_for('generate_prior_day_report') }}"
                    method="post"
                  >
                    <div class="mb-3">
                      <label for="prior-date" class="form-label"
                        >Select Date</label
                      ><input
                        type="date"
                        class="form-control"
                        id="prior-date"
                        name="date"
                        value="{{ yesterday }}"
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Generate Report
                    </button>
                  </form>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">Current Day Reports</h5>
                </div>
                <div class="card-body">
                  <p>
                    Generate late start and not on job reports for the current
                    day.
                  </p>
                  <form
                    action="{{ url_for('generate_current_day_report') }}"
                    method="post"
                  >
                    <div class="mb-3">
                      <label for="current-date" class="form-label"
                        >Select Date</label
                      ><input
                        type="date"
                        class="form-control"
                        id="current-date"
                        name="date"
                        value="{{ today }}"
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Generate Report
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          {% if attendance_reports %}
          <div class="mt-4">
            <h5>Recent Reports</h5>
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Created At</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for report in attendance_reports %}
                  <tr>
                    <td>{{ report.date }}</td>
                    <td>{{ report.type }}</td>
                    <td>{{ report.created_at }}</td>
                    <td>
                      <a
                        href="{{ url_for('download_report', report_path=report.file_path) }}"
                        class="btn btn-sm btn-outline-primary"
                        ><i class="bi bi-download"></i> Download
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="row mb-5">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Billing Management</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">Regional Billing Exports</h5>
                </div>
                <div class="card-body">
                  <p>
                    Generate billing export files for each region (DFW, WTX,
                    HOU).
                  </p>
                  <form
                    action="{{ url_for('generate_regional_billing') }}"
                    method="post"
                  >
                    <div class="mb-3">
                      <label for="billing-month" class="form-label"
                        >Select Month</label
                      ><input
                        type="month"
                        class="form-control"
                        id="billing-month"
                        name="month"
                        value="{{ current_month }}"
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Generate Exports
                    </button>
                  </form>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">PM Allocation Review</h5>
                </div>
                <div class="card-body">
                  <p>
                    Review PM allocation changes and approve for master billing
                    update.
                  </p>
                  <form
                    action="{{ url_for('review_pm_allocations') }}"
                    method="post"
                  >
                    <div class="mb-3">
                      <label for="pm-month" class="form-label"
                        >Select Month</label
                      ><input
                        type="month"
                        class="form-control"
                        id="pm-month"
                        name="month"
                        value="{{ current_month }}"
                      />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Review Allocations
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          {% if billing_exports %}
          <div class="mt-4">
            <h5>Recent Exports</h5>
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Month</th>
                    <th>Region</th>
                    <th>Created At</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for export in billing_exports %}
                  <tr>
                    <td>{{ export.date }}</td>
                    <td>{{ export.region }}</td>
                    <td>{{ export.created_at }}</td>
                    <td>
                      <a
                        href="{{ url_for('download_export', export_path=export.file_path) }}"
                        class="btn btn-sm btn-outline-primary"
                        ><i class="bi bi-download"></i> Download
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Analytics</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">Equipment Utilization</h5>
                </div>
                <div class="card-body text-center">
                  <p>
                    Analyze equipment utilization rates and optimize asset
                    deployment.
                  </p>
                  <a
                    href="{{ url_for('equipment_utilization') }}"
                    class="btn btn-primary"
                    >View Report</a
                  >
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">Maintenance ROI</h5>
                </div>
                <div class="card-body text-center">
                  <p>Analyze maintenance costs and ROI for fleet equipment.</p>
                  <a
                    href="{{ url_for('maintenance_roi') }}"
                    class="btn btn-primary"
                    >View Report</a
                  >
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card mb-3">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">GPS Efficiency</h5>
                </div>
                <div class="card-body text-center">
                  <p>
                    Analyze work zone efficiency based on GPS tracking data.
                  </p>
                  <a
                    href="{{ url_for('gps_efficiency') }}"
                    class="btn btn-primary"
                    >View Report</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

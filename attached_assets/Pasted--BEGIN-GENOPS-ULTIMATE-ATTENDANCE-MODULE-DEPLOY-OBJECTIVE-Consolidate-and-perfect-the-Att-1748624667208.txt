‚ÄºÔ∏è BEGIN GENOPS ULTIMATE ATTENDANCE MODULE DEPLOY ‚ÄºÔ∏è

OBJECTIVE  
Consolidate and perfect the Attendance Module‚Äîno regressions, no placeholder data, only real Gauge+Groundworks inputs.

FILES TO TOUCH  
‚Ä¢ routes/attendance.py  
‚Ä¢ routes/job_zones.py  
‚Ä¢ templates/attendance_matrix_unified.html  

PRECHECK  
‚Ä¢ Supabase client (services/supabase_client.py) returns 200 on ‚Äúselect id‚Äù from attendance.  
‚Ä¢ APScheduler is configured and running.

STEPS  

1. DATA INGEST & MERGE  
   1.1 In attendance.py, implement `get_combined_attendance(period, start, end)`:  
       ‚Äì Fetch from Supabase `attendance` between start/end.  
       ‚Äì Fetch GPS pings from Gauge API same window.  
       ‚Äì If either fails, log to console but return an empty list.  
   1.2 Inline-check: call `get_combined_attendance("daily", today, today_end)` and assert it returns a list.

2. TIME-CARD UPLOAD HANDLER  
   2.1 At `/upload/groundworks` route, detect CSV/XLSX/PDF:  
       ‚Äì Use pandas/tabula to parse into DataFrame.  
       ‚Äì Upsert each row into Supabase `attendance`.  
       ‚Äì On parse error, flash a non-fatal error and continue.  
   2.2 After upload, call `get_combined_attendance("daily", today, today_end)` to warm cache.

3. JOB-ZONE & DUAL-SHIFT LOGIC  
   3.1 Add boolean `dual_shift` to job_zones model in routes/job_zones.py (and DB).  
   3.2 In `get_combined_attendance`, for each record:  
       ‚Äì Compute in-zone via geofence (haversine or PostGIS).  
       ‚Äì If dual_shift, allow morning or evening check-ins.  
       ‚Äì Assign symbol:  
         ‚úÖ On-Time  
         üïí Late Start  
         ‚è≥ Early End  
         ‚ùå No-Show  

4. TEMPLATE & UI  
   4.1 In attendance_matrix_unified.html:  
       ‚Äì Add Daily/Weekly/Monthly toggle UI.  
       ‚Äì Add Weekend checkbox.  
       ‚Äì Render combined data in a scrollable table with icons and columns: Date, Employee, Check-In, Check-Out, Status, In-Zone.  
       ‚Äì Add ‚ÄúUpload Timecard‚Äù button POSTing to `/upload/groundworks`.

5. EXPORT & SCHEDULE  
   5.1 Add Export buttons calling new endpoints:  
       ‚Äì `/attendance/export/csv?period=...`  
       ‚Äì `/attendance/export/pdf?period=...`  
       ‚Äì `/attendance/export/xlsx?period=...`  
   5.2 Confirm APScheduler invokes `/attendance/refresh?period=daily` at 08:00 and 10:00.

SANITY GUARDS  
‚Ä¢ After each major change, GET `/attendance-matrix?period=daily` must return 200.  
‚Ä¢ Exports must download valid files.  
‚Ä¢ Upload errors logged but don‚Äôt crash the app.  
‚Ä¢ If any test fails, **do not** proceed‚Äîrollback to last checkpoint.

SUCCESS CRITERION  
When Daily/Weekly/Monthly toggles work, uploads parse, exports download, and icons + geofence logic display correctly, respond exactly:

‚úÖ ATTENDANCE MODULE DEPLOYED ‚Äî ALL CHECKS PASS

‚ÄºÔ∏è END GENOPS ULTIMATE ATTENDANCE MODULE DEPLOY ‚ÄºÔ∏è

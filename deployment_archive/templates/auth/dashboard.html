<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TRAXOVO - User Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    {% include 'components/unified_dark_theme.html' %}
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <strong>TRAXOVO</strong> Fleet Intelligence Platform
        </a>
        <div class="navbar-nav ms-auto">
          <div class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
            >
              <i class="fas fa-user me-2"></i>{{ user.get_display_name() }}
              <span
                class="badge bg-{{ 'primary' if user.role == 'admin' else 'secondary' }} ms-2"
                >{{ user.role.title() }}</span
              >
            </a>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="/auth/profile"
                  ><i class="fas fa-user-edit me-2"></i>Profile</a
                >
              </li>
              {% if user.has_admin_access() %}
              <li>
                <a class="dropdown-item" href="/auth/admin"
                  ><i class="fas fa-users-cog me-2"></i>Admin Panel</a
                >
              </li>
              {% endif %}
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item" href="/auth/logout"
                  ><i class="fas fa-sign-out-alt me-2"></i>Logout</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <div class="row">
        <div class="col-12">
          <h2 class="text-primary mb-4">
            Welcome back, {{ user.first_name }}!
            <small class="text-muted">{{ user.department }} Department</small>
          </h2>
        </div>
      </div>

      <!-- Quick Access Modules Based on Role -->
      <div class="row">
        {% if can_user_access_module('executive_dashboard') or user.role ==
        'admin' %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body text-center">
              <i
                class="fas fa-chart-line text-primary mb-3"
                style="font-size: 3rem"
              ></i>
              <h5 class="card-title">Executive Dashboard</h5>
              <p class="card-text">Comprehensive analytics and KPI suite</p>
              <a href="/executive-dashboard" class="btn btn-primary"
                >Access Dashboard</a
              >
            </div>
          </div>
        </div>
        {% endif %} {% if can_user_access_module('fleet_map') or
        can_user_access_module('fleet_map_view') or user.role == 'admin' %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body text-center">
              <i
                class="fas fa-map text-success mb-3"
                style="font-size: 3rem"
              ></i>
              <h5 class="card-title">Fleet Map</h5>
              <p class="card-text">Real-time asset tracking and locations</p>
              <a href="/fleet-map" class="btn btn-success">View Fleet Map</a>
            </div>
          </div>
        </div>
        {% endif %} {% if can_user_access_module('billing') or
        can_user_access_module('billing_view') or user.role == 'admin' %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body text-center">
              <i
                class="fas fa-dollar-sign text-warning mb-3"
                style="font-size: 3rem"
              ></i>
              <h5 class="card-title">Billing Analytics</h5>
              <p class="card-text">
                Revenue analysis and billing consolidation
              </p>
              <a href="/billing-consolidation" class="btn btn-warning"
                >View Billing</a
              >
            </div>
          </div>
        </div>
        {% endif %} {% if can_user_access_module('job_zones') or
        can_user_access_module('job_zones_view') or user.role == 'admin' %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body text-center">
              <i
                class="fas fa-map-marked-alt text-info mb-3"
                style="font-size: 3rem"
              ></i>
              <h5 class="card-title">Job Zones</h5>
              <p class="card-text">
                Project site management and asset assignment
              </p>
              <a href="/auth/job-zones" class="btn btn-info">Manage Zones</a>
            </div>
          </div>
        </div>
        {% endif %} {% if can_user_access_module('attendance') or user.role ==
        'admin' %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body text-center">
              <i
                class="fas fa-users text-secondary mb-3"
                style="font-size: 3rem"
              ></i>
              <h5 class="card-title">Attendance System</h5>
              <p class="card-text">Driver attendance and time tracking</p>
              <a href="/attendance-complete" class="btn btn-secondary"
                >View Attendance</a
              >
            </div>
          </div>
        </div>
        {% endif %} {% if can_user_access_module('analytics') or
        can_user_access_module('analytics_view') or user.role == 'admin' %}
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body text-center">
              <i
                class="fas fa-chart-bar text-danger mb-3"
                style="font-size: 3rem"
              ></i>
              <h5 class="card-title">Analytics Dashboard</h5>
              <p class="card-text">Advanced analytics and reporting</p>
              <a href="/analytics-dashboard" class="btn btn-danger"
                >View Analytics</a
              >
            </div>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- AI Assistant for All Users -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-robot me-2"></i>TRAXOVO AI Assistant
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-8">
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      id="aiQuery"
                      placeholder="Ask about fleet performance, asset utilization, or any business question..."
                    />
                    <button class="btn btn-primary" onclick="submitAIQuery()">
                      <i class="fas fa-paper-plane"></i>
                    </button>
                  </div>
                </div>
                <div class="col-md-4 text-end">
                  <span class="badge bg-success">AI Online</span>
                  <small class="text-muted ms-2">Powered by GPT-4</small>
                </div>
              </div>
              <div id="aiResponse" class="mt-3" style="display: none">
                <div class="alert alert-info">
                  <div id="aiResponseText"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Role-specific Information -->
      {% if user.role == 'viewer' %}
      <div class="row mt-4">
        <div class="col-12">
          <div class="alert alert-warning">
            <i class="fas fa-eye me-2"></i>
            <strong>View-Only Access:</strong> You have read-only permissions.
            Contact your administrator to request additional access.
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function submitAIQuery() {
        const query = document.getElementById("aiQuery").value;
        if (!query.trim()) return;

        const responseDiv = document.getElementById("aiResponse");
        const responseText = document.getElementById("aiResponseText");

        responseDiv.style.display = "block";
        responseText.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Processing your request...';

        // Simulate AI response (in production, this would call your AI API)
        setTimeout(() => {
          responseText.innerHTML = `
                    <strong>AI Analysis:</strong><br>
                    Based on your current role (${user.role}) and available data, here's what I found:<br><br>
                    • Fleet utilization is currently at 87% efficiency<br>
                    • 12 assets are active across 5 job sites<br>
                    • Revenue trending upward by 15% this quarter<br>
                    • Recommended action: Monitor asset allocation for optimal performance
                `;
        }, 2000);
      }

      // Allow Enter key to submit AI query
      document
        .getElementById("aiQuery")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            submitAIQuery();
          }
        });
    </script>
  </body>
</html>

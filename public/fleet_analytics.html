<!DOCTYPE html>
<html>
<head>
    <title>Fleet Analytics - TRAXOVO</title>
    <style>
        body { margin: 0; background: #0a0a0a; color: white; font-family: Arial; padding: 20px; }
        .analytics-container { max-width: 1200px; margin: 0 auto; }
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .metric-card { background: #1a1a2e; border: 1px solid #00ff88; border-radius: 10px; padding: 20px; }
        .metric-title { color: #00ff88; font-size: 16px; margin-bottom: 10px; }
        .metric-value { font-size: 24px; font-weight: bold; color: white; }
        .metric-change { font-size: 14px; margin-top: 5px; }
        .positive { color: #00ff00; }
        .negative { color: #ff4444; }
        .chart-container { background: #1a1a2e; border: 1px solid #00ff88; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .back-btn { background: #333; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; }
        .refresh-btn { background: #00ff88; color: black; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        .utilization-bar { width: 100%; height: 20px; background: #333; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .utilization-fill { height: 100%; background: linear-gradient(90deg, #00ff88, #00ccff); transition: width 0.5s; }
    </style>
</head>
<body>
    <div class="analytics-container">
        <button class="back-btn" onclick="window.location.href='/'">‚Üê Back to Dashboard</button>
        <h1>Fleet Analytics Dashboard</h1>
        <p>Real-time fleet performance metrics and operational insights</p>
        
        <button class="refresh-btn" onclick="loadAnalytics()">Refresh Data</button>
        
        <div class="analytics-grid" id="metricsGrid">
            <!-- Metrics will be loaded here -->
        </div>
        
        <div class="chart-container">
            <h2>Fleet Utilization Overview</h2>
            <div id="utilizationChart">
                <!-- Utilization data will be loaded here -->
            </div>
        </div>
        
        <div class="chart-container">
            <h2>Maintenance Predictions</h2>
            <div id="maintenanceChart">
                <!-- Maintenance data will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        async function loadAnalytics() {
            try {
                const response = await fetch('/api/fleet/analytics');
                const data = await response.json();
                
                renderMetrics(data);
                renderUtilizationChart(data);
                renderMaintenanceChart(data);
                
            } catch (error) {
                console.error('Failed to load analytics:', error);
            }
        }
        
        function renderMetrics(data) {
            const metricsGrid = document.getElementById('metricsGrid');
            
            const metrics = [
                {
                    title: 'Total Assets',
                    value: data.total_assets,
                    change: '+2 this month',
                    positive: true
                },
                {
                    title: 'Active Assets',
                    value: data.active_assets,
                    change: data.utilization_rate + ' utilization',
                    positive: true
                },
                {
                    title: 'Efficiency Score',
                    value: data.efficiency_score + '%',
                    change: data.productivity_trend,
                    positive: true
                },
                {
                    title: 'Cost Savings YTD',
                    value: data.cost_savings_ytd,
                    change: 'Fuel optimization: ' + data.fuel_optimization,
                    positive: true
                },
                {
                    title: 'Maintenance Assets',
                    value: data.maintenance_assets,
                    change: 'Scheduled maintenance',
                    positive: false
                },
                {
                    title: 'System Status',
                    value: data.system_status.toUpperCase(),
                    change: 'Last sync: ' + data.last_sync,
                    positive: true
                }
            ];
            
            metricsGrid.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-title">${metric.title}</div>
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-change ${metric.positive ? 'positive' : 'negative'}">
                        ${metric.change}
                    </div>
                </div>
            `).join('');
        }
        
        function renderUtilizationChart(data) {
            const utilizationChart = document.getElementById('utilizationChart');
            const utilizationPercent = parseFloat(data.utilization_rate);
            
            utilizationChart.innerHTML = `
                <div style="margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Fleet Utilization</span>
                        <span>${data.utilization_rate}</span>
                    </div>
                    <div class="utilization-bar">
                        <div class="utilization-fill" style="width: ${utilizationPercent}%"></div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <strong>Active:</strong> ${data.active_assets}<br>
                        <div class="utilization-bar" style="height: 10px;">
                            <div class="utilization-fill" style="width: ${(data.active_assets / data.total_assets) * 100}%; background: #00ff88;"></div>
                        </div>
                    </div>
                    <div>
                        <strong>Maintenance:</strong> ${data.maintenance_assets}<br>
                        <div class="utilization-bar" style="height: 10px;">
                            <div class="utilization-fill" style="width: ${(data.maintenance_assets / data.total_assets) * 100}%; background: #ff6b35;"></div>
                        </div>
                    </div>
                    <div>
                        <strong>Idle:</strong> ${data.idle_assets}<br>
                        <div class="utilization-bar" style="height: 10px;">
                            <div class="utilization-fill" style="width: ${(data.idle_assets / data.total_assets) * 100}%; background: #666;"></div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderMaintenanceChart(data) {
            const maintenanceChart = document.getElementById('maintenanceChart');
            
            if (data.maintenance_predictions) {
                maintenanceChart.innerHTML = `
                    <div style="margin: 20px 0;">
                        ${data.maintenance_predictions.map(item => `
                            <div style="background: #2a2a4e; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid ${item.priority === 'high' ? '#ff4444' : item.priority === 'medium' ? '#ffaa00' : '#00ff88'};">
                                <strong>${item.asset}</strong><br>
                                <span style="color: #ccc;">Maintenance due in ${item.days_until_service} days</span><br>
                                <span style="color: ${item.priority === 'high' ? '#ff4444' : item.priority === 'medium' ? '#ffaa00' : '#00ff88'};">Priority: ${item.priority.toUpperCase()}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                maintenanceChart.innerHTML = '<p>No maintenance predictions available</p>';
            }
        }
        
        // Load analytics on page load
        loadAnalytics();
        
        // Auto-refresh every 60 seconds
        setInterval(loadAnalytics, 60000);
    </script>
</body>
</html>
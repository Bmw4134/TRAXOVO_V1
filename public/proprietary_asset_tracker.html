<!DOCTYPE html>
<html>
<head>
    <title>Proprietary Asset Tracker - TRAXOVO</title>
    <style>
        body { margin: 0; background: #0a0a0a; color: white; font-family: Arial; overflow: hidden; }
        .tracker-container { width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        .tracker-header { background: linear-gradient(135deg, #1a1a2e 0%, #2a1a4e 100%); padding: 15px; border-bottom: 3px solid #00ff88; }
        .tracker-main { flex: 1; display: flex; }
        .map-container { flex: 1; position: relative; overflow: hidden; }
        .control-sidebar { width: 350px; background: #1a1a2e; border-left: 2px solid #00ff88; padding: 20px; overflow-y: auto; }
        .back-btn { background: #333; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; }
        .title-text { color: #00ff88; font-size: 24px; font-weight: bold; margin: 0; }
        .subtitle-text { color: #4ecdc4; font-size: 14px; margin: 5px 0 0 0; }
        .analytics-section { background: #2a2a4e; border: 1px solid #00ff88; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .section-title { color: #00ff88; font-size: 16px; font-weight: bold; margin-bottom: 10px; }
        .metric-row { display: flex; justify-content: space-between; margin: 8px 0; padding: 5px 0; border-bottom: 1px solid #333; }
        .metric-label { color: #ccc; font-size: 12px; }
        .metric-value { color: #00ff88; font-size: 12px; font-weight: bold; }
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; }
        .status-active { background: #00ff00; }
        .status-maintenance { background: #ff4444; }
        .status-idle { background: #ffaa00; }
        .control-btn { background: #00ff88; color: black; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 12px; font-weight: bold; }
        .control-btn:hover { background: #00ccff; }
        .control-btn.secondary { background: #4ecdc4; }
        .control-btn.warning { background: #ff6b35; }
        .telemetry-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0; }
        .telemetry-item { background: #1a1a2e; padding: 8px; border-radius: 5px; border-left: 3px solid #00ff88; }
        .telemetry-label { font-size: 10px; color: #ccc; }
        .telemetry-value { font-size: 12px; color: #00ff88; font-weight: bold; }
        .asset-list { max-height: 200px; overflow-y: auto; }
        .asset-item { background: #1a1a2e; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #00ff88; cursor: pointer; }
        .asset-item:hover { background: #2a2a4e; }
        .asset-name { font-size: 12px; font-weight: bold; color: #00ff88; }
        .asset-details { font-size: 10px; color: #ccc; margin-top: 3px; }
        .prediction-urgent { border-left-color: #ff4444; }
        .prediction-medium { border-left-color: #ffaa00; }
        .prediction-low { border-left-color: #00ff88; }
        #mapDisplay { width: 100%; height: 100%; }
        .loading-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; color: #00ff88; font-size: 18px; }
    </style>
</head>
<body>
    <div class="tracker-container">
        <div class="tracker-header">
            <button class="back-btn" onclick="window.location.href='/'">‚Üê Dashboard</button>
            <h1 class="title-text">Bleeding-Edge Proprietary Asset Tracker</h1>
            <p class="subtitle-text">Ultra-high precision real-time telemetry with predictive analytics</p>
        </div>
        
        <div class="tracker-main">
            <div class="map-container">
                <div id="mapDisplay"></div>
                <div id="loadingOverlay" class="loading-overlay">
                    Loading proprietary asset tracking system...
                </div>
            </div>
            
            <div class="control-sidebar">
                <div class="analytics-section">
                    <div class="section-title">System Status</div>
                    <div class="metric-row">
                        <span class="metric-label">Tracking Precision:</span>
                        <span class="metric-value" id="trackingPrecision">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Telemetry Frequency:</span>
                        <span class="metric-value" id="telemetryFreq">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Predictive Accuracy:</span>
                        <span class="metric-value" id="predictiveAccuracy">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">System Efficiency:</span>
                        <span class="metric-value" id="systemEfficiency">--</span>
                    </div>
                </div>
                
                <div class="analytics-section">
                    <div class="section-title">Fleet Analytics</div>
                    <div class="telemetry-grid" id="fleetMetrics">
                        <!-- Fleet metrics will be populated here -->
                    </div>
                </div>
                
                <div class="analytics-section">
                    <div class="section-title">Control Center</div>
                    <button class="control-btn" onclick="refreshTracker()">üîÑ Refresh</button>
                    <button class="control-btn secondary" onclick="toggleTelemetry()">üì° Telemetry</button>
                    <button class="control-btn warning" onclick="runPredictiveAnalysis()">üîÆ Analyze</button>
                    <button class="control-btn" onclick="optimizeFleet()">‚ö° Optimize</button>
                </div>
                
                <div class="analytics-section">
                    <div class="section-title">Asset Status</div>
                    <div id="assetList" class="asset-list">
                        <!-- Asset list will be populated here -->
                    </div>
                </div>
                
                <div class="analytics-section">
                    <div class="section-title">Maintenance Predictions</div>
                    <div id="maintenancePredictions">
                        <!-- Maintenance predictions will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let telemetryActive = true;
        let currentData = null;
        
        async function loadProprietaryTracker() {
            try {
                document.getElementById('loadingOverlay').style.display = 'flex';
                
                const response = await fetch('/api/fleet/proprietary_tracker');
                const data = await response.json();
                
                currentData = data;
                
                // Display the map
                document.getElementById('mapDisplay').innerHTML = data.map_svg;
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Update analytics
                updateAnalytics(data.analytics);
                
                // Add interactive features to asset markers
                addAssetInteractivity();
                
            } catch (error) {
                document.getElementById('loadingOverlay').innerHTML = 
                    '<div style="color: #ff4444;">Error loading proprietary tracker: ' + error.message + '</div>';
            }
        }
        
        function updateAnalytics(analytics) {
            // System status
            document.getElementById('trackingPrecision').textContent = analytics.tracking_precision;
            document.getElementById('telemetryFreq').textContent = analytics.telemetry_frequency;
            document.getElementById('predictiveAccuracy').textContent = analytics.predictive_accuracy;
            document.getElementById('systemEfficiency').textContent = analytics.system_efficiency.toFixed(1) + '%';
            
            // Fleet metrics
            const metricsGrid = document.getElementById('fleetMetrics');
            metricsGrid.innerHTML = `
                <div class="telemetry-item">
                    <div class="telemetry-label">Active Assets</div>
                    <div class="telemetry-value">${analytics.active_assets}/${analytics.total_assets}</div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">Avg Speed</div>
                    <div class="telemetry-value">${analytics.performance_metrics.avg_speed.toFixed(1)} mph</div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">Avg Fuel</div>
                    <div class="telemetry-value">${analytics.performance_metrics.avg_fuel_level.toFixed(1)}%</div>
                </div>
                <div class="telemetry-item">
                    <div class="telemetry-label">Engine Hours</div>
                    <div class="telemetry-value">${analytics.performance_metrics.total_engine_hours.toFixed(1)}</div>
                </div>
            `;
            
            // Maintenance predictions
            const predictionsDiv = document.getElementById('maintenancePredictions');
            if (analytics.maintenance_predictions.length > 0) {
                predictionsDiv.innerHTML = analytics.maintenance_predictions.map(pred => `
                    <div class="asset-item prediction-${pred.prediction.urgency}">
                        <div class="asset-name">${pred.asset_id}</div>
                        <div class="asset-details">
                            ${pred.prediction.days_remaining} days | ${pred.prediction.urgency.toUpperCase()} priority
                            <br>Confidence: ${pred.confidence}%
                        </div>
                    </div>
                `).join('');
            } else {
                predictionsDiv.innerHTML = '<div style="color: #ccc; font-size: 12px;">No urgent maintenance required</div>';
            }
        }
        
        function addAssetInteractivity() {
            // Add hover effects for asset markers
            document.querySelectorAll('.asset-marker').forEach(marker => {
                marker.addEventListener('mouseenter', function() {
                    const popup = this.querySelector('.telemetry-popup');
                    if (popup) {
                        popup.style.opacity = '1';
                    }
                });
                
                marker.addEventListener('mouseleave', function() {
                    const popup = this.querySelector('.telemetry-popup');
                    if (popup) {
                        popup.style.opacity = '0';
                    }
                });
                
                marker.addEventListener('click', function() {
                    const assetId = this.id.replace('asset_', '');
                    showAssetDetails(assetId);
                });
            });
        }
        
        function showAssetDetails(assetId) {
            alert(`Detailed telemetry for ${assetId} would open in a modal window`);
        }
        
        function refreshTracker() {
            loadProprietaryTracker();
        }
        
        function toggleTelemetry() {
            telemetryActive = !telemetryActive;
            const btn = event.target;
            
            if (telemetryActive) {
                btn.textContent = 'üì° Telemetry ON';
                btn.style.background = '#00ff88';
                // Start real-time updates
                startRealTimeUpdates();
            } else {
                btn.textContent = 'üì° Telemetry OFF';
                btn.style.background = '#666';
                // Stop real-time updates
                stopRealTimeUpdates();
            }
        }
        
        function runPredictiveAnalysis() {
            if (!currentData) return;
            
            const btn = event.target;
            btn.textContent = 'üîÆ Analyzing...';
            btn.disabled = true;
            
            setTimeout(() => {
                alert('Predictive analysis complete:\\n\\n' +
                      '‚Ä¢ 3 assets require maintenance within 14 days\\n' +
                      '‚Ä¢ Fleet efficiency can be improved by 12%\\n' +
                      '‚Ä¢ Fuel optimization potential: $2,400/month\\n' +
                      '‚Ä¢ Recommended route adjustments identified');
                
                btn.textContent = 'üîÆ Analyze';
                btn.disabled = false;
            }, 2000);
        }
        
        function optimizeFleet() {
            const btn = event.target;
            btn.textContent = '‚ö° Optimizing...';
            btn.disabled = true;
            
            setTimeout(() => {
                alert('Fleet optimization recommendations:\\n\\n' +
                      '‚Ä¢ Redistribute 2 assets to high-activity zones\\n' +
                      '‚Ä¢ Schedule maintenance for CAT-349F-001\\n' +
                      '‚Ä¢ Adjust fuel delivery routes\\n' +
                      '‚Ä¢ Update operator schedules for peak efficiency');
                
                btn.textContent = '‚ö° Optimize';
                btn.disabled = false;
            }, 3000);
        }
        
        let updateInterval;
        
        function startRealTimeUpdates() {
            updateInterval = setInterval(() => {
                if (telemetryActive) {
                    // Simulate real-time telemetry updates
                    updateTelemetryIndicators();
                }
            }, 5000); // 5-second updates
        }
        
        function stopRealTimeUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        }
        
        function updateTelemetryIndicators() {
            // Update signal strength indicators
            document.querySelectorAll('.telemetry-indicators circle').forEach(indicator => {
                const opacity = Math.random() * 0.5 + 0.5;
                indicator.style.opacity = opacity;
            });
            
            // Update timestamp
            const now = new Date();
            document.querySelectorAll('.telemetry-popup text').forEach(text => {
                if (text.textContent.includes('Last Update:')) {
                    text.textContent = `Last Update: ${now.toLocaleTimeString()}`;
                }
            });
        }
        
        // Initialize
        loadProprietaryTracker();
        startRealTimeUpdates();
        
        // Auto-refresh every 30 seconds
        setInterval(refreshTracker, 30000);
    </script>
</body>
</html>
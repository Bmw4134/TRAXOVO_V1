
{% extends "base.html" %}

{% block title %}ASI Enhanced Debugger - TRAXOVO{% endblock %}

{% block extra_css %}
<style>
.asi-debug-header {
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
    color: #00ff88;
    padding: 2rem;
    border-radius: 15px;
    margin-bottom: 2rem;
    text-align: center;
    box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
}

.debug-metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.metric-card {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border: 1px solid #00ff88;
    border-radius: 12px;
    padding: 1.5rem;
    color: white;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 255, 136, 0.4);
}

.metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #00ff88, #00bcd4, #ff6b6b);
    animation: asi-flow 3s infinite;
}

@keyframes asi-flow {
    0%, 100% { transform: translateX(-100%); }
    50% { transform: translateX(100%); }
}

.metric-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #00ff88;
    margin-bottom: 0.5rem;
    text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
}

.metric-label {
    font-size: 0.9rem;
    opacity: 0.8;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.health-score {
    font-size: 3rem;
    font-weight: 900;
    background: linear-gradient(45deg, #00ff88, #00bcd4);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: pulse-glow 2s infinite;
}

@keyframes pulse-glow {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.3); }
}

.debug-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
}

.debug-action-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.debug-action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.debug-action-btn.critical {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
}

.debug-action-btn.asi-enhanced {
    background: linear-gradient(135deg, #00ff88 0%, #00bcd4 100%);
    color: #000;
    font-weight: 700;
}

.recursive-visualization {
    background: #0a0a0a;
    border: 1px solid #00ff88;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 2rem 0;
    max-height: 400px;
    overflow-y: auto;
}

.recursion-level {
    margin-left: 20px;
    padding: 0.5rem;
    border-left: 2px solid #00ff88;
    margin-bottom: 0.5rem;
    opacity: 0.9;
}

.recursion-level-0 { color: #00ff88; }
.recursion-level-1 { color: #00bcd4; }
.recursion-level-2 { color: #ff6b6b; }
.recursion-level-3 { color: #ffa500; }
.recursion-level-4 { color: #9c27b0; }

.error-patterns {
    background: #1a1a2e;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 2rem 0;
}

.error-pattern-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    color: white;
}

.performance-chart {
    background: #1a1a2e;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 2rem 0;
    height: 300px;
    position: relative;
}

.debug-session-list {
    background: #1a1a2e;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 2rem 0;
}

.session-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 8px;
    margin-bottom: 1rem;
    background: rgba(0, 255, 136, 0.05);
}

.session-status {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.session-active { background: #00ff88; color: #000; }
.session-completed { background: #00bcd4; color: #000; }
.session-error { background: #ff6b6b; color: white; }

.asi-enhancement-indicator {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(45deg, #00ff88, #00bcd4);
    color: #000;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: 700;
    z-index: 1000;
    animation: asi-pulse 2s infinite;
}

@keyframes asi-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.trillion-power-meter {
    width: 100%;
    height: 20px;
    background: #1a1a2e;
    border-radius: 10px;
    overflow: hidden;
    margin: 1rem 0;
    position: relative;
}

.trillion-power-fill {
    height: 100%;
    background: linear-gradient(90deg, #00ff88, #00bcd4, #ff6b6b);
    border-radius: 10px;
    transition: width 0.5s ease;
    animation: power-flow 2s infinite;
}

@keyframes power-flow {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.3); }
}

.debug-log-viewer {
    background: #000;
    color: #00ff88;
    padding: 1rem;
    border-radius: 10px;
    font-family: 'Courier New', monospace;
    max-height: 300px;
    overflow-y: auto;
    font-size: 0.9rem;
    line-height: 1.4;
}

.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(0, 255, 136, 0.3);
    border-radius: 50%;
    border-top-color: #00ff88;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block content %}
<div class="asi-enhancement-indicator">
    ASI TRILLION-POWER ACTIVE
</div>

<div class="asi-debug-header">
    <h1>
        <i class="fas fa-brain"></i> ASI Enhanced Debugger
    </h1>
    <p>Artificial Super Intelligence Logic Train with Recursive Trillion-Power Analysis</p>
    <div class="trillion-power-meter">
        <div class="trillion-power-fill" style="width: {{ dashboard_data.asi_recursion_status.utilization_percent }}%"></div>
    </div>
    <small>Recursion Utilization: {{ "%.1f" | format(dashboard_data.asi_recursion_status.utilization_percent) }}%</small>
</div>

<!-- System Health Metrics -->
<div class="debug-metrics-grid">
    <div class="metric-card">
        <div class="metric-value health-score">{{ "%.0f" | format(dashboard_data.system_health_score) }}</div>
        <div class="metric-label">System Health Score</div>
        <small>Real-time health monitoring</small>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ dashboard_data.active_sessions }}</div>
        <div class="metric-label">Active Debug Sessions</div>
        <small>ASI-enhanced sessions</small>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ "%.1f" | format(dashboard_data.performance_summary.memory_usage) }}%</div>
        <div class="metric-label">Memory Usage</div>
        <small>Trillion-power optimized</small>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ "%.1f" | format(dashboard_data.performance_summary.cpu_usage) }}%</div>
        <div class="metric-label">CPU Usage</div>
        <small>Recursive processing load</small>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ dashboard_data.error_patterns|length }}</div>
        <div class="metric-label">Error Patterns</div>
        <small>Predictive analysis active</small>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ dashboard_data.asi_recursion_status.current_depth }}/{{ dashboard_data.asi_recursion_status.max_depth }}</div>
        <div class="metric-label">ASI Recursion Depth</div>
        <small>Trillion-power analysis</small>
    </div>
</div>

<!-- Debug Actions -->
<div class="debug-actions">
    <button class="debug-action-btn asi-enhanced" onclick="startComprehensiveDebug()">
        <i class="fas fa-rocket"></i> Start ASI Comprehensive Debug
    </button>
    
    <button class="debug-action-btn" onclick="runRecursiveAnalysis()">
        <i class="fas fa-infinity"></i> Recursive Module Analysis
    </button>
    
    <button class="debug-action-btn critical" onclick="applyAutomatedFixes()">
        <i class="fas fa-wrench"></i> Apply Automated Fixes
    </button>
    
    <button class="debug-action-btn" onclick="generateSystemReport()">
        <i class="fas fa-file-alt"></i> Generate System Report
    </button>
    
    <button class="debug-action-btn asi-enhanced" onclick="validateDeployment()">
        <i class="fas fa-deploy"></i> Validate Deployment
    </button>
    
    <button class="debug-action-btn" onclick="optimizePerformance()">
        <i class="fas fa-tachometer-alt"></i> Optimize Performance
    </button>
</div>

<!-- Error Patterns Analysis -->
<div class="error-patterns">
    <h4><i class="fas fa-exclamation-triangle"></i> Error Pattern Analysis</h4>
    {% if dashboard_data.error_patterns %}
        {% for pattern, count in dashboard_data.error_patterns.items() %}
        <div class="error-pattern-item">
            <span>{{ pattern.replace('_', ' ').title() }}</span>
            <span class="badge badge-warning">{{ count }}</span>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-success">No error patterns detected - System operating optimally</p>
    {% endif %}
</div>

<!-- Real-time Debug Log -->
<div class="debug-log-viewer" id="debugLog">
    <div>ASI Enhanced Debugger initialized...</div>
    <div>Trillion-power recursive analysis ready...</div>
    <div>System health monitoring active...</div>
    <div>Awaiting debug commands...</div>
</div>

<!-- Debug Results Container -->
<div id="debugResults" style="display: none;">
    <h4>Debug Results</h4>
    <div id="debugResultsContent"></div>
</div>

<!-- Session Management -->
<div class="debug-session-list">
    <h4><i class="fas fa-tasks"></i> Debug Sessions</h4>
    <div id="sessionList">
        <p class="text-muted">No active sessions. Start a comprehensive debug to begin.</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let currentSessionId = null;
let debugInterval = null;

// ASI Enhanced Debug Functions
function startComprehensiveDebug() {
    addLogEntry('🚀 Initiating ASI Comprehensive Debug Session...');
    
    fetch('/asi-debug/start-session', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({session_type: 'comprehensive'})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            currentSessionId = data.session_id;
            addLogEntry(`✅ Session started: ${data.session_id}`);
            
            // Run comprehensive debug
            setTimeout(() => runComprehensiveDebug(data.session_id), 1000);
        }
    })
    .catch(error => {
        addLogEntry(`❌ Error starting session: ${error}`);
    });
}

function runComprehensiveDebug(sessionId) {
    addLogEntry('🧠 Running ASI trillion-power analysis...');
    
    fetch(`/asi-debug/comprehensive-debug/${sessionId}`)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayDebugResults(data.results);
            addLogEntry('✅ Comprehensive debug completed');
        }
    })
    .catch(error => {
        addLogEntry(`❌ Debug error: ${error}`);
    });
}

function runRecursiveAnalysis() {
    addLogEntry('♾️ Starting recursive module analysis...');
    
    const targetModule = prompt('Enter module name for recursive analysis:', 'app') || 'app';
    
    fetch('/asi-debug/recursive-analysis', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({module: targetModule})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayRecursiveResults(data.analysis);
            addLogEntry(`✅ Recursive analysis completed for ${targetModule}`);
        }
    })
    .catch(error => {
        addLogEntry(`❌ Recursive analysis error: ${error}`);
    });
}

function applyAutomatedFixes() {
    if (!currentSessionId) {
        addLogEntry('⚠️ No active session. Start comprehensive debug first.');
        return;
    }
    
    addLogEntry('🔧 Applying automated ASI fixes...');
    
    fetch(`/asi-debug/apply-fixes/${currentSessionId}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayFixResults(data.fix_results);
            addLogEntry(`✅ Applied ${data.fix_results.fixes_applied.length} automated fixes`);
        }
    })
    .catch(error => {
        addLogEntry(`❌ Fix application error: ${error}`);
    });
}

function generateSystemReport() {
    addLogEntry('📊 Generating ASI system report...');
    
    // Collect current dashboard data
    fetch('/asi-debug/api/dashboard-data')
    .then(response => response.json())
    .then(data => {
        const report = generateReportHTML(data);
        showReportModal(report);
        addLogEntry('✅ System report generated');
    })
    .catch(error => {
        addLogEntry(`❌ Report generation error: ${error}`);
    });
}

function validateDeployment() {
    addLogEntry('🚀 Validating deployment readiness...');
    
    // Start a deployment validation session
    fetch('/asi-debug/start-session', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({session_type: 'deployment_validation'})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            return fetch(`/asi-debug/comprehensive-debug/${data.session_id}`);
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.results.deployment_readiness) {
            const readiness = data.results.deployment_readiness;
            addLogEntry(`📈 Deployment readiness score: ${readiness.readiness_score}/100`);
            
            if (readiness.readiness_score >= 80) {
                addLogEntry('✅ System ready for deployment!');
            } else {
                addLogEntry('⚠️ Deployment issues detected - review recommendations');
            }
            
            displayDeploymentResults(readiness);
        }
    })
    .catch(error => {
        addLogEntry(`❌ Deployment validation error: ${error}`);
    });
}

function optimizePerformance() {
    addLogEntry('⚡ Optimizing ASI performance...');
    
    // Trigger memory optimization
    fetch('/asi-debug/apply-fixes/performance', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            addLogEntry('✅ Performance optimization completed');
            updateDashboardMetrics();
        }
    })
    .catch(error => {
        addLogEntry(`❌ Performance optimization error: ${error}`);
    });
}

// Display Functions
function displayDebugResults(results) {
    const container = document.getElementById('debugResults');
    const content = document.getElementById('debugResultsContent');
    
    let html = '<div class="debug-results-grid">';
    
    // System Health
    if (results.system_health) {
        html += `
        <div class="result-card">
            <h5>System Health</h5>
            <p>Overall Score: <span class="health-score">${results.system_health.overall_score}/100</span></p>
            <p>Memory: ${results.system_health.memory_status.percent_used}% used</p>
            <p>Status: <span class="badge badge-${results.system_health.memory_status.status === 'healthy' ? 'success' : 'warning'}">${results.system_health.memory_status.status}</span></p>
        </div>`;
    }
    
    // Module Validation
    if (results.module_validation) {
        html += `
        <div class="result-card">
            <h5>Module Validation</h5>
            <p>Modules Tested: ${results.module_validation.modules_tested || 0}</p>
            <p>Passed: ${results.module_validation.modules_passed || 0}</p>
            <p>Failed: ${results.module_validation.modules_failed || 0}</p>
        </div>`;
    }
    
    // ASI Optimization
    if (results.asi_optimization) {
        html += `
        <div class="result-card asi-enhanced">
            <h5>ASI Optimization</h5>
            <p>Trillion Power Metrics: Active</p>
            <p>Recursive Depth: ${results.asi_optimization.trillion_power_metrics ? results.asi_optimization.trillion_power_metrics.recursive_depth_utilization : 0}%</p>
        </div>`;
    }
    
    html += '</div>';
    
    content.innerHTML = html;
    container.style.display = 'block';
}

function displayRecursiveResults(analysis) {
    const container = document.createElement('div');
    container.className = 'recursive-visualization';
    container.innerHTML = `
        <h5>Recursive Analysis: ${analysis.module}</h5>
        <div class="recursion-level recursion-level-${analysis.depth}">
            <strong>Depth ${analysis.depth}:</strong> ${analysis.module}
            <br><small>ASI Enhancements: ${analysis.asi_enhancements ? analysis.asi_enhancements.join(', ') : 'None'}</small>
        </div>
    `;
    
    if (analysis.recursive_insights) {
        analysis.recursive_insights.forEach((insight, index) => {
            container.innerHTML += `
                <div class="recursion-level recursion-level-${insight.depth}">
                    <strong>Depth ${insight.depth}:</strong> ${insight.module}
                    <br><small>Status: ${insight.status || 'analyzed'}</small>
                </div>
            `;
        });
    }
    
    document.getElementById('debugResults').appendChild(container);
    document.getElementById('debugResults').style.display = 'block';
}

function displayFixResults(fixResults) {
    const container = document.createElement('div');
    container.className = 'fix-results';
    container.innerHTML = `
        <h5>Automated Fixes Applied</h5>
        <p>Fixes Applied: ${fixResults.fixes_applied.length}</p>
        <p>Fixes Failed: ${fixResults.fixes_failed.length}</p>
    `;
    
    fixResults.fixes_applied.forEach(fix => {
        container.innerHTML += `
            <div class="fix-item success">
                <strong>${fix.type}:</strong> ${fix.description}
            </div>
        `;
    });
    
    document.getElementById('debugResults').appendChild(container);
}

function displayDeploymentResults(deployment) {
    const container = document.createElement('div');
    container.className = 'deployment-results';
    container.innerHTML = `
        <h5>Deployment Readiness</h5>
        <div class="readiness-score">
            <span class="score-value">${deployment.readiness_score}/100</span>
        </div>
        <p>Critical Blockers: ${deployment.critical_blockers.length}</p>
        <p>Warnings: ${deployment.warnings.length}</p>
    `;
    
    document.getElementById('debugResults').appendChild(container);
}

// Utility Functions
function addLogEntry(message) {
    const log = document.getElementById('debugLog');
    const timestamp = new Date().toLocaleTimeString();
    const entry = document.createElement('div');
    entry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}

function updateDashboardMetrics() {
    fetch('/asi-debug/api/dashboard-data')
    .then(response => response.json())
    .then(data => {
        // Update metric values
        document.querySelector('.health-score').textContent = Math.round(data.system_health_score);
        document.querySelector('.trillion-power-fill').style.width = `${data.asi_recursion_status.utilization_percent}%`;
        
        addLogEntry('📊 Dashboard metrics updated');
    })
    .catch(error => {
        addLogEntry(`❌ Metrics update error: ${error}`);
    });
}

function generateReportHTML(data) {
    return `
        <h4>ASI System Report</h4>
        <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
        <p><strong>Health Score:</strong> ${data.system_health_score}/100</p>
        <p><strong>Active Sessions:</strong> ${data.active_sessions}</p>
        <p><strong>Memory Usage:</strong> ${data.performance_summary.memory_usage.toFixed(1)}%</p>
        <p><strong>CPU Usage:</strong> ${data.performance_summary.cpu_usage.toFixed(1)}%</p>
        <p><strong>ASI Recursion:</strong> ${data.asi_recursion_status.current_depth}/${data.asi_recursion_status.max_depth}</p>
        <p><strong>Error Patterns:</strong> ${Object.keys(data.error_patterns).length}</p>
    `;
}

function showReportModal(content) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
        justify-content: center; align-items: center;
    `;
    
    modal.innerHTML = `
        <div style="background: #1a1a2e; padding: 2rem; border-radius: 10px; max-width: 600px; color: white;">
            ${content}
            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                    style="margin-top: 1rem; padding: 0.5rem 1rem; background: #00ff88; color: #000; border: none; border-radius: 5px;">
                Close
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// Auto-refresh dashboard data every 30 seconds
setInterval(updateDashboardMetrics, 30000);

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    addLogEntry('🚀 ASI Enhanced Debugger initialized');
    addLogEntry('💡 Ready for trillion-power recursive analysis');
});
</script>
{% endblock %}

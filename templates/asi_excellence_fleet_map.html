<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAXOVO ASI Excellence Fleet Map</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: radial-gradient(ellipse at center, #0a0a0a 0%, #1a1a2e 30%, #16213e 70%, #0a0a0a 100%);
            color: #00ff88;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ASI Excellence Header */
        .asi-header {
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 3px solid #00ff88;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(15px);
        }
        
        .asi-title {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #88ffaa, #aaffcc);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-flow 3s ease-in-out infinite;
        }
        
        @keyframes gradient-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .asi-metrics {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
        }
        
        .asi-metric {
            text-align: center;
            padding: 10px 15px;
            border: 2px solid #00ff88;
            border-radius: 10px;
            background: rgba(0, 255, 136, 0.1);
            min-width: 120px;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .metric-label {
            font-size: 0.8em;
            color: #88ffaa;
        }
        
        /* Quantum Intelligence Panel */
        .quantum-intelligence {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 100px);
        }
        
        .intelligence-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            overflow-y: auto;
        }
        
        .panel-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            text-align: center;
            color: #88ffaa;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 10px;
        }
        
        /* Asset Intelligence Cards */
        .asset-intelligence-card {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .asset-intelligence-card:hover {
            background: rgba(0, 255, 136, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
            transform: translateY(-2px);
        }
        
        .asset-id {
            font-size: 1.1em;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 8px;
        }
        
        .asset-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .status-active {
            background: #00ff88;
            color: #0a0a0a;
        }
        
        .status-idle {
            background: #ffaa00;
            color: #0a0a0a;
        }
        
        .status-maintenance {
            background: #ff4444;
            color: white;
        }
        
        .asset-location {
            font-size: 0.9em;
            color: #aaffcc;
            margin-bottom: 5px;
        }
        
        .asset-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .mini-metric {
            text-align: center;
            padding: 5px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }
        
        .mini-value {
            font-weight: bold;
            color: #00ff88;
        }
        
        .mini-label {
            font-size: 0.7em;
            color: #88ffaa;
        }
        
        /* Quantum Map Container */
        .quantum-map-container {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff88;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .map-header {
            background: rgba(0, 255, 136, 0.1);
            padding: 15px;
            border-bottom: 1px solid #00ff88;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .map-title {
            font-size: 1.2em;
            color: #88ffaa;
        }
        
        .map-controls {
            display: flex;
            gap: 10px;
        }
        
        .map-btn {
            background: linear-gradient(45deg, #00ff88, #88ffaa);
            color: #0a0a0a;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .map-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 255, 136, 0.4);
        }
        
        /* Quantum Map Canvas */
        .quantum-map {
            width: 100%;
            height: calc(100% - 60px);
            position: relative;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(136, 255, 170, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, #0a0a0a 0%, #1a1a2e 100%);
            overflow: hidden;
        }
        
        /* Fort Worth Geographic Grid */
        .geographic-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 136, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-pulse 4s ease-in-out infinite;
        }
        
        @keyframes grid-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* Asset Markers */
        .asset-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #00ff88, #88ffaa);
            border: 2px solid #00ff88;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
            animation: marker-pulse 2s ease-in-out infinite;
        }
        
        @keyframes marker-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .asset-marker:hover {
            transform: scale(1.5);
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.8);
            z-index: 100;
        }
        
        .asset-marker.idle {
            background: radial-gradient(circle, #ffaa00, #ffcc44);
            border-color: #ffaa00;
            box-shadow: 0 0 15px rgba(255, 170, 0, 0.6);
        }
        
        .asset-marker.maintenance {
            background: radial-gradient(circle, #ff4444, #ff6666);
            border-color: #ff4444;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.6);
        }
        
        /* Asset Connections */
        .asset-connection {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.6), rgba(0, 255, 136, 0.1));
            transform-origin: left center;
            animation: connection-flow 3s ease-in-out infinite;
        }
        
        @keyframes connection-flow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
        
        /* Asset Tooltip */
        .asset-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            color: #00ff88;
            font-size: 0.9em;
            min-width: 200px;
            pointer-events: none;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        .tooltip-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #88ffaa;
        }
        
        .tooltip-detail {
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }
        
        .tooltip-label {
            color: #aaffcc;
        }
        
        .tooltip-value {
            color: #00ff88;
            font-weight: bold;
        }
        
        /* Zone Overlays */
        .zone-overlay {
            position: absolute;
            border: 3px dashed rgba(0, 255, 136, 0.4);
            border-radius: 15px;
            background: rgba(0, 255, 136, 0.05);
            backdrop-filter: blur(2px);
            pointer-events: none;
        }
        
        .zone-label {
            position: absolute;
            top: 10px;
            left: 15px;
            color: #88ffaa;
            font-weight: bold;
            font-size: 0.9em;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
        }
        
        /* Navigation */
        .nav-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1100;
        }
        
        .nav-btn {
            background: linear-gradient(45deg, #00ff88, #88ffaa);
            color: #0a0a0a;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .quantum-intelligence {
                grid-template-columns: 250px 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .asi-title { font-size: 1.8em; }
            .asi-metrics { flex-direction: column; gap: 10px; }
            .quantum-intelligence {
                grid-template-columns: 1fr;
                grid-template-rows: 300px 1fr;
            }
            .intelligence-panel {
                max-height: 280px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="nav-buttons">
        <a href="{{ url_for('quantum_dashboard') }}" class="nav-btn">← Dashboard</a>
        <a href="{{ url_for('transcendent_vector_matrix') }}" class="nav-btn">Vector Matrix</a>
    </div>

    <!-- ASI Excellence Header -->
    <div class="asi-header">
        <div class="asi-title">ASI EXCELLENCE FLEET MAP</div>
        <div class="asi-metrics">
            <div class="asi-metric">
                <div class="metric-value" id="totalAssets">{{ total_assets }}</div>
                <div class="metric-label">Total Assets</div>
            </div>
            <div class="asi-metric">
                <div class="metric-value" id="activeAssets">{{ active_assets }}</div>
                <div class="metric-label">Active Now</div>
            </div>
            <div class="asi-metric">
                <div class="metric-value" id="aiIntelligence">ACTIVE</div>
                <div class="metric-label">AI Intelligence</div>
            </div>
        </div>
    </div>

    <!-- Quantum Intelligence Interface -->
    <div class="quantum-intelligence">
        <!-- Asset Intelligence Panel -->
        <div class="intelligence-panel">
            <div class="panel-title">ASSET INTELLIGENCE</div>
            <div id="assetIntelligenceList">
                <!-- Asset cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Quantum Map -->
        <div class="quantum-map-container">
            <div class="map-header">
                <div class="map-title">Fort Worth Operations - Quantum Enhanced</div>
                <div class="map-controls">
                    <button class="map-btn" onclick="toggleZones()">Toggle Zones</button>
                    <button class="map-btn" onclick="refreshAssets()">Refresh</button>
                    <button class="map-btn" onclick="toggleConnections()">Connections</button>
                </div>
            </div>
            <div class="quantum-map" id="quantumMap">
                <div class="geographic-grid"></div>
                <!-- Asset markers and zones will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Asset Tooltip -->
    <div class="asset-tooltip" id="assetTooltip" style="display: none;">
        <div class="tooltip-title" id="tooltipTitle"></div>
        <div class="tooltip-detail">
            <span class="tooltip-label">Status:</span>
            <span class="tooltip-value" id="tooltipStatus"></span>
        </div>
        <div class="tooltip-detail">
            <span class="tooltip-label">Location:</span>
            <span class="tooltip-value" id="tooltipLocation"></span>
        </div>
        <div class="tooltip-detail">
            <span class="tooltip-label">Utilization:</span>
            <span class="tooltip-value" id="tooltipUtilization"></span>
        </div>
        <div class="tooltip-detail">
            <span class="tooltip-label">Fuel:</span>
            <span class="tooltip-value" id="tooltipFuel"></span>
        </div>
    </div>

    <script>
        let assetsData = [];
        let zonesVisible = true;
        let connectionsVisible = false;

        // Fort Worth operational zones
        const fortWorthZones = [
            { name: 'Trinity River Project', x: 15, y: 20, width: 200, height: 150 },
            { name: 'Downtown Construction', x: 250, y: 80, width: 180, height: 120 },
            { name: 'Alliance Equipment Depot', x: 480, y: 40, width: 160, height: 140 },
            { name: 'Fort Worth Main Yard', x: 350, y: 220, width: 140, height: 100 }
        ];

        // Initialize the quantum map
        function initializeQuantumMap() {
            fetchAssetData();
            createZoneOverlays();
            setInterval(refreshAssets, 10000); // Auto-refresh every 10 seconds
        }

        // Fetch asset data from API
        async function fetchAssetData() {
            try {
                const response = await fetch('/api/fort-worth-assets');
                const data = await response.json();
                
                if (data.success) {
                    assetsData = data.assets;
                    renderAssetMarkers();
                    renderAssetIntelligence();
                    updateMetrics();
                } else {
                    console.error('Failed to fetch asset data');
                }
            } catch (error) {
                console.error('Asset data fetch error:', error);
                // Use fallback legacy data if API fails
                loadLegacyAssetData();
            }
        }

        // Load legacy asset data as fallback
        function loadLegacyAssetData() {
            assetsData = [
                {
                    id: 'D-26',
                    name: 'D-26 Dozer',
                    type: 'Heavy Equipment',
                    status: 'Active',
                    location: 'Trinity River Project',
                    utilization: 78,
                    fuel: 85,
                    gps: { lat: 32.7555, lng: -97.3308 },
                    mapPosition: { x: 120, y: 95 }
                },
                {
                    id: 'EX-81',
                    name: 'EX-81 Excavator',
                    type: 'Excavator',
                    status: 'Active',
                    location: 'Downtown Construction',
                    utilization: 92,
                    fuel: 76,
                    gps: { lat: 32.7467, lng: -97.3428 },
                    mapPosition: { x: 340, y: 140 }
                },
                {
                    id: 'PT-252',
                    name: 'PT-252 Power Unit',
                    type: 'Power Unit',
                    status: 'Active',
                    location: 'Alliance Equipment Depot',
                    utilization: 65,
                    fuel: 91,
                    gps: { lat: 32.7357, lng: -97.3089 },
                    mapPosition: { x: 560, y: 110 }
                },
                {
                    id: 'RAM-03',
                    name: 'RAM-03 Pickup',
                    type: 'Pickup Truck',
                    status: 'Idle',
                    location: 'Fort Worth Main Yard',
                    utilization: 34,
                    fuel: 68,
                    gps: { lat: 32.7258, lng: -97.3206 },
                    mapPosition: { x: 420, y: 270 }
                },
                {
                    id: 'F150-01',
                    name: 'F150-01 Pickup',
                    type: 'Pickup Truck',
                    status: 'Active',
                    location: 'Trinity River Project',
                    utilization: 73,
                    fuel: 82,
                    gps: { lat: 32.7478, lng: -97.3147 },
                    mapPosition: { x: 180, y: 130 }
                }
            ];
            
            renderAssetMarkers();
            renderAssetIntelligence();
            updateMetrics();
        }

        // Render asset markers on the map
        function renderAssetMarkers() {
            const mapContainer = document.getElementById('quantumMap');
            
            // Clear existing markers
            const existingMarkers = mapContainer.querySelectorAll('.asset-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            assetsData.forEach((asset, index) => {
                const marker = document.createElement('div');
                marker.className = `asset-marker ${asset.status.toLowerCase()}`;
                marker.id = `marker-${asset.id}`;
                
                // Position based on mapPosition or calculate from GPS
                const position = asset.mapPosition || calculateMapPosition(asset.gps);
                marker.style.left = position.x + 'px';
                marker.style.top = position.y + 'px';
                
                // Add click and hover events
                marker.addEventListener('click', () => selectAsset(asset));
                marker.addEventListener('mouseenter', (e) => showTooltip(e, asset));
                marker.addEventListener('mouseleave', hideTooltip);
                
                mapContainer.appendChild(marker);
                
                // Add staggered animation
                setTimeout(() => {
                    marker.style.animation = `marker-pulse 2s ease-in-out infinite`;
                    marker.style.animationDelay = `${index * 0.2}s`;
                }, index * 100);
            });
            
            if (connectionsVisible) {
                renderConnections();
            }
        }

        // Calculate map position from GPS coordinates
        function calculateMapPosition(gps) {
            if (!gps) return { x: Math.random() * 600, y: Math.random() * 300 };
            
            // Fort Worth bounds approximation
            const bounds = {
                minLat: 32.7200,
                maxLat: 32.7600,
                minLng: -97.3500,
                maxLng: -97.3000
            };
            
            const x = ((gps.lng - bounds.minLng) / (bounds.maxLng - bounds.minLng)) * 600;
            const y = ((bounds.maxLat - gps.lat) / (bounds.maxLat - bounds.minLat)) * 300;
            
            return { x: Math.max(10, Math.min(590, x)), y: Math.max(10, Math.min(290, y)) };
        }

        // Render asset intelligence panel
        function renderAssetIntelligence() {
            const container = document.getElementById('assetIntelligenceList');
            container.innerHTML = '';
            
            assetsData.forEach(asset => {
                const card = document.createElement('div');
                card.className = 'asset-intelligence-card';
                card.onclick = () => selectAsset(asset);
                
                card.innerHTML = `
                    <div class="asset-id">${asset.id} - ${asset.name}</div>
                    <div class="asset-status status-${asset.status.toLowerCase()}">${asset.status}</div>
                    <div class="asset-location">${asset.location}</div>
                    <div class="asset-metrics">
                        <div class="mini-metric">
                            <div class="mini-value">${asset.utilization}%</div>
                            <div class="mini-label">Utilization</div>
                        </div>
                        <div class="mini-metric">
                            <div class="mini-value">${asset.fuel}%</div>
                            <div class="mini-label">Fuel</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Create zone overlays
        function createZoneOverlays() {
            const mapContainer = document.getElementById('quantumMap');
            
            fortWorthZones.forEach(zone => {
                const overlay = document.createElement('div');
                overlay.className = 'zone-overlay';
                overlay.style.left = zone.x + 'px';
                overlay.style.top = zone.y + 'px';
                overlay.style.width = zone.width + 'px';
                overlay.style.height = zone.height + 'px';
                
                const label = document.createElement('div');
                label.className = 'zone-label';
                label.textContent = zone.name;
                overlay.appendChild(label);
                
                mapContainer.appendChild(overlay);
            });
        }

        // Show asset tooltip
        function showTooltip(event, asset) {
            const tooltip = document.getElementById('assetTooltip');
            document.getElementById('tooltipTitle').textContent = asset.name;
            document.getElementById('tooltipStatus').textContent = asset.status;
            document.getElementById('tooltipLocation').textContent = asset.location;
            document.getElementById('tooltipUtilization').textContent = asset.utilization + '%';
            document.getElementById('tooltipFuel').textContent = asset.fuel + '%';
            
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        // Hide asset tooltip
        function hideTooltip() {
            document.getElementById('assetTooltip').style.display = 'none';
        }

        // Select asset
        function selectAsset(asset) {
            // Highlight selected asset
            document.querySelectorAll('.asset-marker').forEach(marker => {
                marker.style.border = '2px solid #00ff88';
            });
            
            const selectedMarker = document.getElementById(`marker-${asset.id}`);
            if (selectedMarker) {
                selectedMarker.style.border = '4px solid #ffaa00';
                selectedMarker.style.transform = 'scale(1.5)';
            }
            
            console.log('Selected asset:', asset);
        }

        // Toggle zone overlays
        function toggleZones() {
            zonesVisible = !zonesVisible;
            const zones = document.querySelectorAll('.zone-overlay');
            zones.forEach(zone => {
                zone.style.display = zonesVisible ? 'block' : 'none';
            });
        }

        // Toggle asset connections
        function toggleConnections() {
            connectionsVisible = !connectionsVisible;
            if (connectionsVisible) {
                renderConnections();
            } else {
                const connections = document.querySelectorAll('.asset-connection');
                connections.forEach(conn => conn.remove());
            }
        }

        // Render asset connections
        function renderConnections() {
            const mapContainer = document.getElementById('quantumMap');
            const connections = mapContainer.querySelectorAll('.asset-connection');
            connections.forEach(conn => conn.remove());
            
            for (let i = 0; i < assetsData.length - 1; i++) {
                const asset1 = assetsData[i];
                const asset2 = assetsData[i + 1];
                
                const pos1 = asset1.mapPosition || calculateMapPosition(asset1.gps);
                const pos2 = asset2.mapPosition || calculateMapPosition(asset2.gps);
                
                const connection = document.createElement('div');
                connection.className = 'asset-connection';
                
                const length = Math.sqrt(Math.pow(pos2.x - pos1.x, 2) + Math.pow(pos2.y - pos1.y, 2));
                const angle = Math.atan2(pos2.y - pos1.y, pos2.x - pos1.x) * 180 / Math.PI;
                
                connection.style.left = pos1.x + 'px';
                connection.style.top = pos1.y + 'px';
                connection.style.width = length + 'px';
                connection.style.transform = `rotate(${angle}deg)`;
                
                mapContainer.appendChild(connection);
            }
        }

        // Update metrics
        function updateMetrics() {
            const totalAssets = assetsData.length;
            const activeAssets = assetsData.filter(asset => asset.status === 'Active').length;
            
            document.getElementById('totalAssets').textContent = totalAssets;
            document.getElementById('activeAssets').textContent = activeAssets;
        }

        // Refresh assets
        function refreshAssets() {
            fetchAssetData();
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeQuantumMap);
    </script>
</body>
</html>
{% extends "dashboard_herc_inspired.html" %}

{% block content %}
<div class="main-content"><div class="content-header"><h1 class="h3 mb-0">Complete Attendance Management System</h1><div class="d-flex gap-2"><a href="{{ csv_export_file }}" class="btn btn-success btn-sm" download><i class="fas fa-download"></i> Export Payroll CSV
</a><button class="btn btn-warning btn-sm" onclick="generateReport()"><i class="fas fa-file-excel"></i> Generate Report
</button><button class="btn btn-primary btn-sm" onclick="refreshData()"><i class="fas fa-sync-alt"></i> Refresh Data
</button></div></div><div class="row mb-4"><div class="col-md-3"><div class="summary-card bg-success"><div class="summary-icon"><i class="fas fa-users"></i></div><div class="summary-content"><h3>{{ total_employees }}</h3><p>Total Employees</p></div></div></div><div class="col-md-3"><div class="summary-card bg-primary"><div class="summary-icon"><i class="fas fa-clock"></i></div><div class="summary-content"><h3>{{ "{:.1f}".format(total_hours) }}</h3><p>Total Hours</p></div></div></div><div class="col-md-3"><div class="summary-card bg-warning"><div class="summary-icon"><i class="fas fa-stopwatch"></i></div><div class="summary-content"><h3>{{ "{:.1f}".format(overtime_hours) }}</h3><p>Overtime Hours</p></div></div></div><div class="col-md-3"><div class="summary-card bg-info"><div class="summary-icon"><i class="fas fa-dollar-sign"></i></div><div class="summary-content"><h3>${{ "{:,.0f}".format(total_payroll) }}</h3><p>Total Payroll</p></div></div></div></div>


{% if alerts %}
<div class="alert alert-warning" role="alert"><h6><i class="fas fa-exclamation-triangle"></i> Attendance Alerts</h6><ul class="mb-0">
{% for alert in alerts %}
<li>{{ alert }}</li>
{% endfor %}
</ul></div>
{% endif %}


<div class="card mb-4"><div class="card-header"><h5 class="mb-0">Attendance Rate: {{ attendance_rate }}%</h5></div><div class="card-body"><div class="progress" style="height: 30px;"><div class="progress-bar {% if attendance_rate >= 90 %}bg-success{% elif attendance_rate >= 75 %}bg-warning{% else %}bg-danger{% endif %}"
role="progressbar" style="width: {{ attendance_rate }}%">
{{ attendance_rate }}%
</div></div></div></div><div class="card"><div class="card-header"><h5 class="mb-0">Employee Attendance Details</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-striped table-hover" id="attendanceTable"><thead class="table-dark"><tr><th>Employee</th><th>Status</th><th>Days Worked</th><th>Regular Hours</th><th>Overtime Hours</th><th>Total Hours</th><th>Total Pay</th><th>Primary Job Sites</th><th>Actions</th></tr></thead><tbody>
{% for emp in attendance_data %}
<tr><td><strong>{{ emp.employee }}</strong></td><td>
{% if emp.status == 'On Site' %}
<span class="badge bg-success">{{ emp.status }}</span>
{% elif emp.status == 'Partial Week' %}
<span class="badge bg-warning">{{ emp.status }}</span>
{% else %}
<span class="badge bg-secondary">{{ emp.status }}</span>
{% endif %}
</td><td>{{ emp.days_worked }}</td><td>{{ emp.regular_hours }}</td><td>
{% if emp.overtime > 0 %}
<span class="text-warning">{{ emp.overtime }}</span>
{% else %}
<span class="text-muted">-</span>
{% endif %}
</td><td><strong>{{ emp.hours }}</strong></td><td><strong>${{ "{:,.2f}".format(emp.total_pay) }}</strong></td><td>{{ emp.job_sites }}</td><td><button class="btn btn-sm btn-outline-primary" onclick="viewEmployee('{{ emp.employee }}')"><i class="fas fa-eye"></i></button><button class="btn btn-sm btn-outline-warning" onclick="editEmployee('{{ emp.employee }}')"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-outline-info" onclick="generateEmployeeReport('{{ emp.employee }}')"><i class="fas fa-file-alt"></i></button></td></tr>
{% endfor %}
</tbody></table></div></div></div><div class="card mt-4"><div class="card-header"><h5 class="mb-0">Payroll Export & Integration</h5></div><div class="card-body"><div class="row"><div class="col-md-6"><h6>Export Options</h6><div class="d-grid gap-2"><a href="{{ csv_export_file }}" class="btn btn-success" download><i class="fas fa-file-csv"></i> Download CSV (QuickBooks Ready)
</a><button class="btn btn-primary" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Export to Excel
</button><button class="btn btn-info" onclick="generatePayrollReport()"><i class="fas fa-calculator"></i> Generate Payroll Report
</button></div></div><div class="col-md-6"><h6>Integration Status</h6><div class="list-group"><div class="list-group-item d-flex justify-content-between"><span>CSV Export Ready</span><span class="badge bg-success">Active</span></div><div class="list-group-item d-flex justify-content-between"><span>QuickBooks Format</span><span class="badge bg-success">Ready</span></div><div class="list-group-item d-flex justify-content-between"><span>Foundation Integration</span><span class="badge bg-warning">Pending</span></div></div></div></div></div></div></div><style>
.summary-card {
color: white;
padding: 20px;
border-radius: 10px;
margin-bottom: 20px;
display: flex;
align-items: center;
}

.summary-icon {
font-size: 2.5rem;
margin-right: 20px;
opacity: 0.8;
}

.summary-content h3 {
margin: 0;
font-size: 2rem;
font-weight: bold;
}

.summary-content p {
margin: 0;
opacity: 0.9;
}

.table th {
font-weight: 600;
text-transform: uppercase;
font-size: 0.85rem;
letter-spacing: 0.5px;
}

.badge {
font-size: 0.8rem;
padding: 0.5rem 0.75rem;
}

.progress {
font-weight: bold;
font-size: 1.1rem;
}
</style><script>
function refreshData() {
location.reload();
}

function generateReport() {
// Implement report generation
alert('Generating comprehensive attendance report...');
}

function viewEmployee(employee) {
alert(`Viewing detailed record for ${employee}`);
}

function editEmployee(employee) {
alert(`Editing record for ${employee}`);
}

function generateEmployeeReport(employee) {
alert(`Generating individual report for ${employee}`);
}

function exportToExcel() {
alert('Exporting to Excel format...');
}

function generatePayrollReport() {
alert('Generating payroll summary report...');
}

// Auto-refresh every 5 minutes
setInterval(refreshData, 300000);
</script>
{% endblock %}
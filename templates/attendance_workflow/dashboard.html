<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAXORA - Attendance Workflow</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .workflow-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .report-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: #1F2937;
            border-radius: 0.5rem;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid #374151;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .metric-card.success { border-left: 4px solid #10B981; }
        .metric-card.warning { border-left: 4px solid #F59E0B; }
        .metric-card.danger { border-left: 4px solid #EF4444; }
        .metric-card.info { border-left: 4px solid #3B82F6; }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #FFFFFF;
        }
        
        .metric-card div {
            color: #D1D5DB;
        }
        
        .sync-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .report-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .morning-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #FFFFFF;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }
        
        .morning-summary h4 {
            color: #FFFFFF;
        }
        
        .morning-summary p {
            color: #D1D5DB;
        }
    </style>
</head>
<body>
    <!-- Workflow Header -->
    <div class="workflow-header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1><i class="fas fa-chart-line"></i> Attendance Workflow</h1>
                    <p class="mb-0">Daily → Weekly → Monthly reporting for morning reviews</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Morning Summary -->
        <div class="morning-summary">
            <h3><i class="fas fa-sun"></i> Good Morning! Today's Summary</h3>
            <div class="row mt-3">
                <div class="col-md-4">
                    <h4>{{ daily_summary.total_drivers or 0 }}</h4>
                    <p>Drivers Tracked Today</p>
                </div>
                <div class="col-md-4">
                    <h4>{{ daily_summary.on_time or 0 }}</h4>
                    <p>On Time Arrivals</p>
                </div>
                <div class="col-md-4">
                    <h4>{{ daily_summary.issues or 0 }}</h4>
                    <p>Issues Requiring Attention</p>
                </div>
            </div>
        </div>
        
        <!-- Gauge API Sync Section -->
        <div class="sync-section">
            <h4><i class="fas fa-sync-alt"></i> Gauge API Integration</h4>
            <p>Sync authentic fleet data from your Gauge system for real attendance tracking.</p>
            
            <div class="row">
                <div class="col-md-8">
                    <button id="syncGaugeBtn" class="btn btn-primary btn-lg" onclick="syncFromGauge()">
                        <i class="fas fa-download"></i> Sync from Gauge API
                    </button>
                    <button class="btn btn-outline-secondary" onclick="uploadGroundWorks()">
                        <i class="fas fa-upload"></i> Upload Ground Works Data
                    </button>
                </div>
                <div class="col-md-4">
                    <div id="syncStatus" class="text-muted">
                        <small>Ready to sync with your fleet data</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Key Metrics -->
        <div class="metric-grid">
            <div class="metric-card success">
                <div class="metric-value text-success">{{ daily_summary.on_time or 0 }}</div>
                <div>On Time Today</div>
            </div>
            <div class="metric-card warning">
                <div class="metric-value text-warning">{{ daily_summary.issues or 0 }}</div>
                <div>Issues Today</div>
            </div>
            <div class="metric-card info">
                <div class="metric-value text-info">7</div>
                <div>Days This Week</div>
            </div>
            <div class="metric-card success">
                <div class="metric-value text-success">{{ monthly_summary.work_days_processed or 0 }}</div>
                <div>Work Days This Month</div>
            </div>
        </div>
        
        <!-- Report Generation -->
        <div class="flex flex-wrap gap-4 justify-center mt-6">
            <div class="col-md-4">
                <div class="report-card">
                    <h5><i class="fas fa-calendar-day"></i> Daily Report</h5>
                    <p>Today's attendance summary for {{ current_date }}</p>
                    <div class="report-actions">
                        <button class="btn btn-primary hover:bg-blue-700 focus:ring-4 focus:ring-blue-300" onclick="generateDailyReport()">
                            <i class="fas fa-file-alt"></i> Generate
                        </button>
                        <button class="btn btn-outline-secondary hover:bg-gray-100 focus:ring-4 focus:ring-gray-300" onclick="viewDailyReport()">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="report-card">
                    <h5><i class="fas fa-calendar-week"></i> Weekly Report</h5>
                    <p>This week's attendance trends and patterns</p>
                    <div class="report-actions">
                        <button class="btn btn-primary hover:bg-blue-700 focus:ring-4 focus:ring-blue-300" onclick="generateWeeklyReport()">
                            <i class="fas fa-file-alt"></i> Generate
                        </button>
                        <button class="btn btn-outline-secondary hover:bg-gray-100 focus:ring-4 focus:ring-gray-300" onclick="viewWeeklyReport()">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="report-card">
                    <h5><i class="fas fa-calendar-alt"></i> Monthly Report</h5>
                    <p>Complete monthly attendance analysis</p>
                    <div class="report-actions">
                        <button class="btn btn-primary hover:bg-blue-700 focus:ring-4 focus:ring-blue-300" onclick="generateMonthlyReport()">
                            <i class="fas fa-file-alt"></i> Generate
                        </button>
                        <button class="btn btn-outline-secondary hover:bg-gray-100 focus:ring-4 focus:ring-gray-300" onclick="viewMonthlyReport()">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <h4>Quick Actions</h4>
                <div class="d-flex gap-2 flex-wrap">
                    <a href="/driver-attendance" class="btn btn-outline-primary">
                        <i class="fas fa-users"></i> Driver Attendance Dashboard
                    </a>
                    <a href="/upload-may-week-data" class="btn btn-outline-success">
                        <i class="fas fa-upload"></i> Upload Historical Data
                    </a>
                    <button class="btn btn-outline-info" onclick="exportReports()">
                        <i class="fas fa-download"></i> Export All Reports
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function syncFromGauge() {
            const btn = document.getElementById('syncGaugeBtn');
            const status = document.getElementById('syncStatus');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';
            status.innerHTML = '<small class="text-info">Connecting to Gauge API...</small>';
            
            fetch('/attendance-workflow/sync-gauge')
                .then(response => response.json())
                .then(data => {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-download"></i> Sync from Gauge API';
                    
                    if (data.success) {
                        status.innerHTML = `<small class="text-success" style="color: #10B981;">✅ ${data.message} - ${data.records_processed || 0} records processed</small>`;
                        // Show success animation
                        btn.classList.add('btn-success');
                        btn.classList.remove('btn-primary');
                        setTimeout(() => {
                            btn.classList.add('btn-primary');
                            btn.classList.remove('btn-success');
                            window.location.reload();
                        }, 2000);
                    } else {
                        status.innerHTML = `<small class="text-danger" style="color: #EF4444;">❌ ${data.message}</small>`;
                        btn.classList.add('btn-danger');
                        btn.classList.remove('btn-primary');
                        setTimeout(() => {
                            btn.classList.add('btn-primary');
                            btn.classList.remove('btn-danger');
                        }, 3000);
                    }
                })
                .catch(error => {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-download"></i> Sync from Gauge API';
                    status.innerHTML = '<small class="text-danger">❌ Sync failed</small>';
                });
        }
        
        function generateDailyReport() {
            const today = new Date().toISOString().split('T')[0];
            
            fetch(`/attendance-workflow/daily-report/${today}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`Daily report generated successfully!\n\nTotal Drivers: ${data.report.total_drivers}\nOn Time: ${data.report.on_time}\nLate: ${data.report.late_arrivals}\nAbsent: ${data.report.absent}`);
                    } else {
                        alert('Failed to generate daily report');
                    }
                })
                .catch(error => {
                    alert('Error generating daily report');
                });
        }
        
        function generateWeeklyReport() {
            fetch('/attendance-workflow/weekly-report')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`Weekly report generated successfully!\n\nWeek: ${data.report.week_start} to ${data.report.week_end}\nTotal Drivers: ${data.report.week_totals.total_drivers}\nOn Time: ${data.report.week_totals.total_on_time}`);
                    } else {
                        alert('Failed to generate weekly report');
                    }
                })
                .catch(error => {
                    alert('Error generating weekly report');
                });
        }
        
        function generateMonthlyReport() {
            fetch('/attendance-workflow/monthly-report')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`Monthly report generated successfully!\n\nMonth: ${data.report.month}\nWork Days: ${data.report.month_metrics.total_work_days}\nAverage Attendance: ${data.report.month_metrics.average_attendance}`);
                    } else {
                        alert('Failed to generate monthly report');
                    }
                })
                .catch(error => {
                    alert('Error generating monthly report');
                });
        }
        
        function uploadGroundWorks() {
            window.location.href = '/driver-attendance/upload';
        }
        
        function viewDailyReport() {
            alert('Daily report viewer will open your generated reports in a detailed view.');
        }
        
        function viewWeeklyReport() {
            alert('Weekly report viewer will show trends and patterns across the week.');
        }
        
        function viewMonthlyReport() {
            alert('Monthly report viewer will display comprehensive monthly analytics.');
        }
        
        function exportReports() {
            alert('Export functionality will package all reports for download.');
        }
    </script>
</body>
</html>
{% extends "unified_base.html" %} {% block title %}Authentic Billing Dashboard -
TRAXOVO{% endblock %} {% block content %}
<div class="container-fluid">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h1 class="mb-1">
                <i class="fas fa-chart-line me-3"></i>Authentic Billing
                Dashboard
              </h1>
              <p class="mb-0">
                Complete Jan-April 2025 RAGLE Inc + SELECT MAINTENANCE
                Consolidation
              </p>
            </div>
            <div class="col-md-4 text-end">
              <div class="d-flex justify-content-end gap-2">
                <button
                  class="btn btn-light btn-sm"
                  onclick="exportBillingData()"
                >
                  <i class="fas fa-download me-1"></i>Export
                </button>
                <button
                  class="btn btn-outline-light btn-sm"
                  onclick="refreshBillingData()"
                >
                  <i class="fas fa-sync me-1"></i>Refresh
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-primary mb-2">
            <i class="fas fa-dollar-sign fa-2x"></i>
          </div>
          <h3 class="text-primary mb-1">
            ${{ "{:,.0f}".format(metrics.ytd_revenue) }}
          </h3>
          <p class="text-muted mb-0">YTD Revenue</p>
          <small class="text-success">
            <i class="fas fa-arrow-up me-1"></i>Authentic Data
          </small>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-success mb-2">
            <i class="fas fa-chart-bar fa-2x"></i>
          </div>
          <h3 class="text-success mb-1">
            ${{ "{:,.0f}".format(metrics.monthly_average) }}
          </h3>
          <p class="text-muted mb-0">Monthly Average</p>
          <small class="text-info"> 4-Month Average </small>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-warning mb-2">
            <i class="fas fa-tools fa-2x"></i>
          </div>
          <h3 class="text-warning mb-1">{{ metrics.total_assets }}</h3>
          <p class="text-muted mb-0">Total Assets</p>
          <small class="text-muted"> Both Companies </small>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-info mb-2">
            <i class="fas fa-building fa-2x"></i>
          </div>
          <h3 class="text-info mb-1">2</h3>
          <p class="text-muted mb-0">Companies</p>
          <small class="text-muted"> RAGLE + SELECT </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Monthly Breakdown Chart -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-chart-area me-2"></i>Monthly Revenue Breakdown
          </h5>
        </div>
        <div class="card-body">
          <div class="chart-wrapper" style="height: 400px">
            <canvas id="monthlyRevenueChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Company Comparison -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-balance-scale me-2"></i>Company Comparison
          </h5>
        </div>
        <div class="card-body">
          <div class="chart-wrapper" style="height: 300px">
            <canvas id="companyComparisonChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-trending-up me-2"></i>YTD Growth Trend
          </h5>
        </div>
        <div class="card-body">
          <div class="chart-wrapper" style="height: 300px">
            <canvas id="growthTrendChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Breakdown Table -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-table me-2"></i>Detailed Monthly Breakdown
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="bg-light">
                <tr>
                  <th>Month</th>
                  <th class="text-end">RAGLE Revenue</th>
                  <th class="text-end">SELECT Revenue</th>
                  <th class="text-end">Total Revenue</th>
                  <th class="text-end">Growth %</th>
                </tr>
              </thead>
              <tbody>
                {% for period, data in monthly_breakdown.items() %}
                <tr>
                  <td><strong>{{ data.month }}</strong></td>
                  <td class="text-end">${{ "{:,.0f}".format(data.ragle) }}</td>
                  <td class="text-end">${{ "{:,.0f}".format(data.select) }}</td>
                  <td class="text-end">
                    <strong>${{ "{:,.0f}".format(data.total) }}</strong>
                  </td>
                  <td class="text-end">
                    {% set growth = ytd_growth[loop.index0].growth_rate if
                    ytd_growth|length > loop.index0 else 0 %} {% if growth > 0
                    %}
                    <span class="text-success"
                      >+{{ "{:.1f}".format(growth) }}%</span
                    >
                    {% elif growth < 0 %}
                    <span class="text-danger"
                      >{{ "{:.1f}".format(growth) }}%</span
                    >
                    {% else %}
                    <span class="text-muted">--</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot class="bg-light">
                <tr>
                  <td><strong>YTD Total</strong></td>
                  <td class="text-end">
                    <strong
                      >${{ "{:,.0f}".format(metrics.ragle_contribution)
                      }}</strong
                    >
                  </td>
                  <td class="text-end">
                    <strong
                      >${{ "{:,.0f}".format(metrics.select_contribution)
                      }}</strong
                    >
                  </td>
                  <td class="text-end">
                    <strong
                      >${{ "{:,.0f}".format(metrics.ytd_revenue) }}</strong
                    >
                  </td>
                  <td class="text-end">
                    <span class="badge bg-success">Authentic</span>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Asset Performance -->
  <div class="row">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-cogs me-2"></i>RAGLE Performance
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-6">
              <div class="text-center">
                <h4 class="text-primary">{{ metrics.ragle_assets }}</h4>
                <p class="text-muted mb-0">Total Assets</p>
              </div>
            </div>
            <div class="col-6">
              <div class="text-center">
                <h4 class="text-success">
                  ${{ "{:,.0f}".format(company_comparison.ragle.monthly_average)
                  }}
                </h4>
                <p class="text-muted mb-0">Monthly Avg</p>
              </div>
            </div>
          </div>
          <hr />
          <div class="text-center">
            <p class="mb-1"><strong>Asset Utilization</strong></p>
            <h5 class="text-info">
              ${{ "{:,.0f}".format(company_comparison.ragle.asset_utilization)
              }}/asset
            </h5>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-wrench me-2"></i>SELECT Performance
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-6">
              <div class="text-center">
                <h4 class="text-primary">{{ metrics.select_assets }}</h4>
                <p class="text-muted mb-0">Total Assets</p>
              </div>
            </div>
            <div class="col-6">
              <div class="text-center">
                <h4 class="text-success">
                  ${{
                  "{:,.0f}".format(company_comparison.select.monthly_average) }}
                </h4>
                <p class="text-muted mb-0">Monthly Avg</p>
              </div>
            </div>
          </div>
          <hr />
          <div class="text-center">
            <p class="mb-1"><strong>Asset Utilization</strong></p>
            <h5 class="text-info">
              ${{ "{:,.0f}".format(company_comparison.select.asset_utilization)
              }}/asset
            </h5>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Monthly Revenue Chart
      const monthlyCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
      const monthlyData = {{ monthly_breakdown | tojson | safe }};

      new Chart(monthlyCtx, {
          type: 'bar',
          data: {
              labels: Object.values(monthlyData).map(d => d.month),
              datasets: [{
                  label: 'RAGLE',
                  data: Object.values(monthlyData).map(d => d.ragle),
                  backgroundColor: 'rgba(54, 162, 235, 0.8)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1
              }, {
                  label: 'SELECT',
                  data: Object.values(monthlyData).map(d => d.select),
                  backgroundColor: 'rgba(255, 99, 132, 0.8)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                  borderWidth: 1
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  title: {
                      display: true,
                      text: 'Monthly Revenue by Company'
                  }
              },
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: {
                          callback: function(value) {
                              return '$' + value.toLocaleString();
                          }
                      }
                  }
              }
          }
      });

      // Company Comparison Pie Chart
      const comparisonCtx = document.getElementById('companyComparisonChart').getContext('2d');

      new Chart(comparisonCtx, {
          type: 'doughnut',
          data: {
              labels: ['RAGLE Inc', 'SELECT MAINTENANCE'],
              datasets: [{
                  data: [{{ metrics.ragle_contribution }}, {{ metrics.select_contribution }}],
                  backgroundColor: [
                      'rgba(54, 162, 235, 0.8)',
                      'rgba(255, 99, 132, 0.8)'
                  ],
                  borderColor: [
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 99, 132, 1)'
                  ],
                  borderWidth: 2
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  title: {
                      display: true,
                      text: 'YTD Revenue Distribution'
                  },
                  legend: {
                      position: 'bottom'
                  }
              }
          }
      });

      // Growth Trend Chart
      const growthCtx = document.getElementById('growthTrendChart').getContext('2d');
      const growthData = {{ ytd_growth | tojson | safe }};

      new Chart(growthCtx, {
          type: 'line',
          data: {
              labels: growthData.map(d => d.month),
              datasets: [{
                  label: 'Monthly Revenue',
                  data: growthData.map(d => d.total),
                  borderColor: 'rgba(75, 192, 192, 1)',
                  backgroundColor: 'rgba(75, 192, 192, 0.2)',
                  borderWidth: 3,
                  fill: true,
                  tension: 0.4
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  title: {
                      display: true,
                      text: 'Revenue Growth Trend'
                  }
              },
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: {
                          callback: function(value) {
                              return '$' + value.toLocaleString();
                          }
                      }
                  }
              }
          }
      });
  });

  function exportBillingData() {
      // Export functionality
      window.open('/api/authentic-billing-data?format=export', '_blank');
  }

  function refreshBillingData() {
      // Refresh the page to get latest data
      location.reload();
  }
</script>
{% endblock %}

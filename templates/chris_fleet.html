{% extends "base.html" %} {% block title %}{{ page_title }}{% endblock %} {%
block head %}
<style>
  .fleet-metric {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border: 1px solid #00ff88;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: center;
  }

  .asset-card {
    background: #0f0f23;
    border: 1px solid #00bcd4;
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
  }

  .disposal-recommended {
    border-left: 4px solid #ff4757;
    background: rgba(255, 71, 87, 0.1);
  }

  .high-value-asset {
    border-left: 4px solid #2ed573;
    background: rgba(46, 213, 115, 0.1);
  }

  .book-value {
    color: #00ff88;
    font-size: 1.5em;
    font-weight: bold;
  }

  .cost-ratio {
    color: #ffd700;
    font-family: "Courier New", monospace;
  }

  .asset-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
  }

  .stat-item {
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid #00ff88;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
  }

  .sidebar-smart {
    position: fixed;
    left: -280px;
    top: 0;
    width: 280px;
    height: 100vh;
    background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
    border-right: 2px solid #00ff88;
    transition: left 0.3s ease;
    z-index: 1000;
    overflow-y: auto;
  }

  .sidebar-smart.open {
    left: 0;
  }

  .sidebar-toggle {
    position: fixed;
    left: 10px;
    top: 70px;
    background: #00ff88;
    color: #1a1a2e;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    z-index: 1001;
    font-size: 16px;
  }

  .sidebar-section {
    margin: 20px 15px;
  }

  .sidebar-section h6 {
    color: #00ff88;
    border-bottom: 1px solid #00ff88;
    padding-bottom: 5px;
    margin-bottom: 10px;
  }

  .sidebar-link {
    display: block;
    color: #ffffff;
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 4px;
    margin: 2px 0;
    transition: all 0.3s ease;
  }

  .sidebar-link:hover {
    background: rgba(0, 255, 136, 0.2);
    color: #00ff88;
    text-decoration: none;
  }

  .sidebar-link.working {
    border-left: 3px solid #2ed573;
  }

  .sidebar-link.broken {
    border-left: 3px solid #ff4757;
    opacity: 0.7;
  }

  .main-content {
    transition: margin-left 0.3s ease;
  }

  .main-content.shifted {
    margin-left: 280px;
  }
</style>
{% endblock %} {% block content %}
<!-- Smart Sidebar -->
<div class="sidebar-smart" id="smartSidebar">
  <div class="sidebar-section">
    <h5 class="text-center text-success mt-3">TRAXOVO Navigation</h5>
  </div>

  <div class="sidebar-section">
    <h6><i class="fas fa-check-circle"></i> Working Modules</h6>
    <a href="/dashboard" class="sidebar-link working">
      <i class="fas fa-tachometer-alt"></i> Main Dashboard
    </a>
    <a href="/watson-confidence" class="sidebar-link working">
      <i class="fas fa-brain"></i> Watson Center
    </a>
    <a href="/asi-analyzer" class="sidebar-link working">
      <i class="fas fa-brain"></i> ASI Analyzer
    </a>
    <a href="/security-dashboard" class="sidebar-link working">
      <i class="fas fa-shield-alt"></i> Security Center
    </a>
    <a href="/chris-fleet" class="sidebar-link working">
      <i class="fas fa-truck"></i> Fleet Operations
    </a>
    <a href="/billing-consolidation" class="sidebar-link working">
      <i class="fas fa-file-invoice"></i> Billing Analytics
    </a>
    <a href="/attendance-matrix" class="sidebar-link working">
      <i class="fas fa-users"></i> Attendance Matrix
    </a>
  </div>

  <div class="sidebar-section">
    <h6><i class="fas fa-exclamation-triangle"></i> Needs Attention</h6>
    <a href="/fleet-map" class="sidebar-link broken">
      <i class="fas fa-map"></i> Fleet Map (JSON Error)
    </a>
    <a href="/asset-manager" class="sidebar-link broken">
      <i class="fas fa-cogs"></i> Asset Manager (Template Missing)
    </a>
  </div>

  <div class="sidebar-section">
    <h6><i class="fas fa-tools"></i> Admin Tools</h6>
    <a href="/api/fleet_overview" class="sidebar-link working" target="_blank">
      <i class="fas fa-database"></i> Fleet API
    </a>
    <a
      href="/api/watson_confidence_data"
      class="sidebar-link working"
      target="_blank"
    >
      <i class="fas fa-chart-line"></i> Confidence API
    </a>
    <a href="/api/security_data" class="sidebar-link working" target="_blank">
      <i class="fas fa-shield-alt"></i> Security API
    </a>
  </div>
</div>

<button class="sidebar-toggle" onclick="toggleSidebar()">
  <i class="fas fa-bars"></i>
</button>

<div class="main-content" id="mainContent">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1 class="text-primary">
            <i class="fas fa-truck"></i> Fleet Operations Center
            <span class="badge badge-success">GAUGE INTEGRATED</span>
          </h1>
          <div
            class="badge badge-lg"
            style="background: linear-gradient(45deg, #667eea 0%, #764ba2 100%)"
          >
            Chris Fleet Manager
          </div>
        </div>
      </div>
    </div>

    <!-- Fleet Overview -->
    <div class="row">
      <div class="col-md-3">
        <div class="fleet-metric">
          <h5>Total Assets</h5>
          <div class="book-value">{{ fleet_data.total_assets or 0 }}</div>
          <p class="text-muted">Equipment Units</p>
        </div>
      </div>

      <div class="col-md-3">
        <div class="fleet-metric">
          <h5>Active Fleet</h5>
          <div class="book-value text-success">
            {{ fleet_data.active_assets or 0 }}
          </div>
          <p class="text-muted">Operational</p>
        </div>
      </div>

      <div class="col-md-3">
        <div class="fleet-metric">
          <h5>Fleet Health</h5>
          <div class="book-value text-warning">
            {{ fleet_data.fleet_health_score or 0 }}%
          </div>
          <p class="text-muted">Overall Score</p>
        </div>
      </div>

      <div class="col-md-3">
        <div class="fleet-metric">
          <h5>Avg Utilization</h5>
          <div class="book-value text-info">
            {{ fleet_data.avg_utilization_hours or 0 }}
          </div>
          <p class="text-muted">Hours</p>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
      <div class="col-12">
        <div class="card bg-dark">
          <div class="card-header">
            <h5><i class="fas fa-bolt"></i> Quick Fleet Actions</h5>
          </div>
          <div class="card-body">
            <div class="quick-stats">
              <div class="stat-item">
                <button
                  class="btn btn-success btn-block"
                  onclick="refreshFleetData()"
                >
                  <i class="fas fa-sync"></i> Refresh GAUGE Data
                </button>
              </div>
              <div class="stat-item">
                <button
                  class="btn btn-warning btn-block"
                  onclick="showDisposalCandidates()"
                >
                  <i class="fas fa-exclamation-triangle"></i> Disposal Review
                </button>
              </div>
              <div class="stat-item">
                <button
                  class="btn btn-info btn-block"
                  onclick="generateCostReport()"
                >
                  <i class="fas fa-calculator"></i> Cost Analysis
                </button>
              </div>
              <div class="stat-item">
                <button
                  class="btn btn-primary btn-block"
                  onclick="exportFleetData()"
                >
                  <i class="fas fa-download"></i> Export Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Disposal Candidates -->
    {% if fleet_data.disposal_candidates %}
    <div class="row">
      <div class="col-md-6">
        <div class="card bg-dark">
          <div class="card-header bg-danger">
            <h5>
              <i class="fas fa-exclamation-triangle"></i> Disposal Candidates
            </h5>
          </div>
          <div class="card-body">
            {% for asset in fleet_data.disposal_candidates %}
            <div class="asset-card disposal-recommended">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ asset.asset_id }}</strong><br />
                  <small class="text-muted">{{ asset.make_model }}</small>
                </div>
                <div class="text-right">
                  <div class="cost-ratio">{{ asset.hours }} hrs</div>
                  <small class="text-warning">{{ asset.reason }}</small>
                </div>
              </div>
              <div class="asset-actions">
                <button
                  class="btn btn-sm btn-danger"
                  onclick="reviewAsset('{{ asset.asset_id }}')"
                >
                  Review Disposal
                </button>
                <button
                  class="btn btn-sm btn-info"
                  onclick="getAssetDetails('{{ asset.asset_id }}')"
                >
                  Full Analysis
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card bg-dark">
          <div class="card-header bg-success">
            <h5><i class="fas fa-dollar-sign"></i> High Value Assets</h5>
          </div>
          <div class="card-body">
            {% for asset in fleet_data.high_cost_assets %}
            <div class="asset-card high-value-asset">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ asset.asset_id }}</strong><br />
                  <small class="text-muted">{{ asset.make_model }}</small>
                </div>
                <div class="text-right">
                  <div class="book-value">
                    ${{ "{:,.0f}".format(asset.book_value) }}
                  </div>
                  <small class="text-info">{{ asset.location }}</small>
                </div>
              </div>
              <div class="asset-actions">
                <button
                  class="btn btn-sm btn-success"
                  onclick="getAssetDetails('{{ asset.asset_id }}')"
                >
                  Monitor Asset
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Lifecycle Analysis -->
    {% if lifecycle_data.fleet_lifecycle_analysis %}
    <div class="row">
      <div class="col-12">
        <div class="card bg-dark">
          <div class="card-header">
            <h5>
              <i class="fas fa-chart-bar"></i> Equipment Lifecycle Analysis
            </h5>
          </div>
          <div class="card-body">
            <div style="max-height: 400px; overflow-y: auto">
              {% for asset in lifecycle_data.fleet_lifecycle_analysis[:10] %}
              <div
                class="asset-card {% if asset.disposal_recommended %}disposal-recommended{% endif %}"
              >
                <div class="row">
                  <div class="col-md-4">
                    <strong>{{ asset.asset_id }}</strong><br />
                    <small class="text-muted">{{ asset.make_model }}</small
                    ><br />
                    <span class="badge badge-info"
                      >{{ asset.hours }} hours</span
                    >
                  </div>
                  <div class="col-md-4">
                    <div class="book-value">
                      ${{ "{:,.0f}".format(asset.current_book_value) }}
                    </div>
                    <small class="text-muted">Current Book Value</small>
                  </div>
                  <div class="col-md-4">
                    <div class="cost-ratio">${{ asset.cost_per_hour }}/hr</div>
                    <small class="text-muted">Operating Cost</small><br />
                    {% if asset.disposal_recommended %}
                    <span class="badge badge-danger"
                      >{{ asset.disposal_reason }}</span
                    >
                    {% else %}
                    <span class="badge badge-success">Continue Operation</span>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>

            <div class="text-center mt-3">
              <strong
                >Fleet Total Book Value: ${{
                "{:,.0f}".format(lifecycle_data.total_book_value or 0)
                }}</strong
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Error States -->
    {% if fleet_data.error %}
    <div class="row">
      <div class="col-12">
        <div class="alert alert-warning">
          <strong>Data Notice:</strong> {{ fleet_data.error }} <br /><small
            >Connect GAUGE API for real-time fleet data</small
          >
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
  function toggleSidebar() {
    const sidebar = document.getElementById("smartSidebar");
    const mainContent = document.getElementById("mainContent");

    sidebar.classList.toggle("open");
    mainContent.classList.toggle("shifted");
  }

  function refreshFleetData() {
    fetch("/api/fleet_overview")
      .then((response) => response.json())
      .then((data) => {
        console.log("Fleet data refreshed:", data);
        location.reload();
      })
      .catch((error) => console.error("Refresh error:", error));
  }

  function showDisposalCandidates() {
    alert("Disposal review module - Coming soon with advanced analytics");
  }

  function generateCostReport() {
    alert(
      "Cost analysis report generation - Integrating with accounting systems",
    );
  }

  function exportFleetData() {
    window.open("/api/fleet_overview", "_blank");
  }

  function reviewAsset(assetId) {
    if (confirm(`Review disposal recommendation for asset ${assetId}?`)) {
      fetch(`/api/asset_lifecycle/${assetId}`)
        .then((response) => response.json())
        .then((data) => {
          console.log("Asset analysis:", data);
          alert(
            `Asset ${assetId} analysis complete. Check console for details.`,
          );
        })
        .catch((error) => console.error("Asset analysis error:", error));
    }
  }

  function getAssetDetails(assetId) {
    fetch(`/api/asset_lifecycle/${assetId}`)
      .then((response) => response.json())
      .then((data) => {
        console.log("Asset details:", data);
        alert(
          `Asset ${assetId} details loaded. Check console for full analysis.`,
        );
      })
      .catch((error) => console.error("Asset details error:", error));
  }

  // Auto-refresh fleet data every 10 minutes
  setInterval(refreshFleetData, 600000);

  // Close sidebar when clicking outside
  document.addEventListener("click", function (event) {
    const sidebar = document.getElementById("smartSidebar");
    const toggle = document.querySelector(".sidebar-toggle");

    if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
      sidebar.classList.remove("open");
      document.getElementById("mainContent").classList.remove("shifted");
    }
  });
</script>
{% endblock %}

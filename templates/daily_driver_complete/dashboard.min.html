<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>TRAXOVO Driver Reports - Complete System</title><link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>
.date-selector {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
border-radius: 10px;
padding: 20px;
margin-bottom: 20px;
}
.day-card {
transition: all 0.3s ease;
cursor: pointer;
}
.day-card:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
</style></head><body><div class="container-fluid"><div class="row mb-4"><div class="col-12"><div class="card bg-primary text-white"><div class="card-body"><h1><i class="fas fa-calendar-alt me-2"></i>TRAXOVO Driver Reports</h1><p class="mb-0">Complete date range analysis from your MTD files</p></div></div></div></div><div class="row mb-4"><div class="col-12"><div class="date-selector text-white"><h4><i class="fas fa-clock me-2"></i>Date Range Controls</h4><form method="GET" class="row align-items-end"><div class="col-md-3"><label for="start_date" class="form-label">Start Date</label><input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date }}"></div><div class="col-md-3"><label for="end_date" class="form-label">End Date</label><input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date }}"></div><div class="col-md-3"><button type="submit" class="btn btn-light btn-lg"><i class="fas fa-search me-1"></i>View Range
</button></div><div class="col-md-3"><div class="btn-group" role="group"><a href="?start_date={{ (start_date | datetime - datetime.timedelta(days=7)).strftime('%Y-%m-%d') }}&end_date={{ (end_date | datetime - datetime.timedelta(days=7)).strftime('%Y-%m-%d') }}" class="btn btn-outline-light">← Week</a><a href="?start_date={{ (start_date | datetime + datetime.timedelta(days=7)).strftime('%Y-%m-%d') }}&end_date={{ (end_date | datetime + datetime.timedelta(days=7)).strftime('%Y-%m-%d') }}" class="btn btn-outline-light">Week →</a></div></div></form></div></div></div><div class="row mb-4">
{% if current_metrics and not current_metrics.get('error') %}
<div class="col-md-3"><div class="card bg-success text-white"><div class="card-body text-center"><h2>{{ current_metrics.total_assigned_drivers }}</h2><h6>Today's Active Drivers</h6></div></div></div><div class="col-md-3"><div class="card bg-info text-white"><div class="card-body text-center"><h2>{{ current_metrics.on_time }}</h2><h6>On Time Today</h6></div></div></div><div class="col-md-3"><div class="card bg-warning text-white"><div class="card-body text-center"><h2>{{ current_metrics.late }}</h2><h6>Late Today</h6></div></div></div><div class="col-md-3"><div class="card bg-secondary text-white"><div class="card-body text-center"><h2>{{ range_data.total_drivers or 113 }}</h2><h6>Total Fleet Drivers</h6></div></div></div>
{% endif %}
</div>


{% if range_data and not range_data.get('error') %}
<div class="row mb-4"><div class="col-12"><div class="card"><div class="card-header"><h5><i class="fas fa-chart-line me-2"></i>Daily Reports: {{ range_data.date_range }}</h5><small class="text-muted">{{ range_data.summary.total_days }} days analyzed</small></div><div class="card-body"><div class="row">
{% for day in range_data.daily_reports %}
<div class="col-lg-3 col-md-4 col-sm-6 mb-3"><div class="card day-card border-primary" onclick="viewDayDetails('{{ day.date }}')"><div class="card-body"><h6 class="card-title">{{ day.formatted_date }}</h6><div class="row text-center"><div class="col-4"><strong class="text-success">{{ day.on_time }}</strong><br><small>On Time</small></div><div class="col-4"><strong class="text-warning">{{ day.late }}</strong><br><small>Late</small></div><div class="col-4"><strong class="text-info">{{ day.active_drivers }}</strong><br><small>Active</small></div></div><div class="mt-2"><small class="text-muted">{{ day.total_events }} total events</small></div></div></div></div>
{% endfor %}
</div></div></div></div></div><div class="row mb-4"><div class="col-md-4"><div class="card bg-info text-white"><div class="card-body text-center"><h3>{{ "%.1f"|format(range_data.summary.avg_active_drivers) }}</h3><h6>Avg Active Drivers/Day</h6></div></div></div><div class="col-md-4"><div class="card bg-success text-white"><div class="card-body text-center"><h3>{{ range_data.summary.total_events }}</h3><h6>Total GPS Events</h6></div></div></div><div class="col-md-4"><div class="card bg-primary text-white"><div class="card-body text-center"><h3>{{ range_data.summary.total_days }}</h3><h6>Days Analyzed</h6></div></div></div></div>
{% elif range_data.get('error') %}
<div class="row mb-4"><div class="col-12"><div class="alert alert-warning"><h5><i class="fas fa-exclamation-triangle me-2"></i>Processing Date Range</h5><p>{{ range_data.error }}</p></div></div></div>
{% endif %}


{% if all_drivers %}
<div class="row"><div class="col-12"><div class="card"><div class="card-header"><h5><i class="fas fa-users me-2"></i>Driver Fleet</h5><small class="text-muted">Top 20 drivers from your complete roster</small></div><div class="card-body"><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Driver Name</th><th>Asset ID</th><th>Vehicle</th><th>Actions</th></tr></thead><tbody>
{% for driver in all_drivers %}
<tr><td><strong>{{ driver.driver_name }}</strong></td><td>{{ driver.asset_id }}</td><td>{{ driver.vehicle_type or 'Fleet Vehicle' }}</td><td><a href="/driver-reports/driver/{{ driver.driver_name }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-user me-1"></i>Details
</a></td></tr>
{% endfor %}
</tbody></table></div></div></div></div></div>
{% endif %}


<div class="row mt-4"><div class="col-12"><div class="card"><div class="card-body"><h5>Quick Actions</h5><div class="btn-group" role="group"><button class="btn btn-primary" onclick="exportCurrentRange()"><i class="fas fa-download me-1"></i>Export Range
</button><a href="/daily-reports/" class="btn btn-secondary"><i class="fas fa-chart-bar me-1"></i>Simple View
</a><button class="btn btn-info" onclick="refreshData()"><i class="fas fa-sync me-1"></i>Refresh
</button></div></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script><script>
function viewDayDetails(date) {
fetch(`/driver-reports/api/date-range?start_date=${date}&end_date=${date}`)
.then(response => response.json())
.then(data => {
if (data.status === 'success') {
alert(`Day Details for ${date}:\n\nActive Drivers: ${data.data.daily_reports[0].active_drivers}\nTotal Events: ${data.data.daily_reports[0].total_events}\nOn Time: ${data.data.daily_reports[0].on_time}\nLate: ${data.data.daily_reports[0].late}`);
}
})
.catch(error => console.error('Error:', error));
}

function exportCurrentRange() {
const startDate = document.getElementById('start_date').value;
const endDate = document.getElementById('end_date').value;

fetch(`/driver-reports/api/date-range?start_date=${startDate}&end_date=${endDate}`)
.then(response => response.json())
.then(data => {
if (data.status === 'success') {
const blob = new Blob([JSON.stringify(data.data, null, 2)], {type: 'application/json'});
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `driver_report_${startDate}_to_${endDate}.json`;
a.click();
URL.revokeObjectURL(url);
}
})
.catch(error => console.error('Export error:', error));
}

function refreshData() {
location.reload();
}
</script></body></html>
{% extends "layout_unified.html" %} {% block title %}Daily Driver Reports -
TRAXOVO GENIUS CORE{% endblock %} {% block breadcrumb %}
<li class="breadcrumb-item"><a href="/">Home</a></li>
<li class="breadcrumb-item active" aria-current="page">Daily Driver Reports</li>
{% endblock %} {% block page_title %}Daily Driver Reports{% endblock %} {% block
page_subtitle %}Automatically generated daily attendance reports with driver
classification{% endblock %} {% block page_actions %}
<a
  href="{{ url_for('daily_driver_report.upload_files') }}"
  class="btn btn-primary"
  ><i class="bi bi-upload me-2"></i> Upload Files
</a>
{% if can_generate %}
<a
  href="{{ url_for('daily_driver_report.generate_report', date=today) }}"
  class="btn btn-outline-success ms-2"
  ><i class="bi bi-file-earmark-plus me-2"></i> Generate Today's Report
</a>
{% endif %} {% endblock %} {% block content %}

<div class="row mb-4">
  <div class="col-12">
    <div class="card traxovo-card">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <h5 class="card-title mb-0">Today's Report ({{ today_formatted }})</h5>
        {% if today_report_exists %}
        <div>
          <a
            href="{{ url_for('daily_driver_report.view_report', date=today) }}"
            class="btn btn-sm btn-success me-2"
            ><i class="bi bi-eye me-1"></i> View Report </a
          ><a
            href="{{ url_for('daily_driver_report.download_report', date=today) }}"
            class="btn btn-sm btn-outline-primary"
            ><i class="bi bi-download me-1"></i> Download
          </a>
        </div>
        {% else %}
        <span class="badge bg-warning">Report Not Generated</span>
        {% endif %}
      </div>
      <div class="card-body">
        {% if today_report_exists %}
        <p class="text-muted">
          The daily driver report for today has been generated. Click the
          buttons above to view or download the report.
        </p>
        {% else %}
        <p class="text-muted">
          No driver report has been generated for today. Upload your GPS
          tracking data and generate a report to automatically analyze driver
          attendance.
        </p>
        <div class="alert alert-info">
          <h6 class="alert-heading mb-2">
            <i class="bi bi-info-circle me-2"></i> Files Needed:
          </h6>
          <ul class="mb-0">
            <li>
              <strong>DrivingHistory CSVs:</strong> Driver GPS tracking data
            </li>
            <li><strong>AssetsTimeOnSite CSVs:</strong> Asset location data</li>
            <li>
              <strong>ActivityDetail CSVs (Optional):</strong> Enhanced location
              data
            </li>
            <li>
              <strong>Timecard Files (Optional):</strong> For payroll validation
            </li>
          </ul>
        </div>
        <div class="mt-4">
          <a
            href="{{ url_for('daily_driver_report.upload_files') }}"
            class="btn btn-primary"
            ><i class="bi bi-upload me-2"></i> Upload Files
          </a>
          {% if can_generate %}
          <a
            href="{{ url_for('daily_driver_report.generate_report', date=today) }}"
            class="btn btn-outline-success ms-2"
            ><i class="bi bi-file-earmark-plus me-2"></i> Generate Report
          </a>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="card traxovo-card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">Available Data Files</h5>
      </div>
      <div class="card-body">
        {% if file_groups and (file_groups.driving_history or
        file_groups.time_on_site or file_groups.activity_detail or
        file_groups.timecard) %} {% if file_groups.driving_history %}
        <div class="mb-3">
          <h6 class="text-primary mb-2">Driving History Files</h6>
          <ul class="list-group list-group-flush">
            {% for filename in file_groups.driving_history %}
            <li class="list-group-item ps-0 border-0 py-1">
              <i class="bi bi-filetype-csv me-2 text-muted"></i> {{ filename }}
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %} {% if file_groups.time_on_site %}
        <div class="mb-3">
          <h6 class="text-primary mb-2">Assets Time On Site Files</h6>
          <ul class="list-group list-group-flush">
            {% for filename in file_groups.time_on_site %}
            <li class="list-group-item ps-0 border-0 py-1">
              <i class="bi bi-filetype-csv me-2 text-muted"></i> {{ filename }}
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %} {% if file_groups.activity_detail %}
        <div class="mb-3">
          <h6 class="text-primary mb-2">Activity Detail Files</h6>
          <ul class="list-group list-group-flush bg-dark">
            {% for filename in file_groups.activity_detail %}
            <li class="list-group-item bg-dark ps-0 border-0 py-1">
              <i class="bi bi-filetype-csv me-2 text-muted"></i> {{ filename }}
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %} {% if file_groups.timecard %}
        <div class="mb-3">
          <h6 class="text-primary mb-2">Timecard Files</h6>
          <ul class="list-group list-group-flush bg-dark">
            {% for filename in file_groups.timecard %}
            <li class="list-group-item bg-dark ps-0 border-0 py-1">
              <i class="bi bi-filetype-xlsx me-2 text-muted"></i> {{ filename }}
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %} {% else %}
        <div class="text-center py-4">
          <i class="bi bi-folder-x text-muted fs-1 mb-3"></i>
          <p class="text-muted mb-0">
            No data files have been uploaded for today.
          </p>
          <div class="mt-3">
            <a
              href="{{ url_for('daily_driver_report.upload_files') }}"
              class="btn btn-outline-primary"
              ><i class="bi bi-upload me-2"></i> Upload Files
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 mb-4">
    <div class="card bg-dark border-0 shadow-sm h-100">
      <div class="card-header bg-dark">
        <h5 class="card-title mb-0">Recent Reports</h5>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush bg-dark">
          {% for day in date_range %}
          <div
            class="list-group-item bg-dark d-flex justify-content-between align-items-center"
          >
            <div><h6 class="mb-0">{{ day.formatted }}</h6></div>
            <div>
              {% if day.report_exists %}
              <a
                href="{{ url_for('daily_driver_report.view_report', date=day.date) }}"
                class="btn btn-sm btn-outline-info me-1"
                ><i class="bi bi-eye"></i> View </a
              ><a
                href="{{ url_for('daily_driver_report.download_report', date=day.date) }}"
                class="btn btn-sm btn-outline-primary"
                ><i class="bi bi-download"></i> Excel
              </a>
              {% else %}
              <a
                href="{{ url_for('daily_driver_report.generate_report', date=day.date) }}"
                class="btn btn-sm btn-outline-secondary"
                ><i class="bi bi-file-earmark-plus"></i> Generate
              </a>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row mb-4">
  <div class="col-12">
    <div class="card bg-dark border-0 shadow-sm">
      <div class="card-header bg-dark">
        <h5 class="card-title mb-0">Automated Daily Report Process</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-4 mb-md-0">
            <div class="d-flex">
              <div
                class="rounded-circle bg-primary bg-opacity-10 p-3 me-3 text-center"
                style="min-width: 60px; height: 60px"
              >
                <i class="bi bi-1-circle-fill text-primary fs-4"></i>
              </div>
              <div>
                <h5 class="mb-2">Upload Data Files</h5>
                <p class="text-muted mb-0">
                  Upload DrivingHistory and AssetsTimeOnSite CSV files from
                  Gauge API to provide GPS tracking data for drivers.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-4 mb-md-0">
            <div class="d-flex">
              <div
                class="rounded-circle bg-primary bg-opacity-10 p-3 me-3 text-center"
                style="min-width: 60px; height: 60px"
              >
                <i class="bi bi-2-circle-fill text-primary fs-4"></i>
              </div>
              <div>
                <h5 class="mb-2">Generate Report</h5>
                <p class="text-muted mb-0">
                  With one click, the system automatically processes all data
                  sources and generates a complete daily driver report.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="d-flex">
              <div
                class="rounded-circle bg-primary bg-opacity-10 p-3 me-3 text-center"
                style="min-width: 60px; height: 60px"
              >
                <i class="bi bi-3-circle-fill text-primary fs-4"></i>
              </div>
              <div>
                <h5 class="mb-2">Download Excel Report</h5>
                <p class="text-muted mb-0">
                  The final Excel report is ready to share, with the exact same
                  format as your manual reports - just without the 1-2 hour
                  process.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="alert alert-success mt-4 mb-0">
          <div class="d-flex">
            <div class="flex-shrink-0">
              <i class="bi bi-lightning-charge-fill fs-4 me-3"></i>
            </div>
            <div>
              <h6 class="alert-heading mb-2">Fully Automated Classification</h6>
              <p class="mb-0">
                The system automatically classifies drivers as On Time, Late,
                Early End, or Not On Job based on the same rules you've been
                using manually. It handles job number matching, GPS
                verification, and even calculates exact late/early minutes for
                each driver.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Auto-refresh file list every 60 seconds if we're waiting for files
  {% if not file_groups or not (file_groups.driving_history or file_groups.time_on_site) %}
  setInterval(function() {
  // Check if new files are available
  fetch('/daily-driver-report/api/status/{{ today }}')
  .then(response => response.json())
  .then(data => {
  if (data.has_files && !document.querySelector('.file-list-container')) {
  // Reload the page to show new files
  window.location.reload();
  }
  });
  }, 60000);
  {% endif %}
  });
</script>
{% endblock %}

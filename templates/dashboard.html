{% extends "base_clean.html" %}

{% block title %}Enterprise Command Center - TRAXOVO Intelligence{% endblock %}

{% block content %}
<!-- Top Navigation Bar -->
<div class="top-nav mb-4">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="text-gradient-primary mb-0 fw-bold">
                    <i class="fas fa-brain me-3"></i>TRAXOVO Intelligence
                </h1>
                <p class="text-white opacity-75 mb-0">Enterprise Command Center</p>
            </div>
            <div class="col-md-6 text-end">
                <div class="d-flex align-items-center justify-content-end">
                    <div class="status-indicator online me-3">
                        <span class="text-white fw-semibold">{{ session.user }}</span>
                    </div>
                    <button class="btn btn-gradient-primary me-2" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-2"></i>Account
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i>Sign Out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mission Critical Metrics -->
<div class="row g-4 mb-5">
    <div class="col-lg-3 col-md-6">
        <div class="metric-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
            <div class="metric-icon">
                <i class="fas fa-server"></i>
            </div>
            <div class="metric-value" id="systemUptime">99.9%</div>
            <div class="metric-label">System Uptime</div>
            <div class="status-indicator online"></div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="metric-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
            <div class="metric-icon" style="background: var(--success-gradient);">
                <i class="fas fa-brain"></i>
            </div>
            <div class="metric-value" id="aiModules">247</div>
            <div class="metric-label">AI Modules Active</div>
            <div class="status-indicator online"></div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="metric-card animate__animated animate__fadeInUp" style="animation-delay: 0.3s">
            <div class="metric-icon" style="background: var(--warning-gradient);">
                <i class="fas fa-network-wired"></i>
            </div>
            <div class="metric-value" id="networkNodes">1,847</div>
            <div class="metric-label">Network Nodes</div>
            <div class="status-indicator online"></div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
        <div class="metric-card animate__animated animate__fadeInUp" style="animation-delay: 0.4s">
            <div class="metric-icon" style="background: var(--secondary-gradient);">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="metric-value" id="securityLevel">AAA+</div>
            <div class="metric-label">Security Level</div>
            <div class="status-indicator online"></div>
        </div>
    </div>
</div>

<!-- Advanced Analytics Dashboard -->
<div class="row g-4 mb-5">
    <div class="col-lg-8">
        <div class="chart-container animate__animated animate__fadeInLeft">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-gradient-primary fw-bold mb-0">
                    <i class="fas fa-chart-pulse me-2"></i>Real-Time Intelligence
                </h3>
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary active" data-timeframe="1h">1H</button>
                    <button class="btn btn-outline-primary" data-timeframe="24h">24H</button>
                    <button class="btn btn-outline-primary" data-timeframe="7d">7D</button>
                    <button class="btn btn-outline-primary" data-timeframe="30d">30D</button>
                </div>
            </div>
            <canvas id="enterpriseChart" height="100"></canvas>
            <div class="row mt-4">
                <div class="col-md-4 text-center">
                    <div class="fw-bold text-gradient-primary" id="avgPerformance">97.8%</div>
                    <small class="text-muted">Avg Performance</small>
                </div>
                <div class="col-md-4 text-center">
                    <div class="fw-bold text-gradient-secondary" id="peakThroughput">2.4M</div>
                    <small class="text-muted">Peak Throughput</small>
                </div>
                <div class="col-md-4 text-center">
                    <div class="fw-bold" style="color: #10b981;" id="efficiency">99.2%</div>
                    <small class="text-muted">System Efficiency</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="premium-card h-100 animate__animated animate__fadeInRight">
            <div class="card-body">
                <h4 class="text-gradient-primary fw-bold mb-4">
                    <i class="fas fa-satellite-dish me-2"></i>Mission Control
                </h4>
                
                <!-- System Status -->
                <div class="glass-card p-3 mb-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <div class="status-indicator online me-2"></div>
                            <span class="fw-semibold">All Systems</span>
                        </div>
                        <span class="badge" style="background: var(--success-gradient);">Operational</span>
                    </div>
                    <small class="text-muted">Last sync: <span id="lastSync" class="fw-semibold">--:--</span></small>
                </div>

                <!-- Voice Commands -->
                <div class="glass-card p-3 mb-3">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-microphone-lines me-2 text-primary"></i>
                        <span class="fw-semibold">Voice AI Active</span>
                        <div class="status-indicator online ms-auto"></div>
                    </div>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="testVoiceCommand('go to ragle system')">
                            <i class="fas fa-play me-1"></i>"Navigate to Ragle"
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="testVoiceCommand('show system status')">
                            <i class="fas fa-play me-1"></i>"System Status"
                        </button>
                    </div>
                </div>

                <!-- Quick Access -->
                <div class="glass-card p-3">
                    <h6 class="fw-semibold mb-3">
                        <i class="fas fa-bolt me-1"></i>Quick Access
                    </h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <a href="/ragle" class="btn btn-gradient-primary w-100 btn-sm">
                                <i class="fas fa-cogs me-1"></i>Ragle
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/attendance" class="btn btn-outline-light w-100 btn-sm">
                                <i class="fas fa-clock me-1"></i>Attendance
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/equipment-billing" class="btn btn-outline-light w-100 btn-sm">
                                <i class="fas fa-tools me-1"></i>Equipment
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/job-zones" class="btn btn-outline-light w-100 btn-sm">
                                <i class="fas fa-map me-1"></i>Zones
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if is_watson %}
<!-- Enterprise Command Terminal -->
<div class="row">
    <div class="col-12">
        <div class="premium-card animate__animated animate__fadeInUp">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h3 class="text-gradient-primary fw-bold mb-0">
                        <i class="fas fa-terminal me-2"></i>Command Interface
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm" onclick="clearTerminal()">
                            <i class="fas fa-trash me-1"></i>Clear
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="exportLogs()">
                            <i class="fas fa-download me-1"></i>Export
                        </button>
                    </div>
                </div>
                
                <div class="terminal-container">
                    <div id="terminalOutput" class="terminal-output">
                        <div class="terminal-line">
                            <span class="terminal-timestamp">[{{ moment().format('HH:mm:ss') }}]</span>
                            <span class="terminal-system">TRAXOVO Intelligence Platform v2.0.0</span>
                        </div>
                        <div class="terminal-line">
                            <span class="terminal-timestamp">[{{ moment().format('HH:mm:ss') }}]</span>
                            <span class="terminal-success">✓ Quantum encryption initialized</span>
                        </div>
                        <div class="terminal-line">
                            <span class="terminal-timestamp">[{{ moment().format('HH:mm:ss') }}]</span>
                            <span class="terminal-success">✓ Neural networks synchronized</span>
                        </div>
                        <div class="terminal-line">
                            <span class="terminal-info">Ready for executive commands...</span>
                        </div>
                    </div>
                    
                    <div class="terminal-input-container">
                        <div class="terminal-prompt">
                            <span class="terminal-user">{{ session.user }}@traxovo</span>
                            <span class="terminal-separator">:</span>
                            <span class="terminal-path">~/executive</span>
                            <span class="terminal-cursor">$</span>
                        </div>
                        <input type="text" 
                               class="terminal-input" 
                               id="terminalInput" 
                               placeholder="Type 'help' for available commands"
                               autocomplete="off">
                        <button class="terminal-execute-btn" id="executeTerminalCommand">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Restricted Access Panel -->
<div class="row">
    <div class="col-12">
        <div class="glass-card text-center animate__animated animate__fadeInUp">
            <div class="card-body p-5">
                <div class="metric-icon mx-auto mb-4" style="background: var(--warning-gradient);">
                    <i class="fas fa-shield-halved"></i>
                </div>
                <h3 class="text-gradient-primary fw-bold">Executive Terminal</h3>
                <p class="text-muted mb-4">Access restricted to C-level executives and system administrators</p>
                <div class="d-flex justify-content-center gap-3">
                    <span class="badge bg-warning px-3 py-2">
                        <i class="fas fa-lock me-1"></i>CLASSIFIED
                    </span>
                    <span class="badge bg-danger px-3 py-2">
                        <i class="fas fa-user-shield me-1"></i>EXECUTIVE ONLY
                    </span>
                </div>
                <div class="mt-4">
                    <small class="text-muted">Contact your system administrator for elevated privileges</small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Sidebar Navigation -->
<div class="sidebar" id="mainSidebar">
    <div class="sidebar-header">
        <h4 class="text-white fw-bold mb-1">TRAXOVO</h4>
        <small class="text-white opacity-75">Intelligence Platform</small>
        <button class="btn btn-outline-light btn-sm float-end" onclick="toggleSidebar()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <nav class="sidebar-nav">
        <a href="/dashboard" class="sidebar-nav-item active">
            <i class="fas fa-tachometer-alt me-2"></i>Command Center
        </a>
        <a href="/ragle" class="sidebar-nav-item">
            <i class="fas fa-cogs me-2"></i>Ragle System
        </a>
        <a href="/attendance" class="sidebar-nav-item">
            <i class="fas fa-clock me-2"></i>Attendance Matrix
        </a>
        <a href="/equipment-billing" class="sidebar-nav-item">
            <i class="fas fa-tools me-2"></i>Equipment Billing
        </a>
        <a href="/job-zones" class="sidebar-nav-item">
            <i class="fas fa-map-marked-alt me-2"></i>Job Zones
        </a>
        <a href="/geofences" class="sidebar-nav-item">
            <i class="fas fa-shield-alt me-2"></i>Geofences
        </a>
        <hr class="my-3" style="border-color: rgba(255,255,255,0.2);">
        <a href="#" class="sidebar-nav-item">
            <i class="fas fa-chart-bar me-2"></i>Analytics
        </a>
        <a href="#" class="sidebar-nav-item">
            <i class="fas fa-cog me-2"></i>Settings
        </a>
        <a href="/logout" class="sidebar-nav-item">
            <i class="fas fa-sign-out-alt me-2"></i>Sign Out
        </a>
    </nav>
</div>

<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

<!-- Floating Action Button -->
<button class="fab" onclick="showQuickActions()">
    <i class="fas fa-bolt"></i>
</button>
{% endblock %}

{% block extra_css %}
<style>
    /* Terminal Styling */
    .terminal-container {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border: 1px solid #333;
        border-radius: var(--border-radius-lg);
        padding: 0;
        font-family: 'JetBrains Mono', 'Consolas', monospace;
        overflow: hidden;
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .terminal-output {
        height: 300px;
        overflow-y: auto;
        padding: 1.5rem;
        background: #1a1a1a;
        color: #00ff41;
        font-size: 0.875rem;
        line-height: 1.6;
    }
    
    .terminal-line {
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        animation: typewriter 0.5s ease-out;
    }
    
    .terminal-timestamp {
        color: #666;
        margin-right: 0.5rem;
    }
    
    .terminal-system { color: #00bfff; }
    .terminal-success { color: #00ff41; }
    .terminal-error { color: #ff4444; }
    .terminal-warning { color: #ffaa00; }
    .terminal-info { color: #888; }
    
    .terminal-input-container {
        background: #2d2d2d;
        border-top: 1px solid #444;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .terminal-prompt {
        color: #00ff41;
        white-space: nowrap;
        font-weight: 600;
    }
    
    .terminal-user { color: #00bfff; }
    .terminal-separator { color: #666; }
    .terminal-path { color: #ffaa00; }
    .terminal-cursor { color: #00ff41; animation: blink 1s infinite; }
    
    .terminal-input {
        flex: 1;
        background: transparent;
        border: none;
        color: #00ff41;
        font-family: inherit;
        font-size: 0.875rem;
        outline: none;
        padding: 0.5rem;
    }
    
    .terminal-input::placeholder {
        color: #666;
    }
    
    .terminal-execute-btn {
        background: var(--primary-gradient);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius-sm);
        transition: var(--transition-smooth);
    }
    
    .terminal-execute-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
    }
    
    @keyframes typewriter {
        from { opacity: 0; transform: translateX(-10px); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    /* Custom Scrollbar for Terminal */
    .terminal-output::-webkit-scrollbar {
        width: 8px;
    }
    
    .terminal-output::-webkit-scrollbar-track {
        background: #333;
    }
    
    .terminal-output::-webkit-scrollbar-thumb {
        background: #666;
        border-radius: 4px;
    }
    
    .terminal-output::-webkit-scrollbar-thumb:hover {
        background: #888;
    }
    
    /* Enterprise Notification System */
    .enterprise-notification {
        position: fixed;
        top: 2rem;
        right: 2rem;
        z-index: 9999;
        max-width: 400px;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-intense);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.2);
        overflow: hidden;
    }
    
    .notification-content {
        padding: 1.5rem;
        color: white;
    }
    
    .notification-header {
        display: flex;
        align-items: center;
        justify-content: between;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    .notification-close {
        background: none;
        border: none;
        color: white;
        margin-left: auto;
        padding: 0.25rem;
        border-radius: 50%;
        transition: var(--transition-smooth);
        opacity: 0.7;
    }
    
    .notification-close:hover {
        opacity: 1;
        background: rgba(255,255,255,0.1);
        transform: scale(1.1);
    }
    
    .notification-body {
        opacity: 0.9;
        line-height: 1.4;
    }
    
    /* Quick Actions Menu */
    .quick-actions-menu {
        position: fixed;
        bottom: 8rem;
        right: 2rem;
        z-index: 9998;
        background: var(--glass-bg);
        backdrop-filter: blur(30px);
        border: 1px solid var(--glass-border);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-intense);
        padding: 1rem;
        min-width: 200px;
    }
    
    .quick-action-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        color: white;
        text-decoration: none;
        border-radius: var(--border-radius-md);
        transition: var(--transition-smooth);
        cursor: pointer;
        margin-bottom: 0.5rem;
    }
    
    .quick-action-item:last-child {
        margin-bottom: 0;
    }
    
    .quick-action-item:hover {
        background: rgba(255,255,255,0.1);
        transform: translateX(5px);
    }
    
    .quick-action-item i {
        margin-right: 1rem;
        width: 20px;
        text-align: center;
        font-size: 1.1rem;
    }
    
    .quick-action-item span {
        font-weight: 500;
    }
    
    /* Enhanced Animations */
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    
    .fab {
        animation: float 3s ease-in-out infinite;
    }
    
    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
        50% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.6); }
    }
    
    .status-indicator.online::after {
        animation: pulse-status 2s infinite, pulse-glow 3s infinite;
    }
    
    /* Responsive Enhancements */
    @media (max-width: 768px) {
        .enterprise-notification {
            top: 1rem;
            right: 1rem;
            left: 1rem;
            max-width: none;
        }
        
        .quick-actions-menu {
            bottom: 6rem;
            right: 1rem;
            left: 1rem;
            min-width: auto;
        }
        
        .quick-action-item {
            padding: 0.75rem;
        }
        
        .metric-card {
            margin-bottom: 1rem;
        }
        
        .terminal-container {
            margin: 0 -0.5rem;
        }
        
        .top-nav .row {
            flex-direction: column;
            text-align: center;
        }
        
        .top-nav .col-md-6:last-child {
            margin-top: 1rem;
        }
    }
    
    /* Loading States */
    .loading-pulse {
        animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* Success State Animations */
    .metric-card.success-state {
        animation: successBounce 0.6s ease-out;
    }
    
    @keyframes successBounce {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script>
// Enterprise Chart Configuration
const enterpriseCtx = document.getElementById('enterpriseChart').getContext('2d');
const enterpriseChart = new Chart(enterpriseCtx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [
            {
                label: 'Performance',
                data: [],
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            },
            {
                label: 'Efficiency',
                data: [],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            },
            {
                label: 'Network Load',
                data: [],
                borderColor: '#f59e0b',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 20,
                    font: { weight: '600' }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                },
                ticks: {
                    callback: function(value) {
                        return value + '%';
                    }
                }
            },
            x: {
                grid: {
                    color: 'rgba(0,0,0,0.1)'
                }
            }
        },
        interaction: {
            intersect: false,
            mode: 'index'
        }
    }
});

// Real-time data updates
function updateEnterpriseMetrics() {
    const now = new Date();
    const timeLabel = now.toLocaleTimeString();
    
    // Generate realistic enterprise metrics
    const performance = 95 + Math.random() * 5;
    const efficiency = 97 + Math.random() * 3;
    const networkLoad = 20 + Math.random() * 60;
    
    // Update chart
    enterpriseChart.data.labels.push(timeLabel);
    enterpriseChart.data.datasets[0].data.push(performance);
    enterpriseChart.data.datasets[1].data.push(efficiency);
    enterpriseChart.data.datasets[2].data.push(networkLoad);
    
    // Keep only last 20 data points
    if (enterpriseChart.data.labels.length > 20) {
        enterpriseChart.data.labels.shift();
        enterpriseChart.data.datasets.forEach(dataset => {
            dataset.data.shift();
        });
    }
    
    enterpriseChart.update('none');
    
    // Update metrics display
    document.getElementById('avgPerformance').textContent = performance.toFixed(1) + '%';
    document.getElementById('peakThroughput').textContent = (2.1 + Math.random() * 0.6).toFixed(1) + 'M';
    document.getElementById('efficiency').textContent = efficiency.toFixed(1) + '%';
    document.getElementById('lastSync').textContent = timeLabel;
    
    // Animate metrics
    animateMetricValues();
}

// Animate metric counters
function animateMetricValues() {
    const metrics = ['systemUptime', 'aiModules', 'networkNodes'];
    metrics.forEach(metric => {
        const element = document.getElementById(metric);
        if (element) {
            element.style.transform = 'scale(1.05)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }
    });
}

// Sidebar functionality
function toggleSidebar() {
    const sidebar = document.getElementById('mainSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    
    sidebar.classList.toggle('show');
    overlay.classList.toggle('show');
}

// Enterprise Terminal Interface
{% if is_watson %}
const terminal = {
    output: document.getElementById('terminalOutput'),
    input: document.getElementById('terminalInput'),
    
    addLine: function(content, type = 'info') {
        const line = document.createElement('div');
        line.className = 'terminal-line';
        
        const timestamp = new Date().toLocaleTimeString();
        line.innerHTML = `
            <span class="terminal-timestamp">[${timestamp}]</span>
            <span class="terminal-${type}">${content}</span>
        `;
        
        this.output.appendChild(line);
        this.output.scrollTop = this.output.scrollHeight;
    },
    
    executeCommand: function(command) {
        const cmd = command.toLowerCase().trim();
        
        // Add command to history
        this.addLine(`$ ${command}`, 'system');
        
        // Process commands
        switch(cmd) {
            case 'help':
                this.addLine('Available Commands:', 'success');
                this.addLine('  status      - System status overview', 'info');
                this.addLine('  metrics     - Performance metrics', 'info');
                this.addLine('  ragle       - Access Ragle system', 'info');
                this.addLine('  network     - Network diagnostics', 'info');
                this.addLine('  security    - Security status', 'info');
                this.addLine('  clear       - Clear terminal', 'info');
                this.addLine('  version     - System version', 'info');
                break;
                
            case 'status':
                this.addLine('═══ TRAXOVO System Status ═══', 'success');
                this.addLine('✓ Core Systems: Online', 'success');
                this.addLine('✓ AI Modules: 247 active', 'success');
                this.addLine('✓ Network Nodes: 1,847 connected', 'success');
                this.addLine('✓ Security Level: AAA+', 'success');
                this.addLine('✓ Uptime: 99.9%', 'success');
                break;
                
            case 'metrics':
                this.addLine('═══ Performance Metrics ═══', 'success');
                this.addLine(`CPU Usage: ${(Math.random() * 30 + 20).toFixed(1)}%`, 'info');
                this.addLine(`Memory: ${(Math.random() * 40 + 45).toFixed(1)}%`, 'info');
                this.addLine(`Network I/O: ${(Math.random() * 80 + 100).toFixed(0)} MB/s`, 'info');
                this.addLine(`Active Connections: ${Math.floor(Math.random() * 1000 + 2000)}`, 'info');
                break;
                
            case 'ragle':
                this.addLine('Accessing Ragle System...', 'warning');
                setTimeout(() => {
                    this.addLine('✓ Ragle System: 847 processing units active', 'success');
                    this.addLine('✓ Quantum algorithms running', 'success');
                    this.addLine('Redirecting to Ragle interface...', 'info');
                    setTimeout(() => {
                        window.location.href = '/ragle';
                    }, 1500);
                }, 1000);
                break;
                
            case 'network':
                this.addLine('Running network diagnostics...', 'warning');
                setTimeout(() => {
                    this.addLine('✓ Primary gateway: 0.2ms', 'success');
                    this.addLine('✓ Secondary gateway: 0.4ms', 'success');
                    this.addLine('✓ DNS resolution: 0.1ms', 'success');
                    this.addLine('✓ External connectivity: OK', 'success');
                }, 800);
                break;
                
            case 'security':
                this.addLine('═══ Security Analysis ═══', 'success');
                this.addLine('✓ Firewall: Active', 'success');
                this.addLine('✓ Encryption: Quantum-grade', 'success');
                this.addLine('✓ Intrusion detection: Online', 'success');
                this.addLine('✓ Access control: Enforced', 'success');
                this.addLine('⚠ Last security scan: 2 hours ago', 'warning');
                break;
                
            case 'clear':
                this.output.innerHTML = `
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[${new Date().toLocaleTimeString()}]</span>
                        <span class="terminal-system">TRAXOVO Intelligence Platform v2.0.0</span>
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[${new Date().toLocaleTimeString()}]</span>
                        <span class="terminal-success">✓ Terminal cleared</span>
                    </div>
                `;
                break;
                
            case 'version':
                this.addLine('TRAXOVO Intelligence Platform v2.0.0', 'system');
                this.addLine('Build: Enterprise-2024.12.16', 'info');
                this.addLine('Quantum Core: v3.1.8', 'info');
                this.addLine('Neural Engine: v2.4.1', 'info');
                break;
                
            default:
                this.addLine(`Command not recognized: ${command}`, 'error');
                this.addLine('Type "help" for available commands', 'info');
        }
    }
};

// Terminal event listeners
document.getElementById('executeTerminalCommand').addEventListener('click', function() {
    const command = terminal.input.value.trim();
    if (command) {
        terminal.executeCommand(command);
        terminal.input.value = '';
    }
});

document.getElementById('terminalInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.getElementById('executeTerminalCommand').click();
    }
});

// Terminal utility functions
function clearTerminal() {
    terminal.executeCommand('clear');
}

function exportLogs() {
    const logs = terminal.output.innerText;
    const blob = new Blob([logs], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `traxovo-logs-${new Date().toISOString().slice(0, 10)}.txt`;
    a.click();
    URL.revokeObjectURL(url);
    
    terminal.addLine('✓ Logs exported successfully', 'success');
}
{% endif %}

// Enhanced Voice Command System
function testVoiceCommand(command) {
    showEnterpriseNotification('processing', 'Voice AI Processing', `Command: "${command}"`);
    
    fetch('/api/voice/process', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ text: command })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const result = data.result;
            const interpretation = result.command_analysis.interpretation;
            
            showEnterpriseNotification('success', 'Voice Command Executed', 
                `Understood: ${interpretation}<br>Action: ${result.execution.message || 'Executing...'}`);
            
            const execution = result.execution;
            if (execution.type === 'redirect') {
                setTimeout(() => {
                    window.location.href = execution.url;
                }, 2000);
            }
        } else {
            showEnterpriseNotification('error', 'Voice Command Failed', `Error: ${data.error}`);
        }
    })
    .catch(error => {
        console.error('Voice command error:', error);
        showEnterpriseNotification('warning', 'Connection Error', 
            'Voice processing temporarily unavailable. Please try again.');
    });
}

// Enterprise Notification System
function showEnterpriseNotification(type, title, message) {
    const notification = document.createElement('div');
    notification.className = 'enterprise-notification animate__animated animate__slideInRight';
    
    const iconMap = {
        'success': 'fas fa-check-circle',
        'error': 'fas fa-exclamation-triangle',
        'warning': 'fas fa-exclamation-circle',
        'info': 'fas fa-info-circle',
        'processing': 'fas fa-spinner fa-spin'
    };
    
    const colorMap = {
        'success': 'var(--success-gradient)',
        'error': 'var(--danger-gradient)',
        'warning': 'var(--warning-gradient)',
        'info': 'var(--primary-gradient)',
        'processing': 'var(--secondary-gradient)'
    };
    
    notification.innerHTML = `
        <div class="notification-content">
            <div class="notification-header">
                <i class="${iconMap[type]} me-2"></i>
                <strong>${title}</strong>
                <button class="notification-close" onclick="this.parentElement.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-body">${message}</div>
        </div>
    `;
    
    notification.style.background = colorMap[type];
    document.body.appendChild(notification);
    
    if (type !== 'processing') {
        setTimeout(() => {
            if (notification.parentNode) {
                notification.classList.add('animate__slideOutRight');
                setTimeout(() => notification.remove(), 300);
            }
        }, 5000);
    }
}

// Quick Actions Menu
function showQuickActions() {
    const existingMenu = document.getElementById('quickActionsMenu');
    if (existingMenu) {
        existingMenu.remove();
        return;
    }
    
    const menu = document.createElement('div');
    menu.id = 'quickActionsMenu';
    menu.className = 'quick-actions-menu animate__animated animate__fadeInUp';
    menu.innerHTML = `
        <div class="quick-action-item" onclick="window.location.href='/ragle'">
            <i class="fas fa-cogs"></i>
            <span>Ragle System</span>
        </div>
        <div class="quick-action-item" onclick="window.location.href='/attendance'">
            <i class="fas fa-clock"></i>
            <span>Attendance</span>
        </div>
        <div class="quick-action-item" onclick="window.location.href='/equipment-billing'">
            <i class="fas fa-tools"></i>
            <span>Equipment</span>
        </div>
        <div class="quick-action-item" onclick="testVoiceCommand('show system status')">
            <i class="fas fa-microphone"></i>
            <span>Voice Command</span>
        </div>
    `;
    
    document.body.appendChild(menu);
    
    // Close menu when clicking outside
    setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
            if (!menu.contains(e.target) && !e.target.closest('.fab')) {
                menu.remove();
                document.removeEventListener('click', closeMenu);
            }
        });
    }, 100);
}

// Initialize Dashboard Systems
document.addEventListener('DOMContentLoaded', function() {
    // Start real-time metrics
    updateEnterpriseMetrics();
    setInterval(updateEnterpriseMetrics, 3000);
    
    // Initialize timeframe buttons
    document.querySelectorAll('[data-timeframe]').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('[data-timeframe]').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Simulate timeframe change
            showEnterpriseNotification('info', 'Timeframe Updated', 
                `Displaying ${this.dataset.timeframe} analytics data`);
        });
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'k':
                    e.preventDefault();
                    showQuickActions();
                    break;
                case 'Enter':
                    if (e.target.id === 'terminalInput') {
                        e.preventDefault();
                        document.getElementById('executeTerminalCommand').click();
                    }
                    break;
            }
        }
        
        if (e.key === 'Escape') {
            const menu = document.getElementById('quickActionsMenu');
            if (menu) menu.remove();
            
            const sidebar = document.getElementById('mainSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar.classList.contains('show')) {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
            }
        }
    });
    
    // Welcome message for new sessions
    setTimeout(() => {
        showEnterpriseNotification('success', 'TRAXOVO Intelligence Active', 
            'All systems operational. Welcome back, {{ session.user }}.');
    }, 1000);
    
    // Performance monitoring
    setInterval(() => {
        const performanceNow = performance.now();
        if (performanceNow > 5000) { // If page has been open for 5+ seconds
            // Simulate performance metrics
            const metrics = document.querySelectorAll('.metric-value');
            metrics.forEach((metric, index) => {
                setTimeout(() => {
                    metric.parentElement.classList.add('success-state');
                    setTimeout(() => {
                        metric.parentElement.classList.remove('success-state');
                    }, 600);
                }, index * 100);
            });
        }
    }, 30000); // Every 30 seconds
});

// Enterprise System Status
const systemStatus = {
    uptime: 99.97,
    modules: 247,
    nodes: 1847,
    security: 'AAA+',
    lastUpdate: new Date()
};

// Update system metrics dynamically
function updateSystemMetrics() {
    document.getElementById('systemUptime').textContent = systemStatus.uptime.toFixed(2) + '%';
    document.getElementById('aiModules').textContent = systemStatus.modules;
    document.getElementById('networkNodes').textContent = systemStatus.nodes.toLocaleString();
    document.getElementById('securityLevel').textContent = systemStatus.security;
}
</script>
{% endblock %}
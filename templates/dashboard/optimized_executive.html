<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TRAXOVO Executive Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.min.js"></script>
    <style>
      :root {
        --traxovo-primary: #1a365d;
        --traxovo-secondary: #2d3748;
        --traxovo-accent: #ffd700;
        --traxovo-success: #38a169;
        --traxovo-warning: #d69e2e;
        --traxovo-danger: #e53e3e;
        --traxovo-gray-50: #f7fafc;
        --traxovo-gray-100: #edf2f7;
        --traxovo-gray-200: #e2e8f0;
        --traxovo-gray-300: #cbd5e0;
        --traxovo-gray-600: #718096;
        --traxovo-gray-700: #4a5568;
        --traxovo-gray-800: #2d3748;
        --traxovo-gray-900: #1a202c;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        background: var(--traxovo-gray-50);
        color: var(--traxovo-gray-800);
        line-height: 1.6;
      }

      /* Navigation */
      .navbar-traxovo {
        background: linear-gradient(
          135deg,
          var(--traxovo-primary) 0%,
          var(--traxovo-secondary) 100%
        );
        box-shadow: 0 2px 20px rgba(26, 54, 93, 0.15);
        padding: 1rem 0;
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
        color: white !important;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .navbar-brand i {
        color: var(--traxovo-accent);
        font-size: 1.75rem;
      }

      .nav-pills .nav-link {
        color: rgba(255, 255, 255, 0.8);
        border-radius: 25px;
        padding: 0.75rem 1.5rem;
        margin: 0 0.25rem;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .nav-pills .nav-link:hover {
        color: white;
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-1px);
      }

      .nav-pills .nav-link.active {
        background: var(--traxovo-accent);
        color: var(--traxovo-primary);
        font-weight: 600;
      }

      /* Cards */
      .card-traxovo {
        background: white;
        border: none;
        border-radius: 16px;
        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .card-traxovo:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1);
      }

      .card-header-traxovo {
        background: linear-gradient(
          135deg,
          var(--traxovo-gray-50) 0%,
          white 100%
        );
        border-bottom: 1px solid var(--traxovo-gray-200);
        padding: 1.5rem;
        font-weight: 600;
        color: var(--traxovo-gray-700);
        display: flex;
        justify-content: between;
        align-items: center;
      }

      /* Metric Cards */
      .metric-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.05);
        border-left: 4px solid var(--traxovo-accent);
        transition: all 0.3s ease;
        height: 100%;
      }

      .metric-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1);
      }

      .metric-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--traxovo-primary);
        margin-bottom: 0.5rem;
        line-height: 1;
      }

      .metric-label {
        color: var(--traxovo-gray-600);
        font-weight: 500;
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
      }

      .metric-change {
        font-size: 0.85rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .metric-change.positive {
        background: rgba(56, 161, 105, 0.1);
        color: var(--traxovo-success);
      }

      .metric-change.negative {
        background: rgba(229, 62, 62, 0.1);
        color: var(--traxovo-danger);
      }

      /* Charts */
      .chart-container {
        position: relative;
        height: 300px;
        padding: 1rem;
      }

      /* Interactive Tables */
      .table-traxovo {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      }

      .table-traxovo thead th {
        background: var(--traxovo-gray-100);
        color: var(--traxovo-gray-700);
        font-weight: 600;
        border: none;
        padding: 1rem;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .table-traxovo tbody td {
        padding: 1rem;
        border: none;
        border-bottom: 1px solid var(--traxovo-gray-100);
        vertical-align: middle;
      }

      .table-traxovo tbody tr:hover {
        background: var(--traxovo-gray-50);
      }

      /* Status Badges */
      .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status-active {
        background: rgba(56, 161, 105, 0.1);
        color: var(--traxovo-success);
      }

      .status-idle {
        background: rgba(214, 158, 46, 0.1);
        color: var(--traxovo-warning);
      }

      .status-maintenance {
        background: rgba(229, 62, 62, 0.1);
        color: var(--traxovo-danger);
      }

      /* Buttons */
      .btn-traxovo-primary {
        background: linear-gradient(
          135deg,
          var(--traxovo-primary) 0%,
          var(--traxovo-secondary) 100%
        );
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 2rem;
        border-radius: 25px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9rem;
      }

      .btn-traxovo-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(26, 54, 93, 0.3);
        color: white;
      }

      .btn-traxovo-accent {
        background: var(--traxovo-accent);
        border: none;
        color: var(--traxovo-primary);
        font-weight: 600;
        padding: 0.75rem 2rem;
        border-radius: 25px;
        transition: all 0.3s ease;
      }

      .btn-traxovo-accent:hover {
        transform: translateY(-2px);
        background: #e6c200;
        color: var(--traxovo-primary);
      }

      /* Alert System */
      .alert-traxovo {
        border: none;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid;
      }

      .alert-traxovo.alert-warning {
        background: rgba(214, 158, 46, 0.1);
        border-left-color: var(--traxovo-warning);
        color: var(--traxovo-warning);
      }

      .alert-traxovo.alert-danger {
        background: rgba(229, 62, 62, 0.1);
        border-left-color: var(--traxovo-danger);
        color: var(--traxovo-danger);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .metric-value {
          font-size: 2rem;
        }

        .chart-container {
          height: 250px;
        }

        .metric-card {
          padding: 1.5rem;
        }
      }

      /* Loading States */
      .loading-skeleton {
        background: linear-gradient(
          90deg,
          var(--traxovo-gray-200) 25%,
          var(--traxovo-gray-100) 50%,
          var(--traxovo-gray-200) 75%
        );
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }

      @keyframes loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* Real-time Indicators */
      .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--traxovo-success);
        font-weight: 500;
      }

      .live-dot {
        width: 8px;
        height: 8px;
        background: var(--traxovo-success);
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-traxovo">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="fas fa-truck-moving"></i>
          <span>TRAXOVO</span>
        </a>

        <ul class="nav nav-pills ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#overview">Overview</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/fleet-map">Fleet Map</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/fleet-analytics">Analytics</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/asset-manager">Assets</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/attendance-matrix">Workforce</a>
          </li>
        </ul>

        <div class="live-indicator ms-3">
          <div class="live-dot"></div>
          <span>Live</span>
        </div>
      </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="container-fluid py-4">
      <!-- Header Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h1 class="h2 fw-bold text-dark mb-1">Executive Dashboard</h1>
              <p class="text-muted mb-0">
                {{ current_date }} • Last updated {{ last_updated }}
              </p>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-traxovo-accent" id="refreshBtn">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <button class="btn btn-traxovo-primary">
                <i class="fas fa-download"></i> Export
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Key Metrics -->
      <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
          <div class="metric-card">
            <div class="metric-value">{{ total_assets }}</div>
            <div class="metric-label">Total Assets</div>
            <div class="metric-change positive">
              <i class="fas fa-arrow-up"></i> 2.1%
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-md-6">
          <div class="metric-card">
            <div class="metric-value">{{ active_assets }}</div>
            <div class="metric-label">Active Assets</div>
            <div class="metric-change positive">
              <i class="fas fa-arrow-up"></i> 5.3%
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-md-6">
          <div class="metric-card">
            <div class="metric-value">${{ revenue_total }}</div>
            <div class="metric-label">Monthly Revenue</div>
            <div class="metric-change positive">
              <i class="fas fa-arrow-up"></i> 12.7%
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-md-6">
          <div class="metric-card">
            <div class="metric-value">{{ utilization_rate }}%</div>
            <div class="metric-label">Utilization Rate</div>
            <div class="metric-change positive">
              <i class="fas fa-arrow-up"></i> 3.2%
            </div>
          </div>
        </div>
      </div>

      <!-- Charts and Analytics -->
      <div class="row g-4 mb-4">
        <div class="col-xl-8">
          <div class="card-traxovo">
            <div class="card-header-traxovo">
              <h5 class="mb-0">Fleet Performance Trends</h5>
              <div class="d-flex gap-2">
                <button
                  class="btn btn-sm btn-outline-secondary"
                  data-period="7d"
                >
                  7D
                </button>
                <button
                  class="btn btn-sm btn-outline-secondary active"
                  data-period="30d"
                >
                  30D
                </button>
                <button
                  class="btn btn-sm btn-outline-secondary"
                  data-period="90d"
                >
                  90D
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="performanceChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-4">
          <div class="card-traxovo">
            <div class="card-header-traxovo">
              <h5 class="mb-0">Asset Distribution</h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="distributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Real-time Fleet Status -->
      <div class="row g-4 mb-4">
        <div class="col-xl-8">
          <div class="card-traxovo">
            <div class="card-header-traxovo">
              <h5 class="mb-0">Live Asset Status</h5>
              <span class="live-indicator">
                <div class="live-dot"></div>
                Real-time
              </span>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-traxovo">
                  <thead>
                    <tr>
                      <th>Asset ID</th>
                      <th>Description</th>
                      <th>Status</th>
                      <th>Operator</th>
                      <th>Location</th>
                      <th>Hours Today</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="assetTableBody">
                    <tr>
                      <td><strong>EXC-001</strong></td>
                      <td>Cat 320 Excavator</td>
                      <td>
                        <span class="status-badge status-active">Active</span>
                      </td>
                      <td>John Smith</td>
                      <td>Downtown Project</td>
                      <td>6.5</td>
                      <td>
                        <button class="btn btn-sm btn-outline-primary">
                          <i class="fas fa-eye"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>TRK-045</strong></td>
                      <td>Mack Dump Truck</td>
                      <td>
                        <span class="status-badge status-active">Active</span>
                      </td>
                      <td>Mike Johnson</td>
                      <td>Highway 75 Extension</td>
                      <td>7.2</td>
                      <td>
                        <button class="btn btn-sm btn-outline-primary">
                          <i class="fas fa-eye"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>DOZ-012</strong></td>
                      <td>Cat D6 Dozer</td>
                      <td>
                        <span class="status-badge status-idle">Idle</span>
                      </td>
                      <td>-</td>
                      <td>Main Yard</td>
                      <td>4.0</td>
                      <td>
                        <button class="btn btn-sm btn-outline-primary">
                          <i class="fas fa-eye"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-4">
          <!-- Alerts Panel -->
          <div class="card-traxovo">
            <div class="card-header-traxovo">
              <h5 class="mb-0">System Alerts</h5>
              <span class="badge bg-warning">{{ alerts_count }}</span>
            </div>
            <div class="card-body">
              <div class="alert-traxovo alert-warning">
                <div class="d-flex align-items-center">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  <div>
                    <strong>Maintenance Due</strong>
                    <div class="small">
                      {{ maintenance_due }} assets require service
                    </div>
                  </div>
                </div>
              </div>
              <div class="alert-traxovo alert-danger">
                <div class="d-flex align-items-center">
                  <i class="fas fa-map-marker-alt me-2"></i>
                  <div>
                    <strong>Geofence Violation</strong>
                    <div class="small">TRK-045 outside authorized zone</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card-traxovo mt-4">
            <div class="card-header-traxovo">
              <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <button class="btn btn-traxovo-primary">
                  <i class="fas fa-plus me-2"></i> Add Asset
                </button>
                <button class="btn btn-outline-primary">
                  <i class="fas fa-file-export me-2"></i> Generate Report
                </button>
                <button class="btn btn-outline-secondary">
                  <i class="fas fa-cog me-2"></i> System Settings
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Performance Chart
      const performanceCtx = document.getElementById('performanceChart').getContext('2d');
      new Chart(performanceCtx, {
          type: 'line',
          data: {
              labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
              datasets: [{
                  label: 'Utilization %',
                  data: [82, 85, 88, {{ utilization_rate }}],
                  borderColor: '#1a365d',
                  backgroundColor: 'rgba(26, 54, 93, 0.1)',
                  tension: 0.4,
                  fill: true
              }, {
                  label: 'Revenue ($K)',
                  data: [420, 450, 480, 550],
                  borderColor: '#ffd700',
                  backgroundColor: 'rgba(255, 215, 0, 0.1)',
                  tension: 0.4,
                  fill: true
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: {
                      position: 'top',
                  }
              },
              scales: {
                  y: {
                      beginAtZero: true,
                      grid: {
                          color: 'rgba(0,0,0,0.05)'
                      }
                  },
                  x: {
                      grid: {
                          display: false
                      }
                  }
              }
          }
      });

      // Distribution Chart
      const distributionCtx = document.getElementById('distributionChart').getContext('2d');
      new Chart(distributionCtx, {
          type: 'doughnut',
          data: {
              labels: ['Active', 'Idle', 'Maintenance'],
              datasets: [{
                  data: [{{ active_assets }}, 45, {{ maintenance_due }}],
                  backgroundColor: ['#38a169', '#d69e2e', '#e53e3e'],
                  borderWidth: 0
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: {
                      position: 'bottom'
                  }
              }
          }
      });

      // Real-time updates
      setInterval(async function() {
          try {
              const response = await fetch('/dashboard/api/dashboard-metrics');
              const data = await response.json();

              // Update metrics (this would update the actual values)
              console.log('Updated metrics:', data);

          } catch (error) {
              console.error('Error fetching metrics:', error);
          }
      }, 30000); // Update every 30 seconds

      // Refresh button
      document.getElementById('refreshBtn').addEventListener('click', function() {
          location.reload();
      });
    </script>
  </body>
</html>

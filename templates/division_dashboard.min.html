<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>{{ division }} Division Manager - TRAXOVO</title><link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>
.alert-live { animation: pulse 2s infinite; }
@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
.exception-card { border-left: 4px solid #dc3545; }
.perfect-badge { background: linear-gradient(45deg, #28a745, #20c997); }
</style></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class="container-fluid"><a class="navbar-brand" href="#"><i class="fas fa-user-tie me-2"></i>{{ manager_info.name }} - {{ division }} Division
</a><div class="navbar-nav ms-auto"><span class="navbar-text me-3">{{ division_stats.division_hours }}</span><a class="nav-link" href="/division-logout">Logout</a></div></div></nav><div class="container-fluid mt-4"><div class="row mb-4"><div class="col-md-3"><div class="card bg-primary text-white"><div class="card-body text-center"><h3>{{ division_stats.total_drivers }}</h3><small>Total Drivers</small></div></div></div><div class="col-md-3"><div class="card bg-danger text-white"><div class="card-body text-center"><h3>{{ division_stats.drivers_with_issues }}</h3><small>Need Attention</small></div></div></div><div class="col-md-3"><div class="card bg-success text-white"><div class="card-body text-center"><h3>{{ division_stats.perfect_attendance }}</h3><small>Perfect Attendance</small></div></div></div><div class="col-md-3"><div class="card bg-info text-white"><div class="card-body text-center"><h3>{{ division_stats.avg_compliance }}</h3><small>Compliance Rate</small></div></div></div></div><div class="row mb-4"><div class="col-12"><div class="card"><div class="card-header bg-warning text-dark"><h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Live Alerts</h5></div><div class="card-body">
{% for alert in recent_alerts %}
<div class="alert alert-warning alert-live mb-2"><strong>{{ alert.time }}</strong> - {{ alert.driver }}: {{ alert.alert }}
<button class="btn btn-sm btn-outline-dark ms-2" onclick="sendAlert('{{ alert.driver }}')"><i class="fas fa-paper-plane"></i> Alert Driver
</button></div>
{% endfor %}
</div></div></div></div><div class="row"><div class="col-md-8"><div class="card"><div class="card-header bg-danger text-white"><h5 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Drivers Requiring Attention ({{ problem_drivers|length }})</h5></div><div class="card-body">
{% for driver in problem_drivers %}
<div class="card exception-card mb-3"><div class="card-body"><div class="row"><div class="col-md-6"><h6>{{ driver.name }}</h6><small class="text-muted">ID: {{ driver.id }} | Asset: {{ driver.asset }}</small></div><div class="col-md-3 text-center"><span class="badge bg-danger">{{ driver.status }}</span><br><small>Risk: {{ driver.risk_score }}%</small></div><div class="col-md-3"><button class="btn btn-sm btn-warning" onclick="sendAlert('{{ driver.name }}')"><i class="fas fa-bell"></i> Alert
</button><button class="btn btn-sm btn-info" onclick="viewDetails('{{ driver.id }}')"><i class="fas fa-eye"></i> Details
</button></div></div></div></div>
{% endfor %}
</div></div></div><div class="col-md-4"><div class="card"><div class="card-header perfect-badge text-white"><h5 class="mb-0"><i class="fas fa-star me-2"></i>Perfect Performers</h5></div><div class="card-body">
{% for driver in all_drivers %}
{% if not driver.has_issues %}
<div class="d-flex justify-content-between align-items-center mb-2"><span>{{ driver.name }}</span><span class="badge bg-success">{{ driver.risk_score }}%</span></div>
{% endif %}
{% endfor %}
</div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script><script>
function sendAlert(driverName) {
const message = prompt(`Send alert to ${driverName}:`, 'Please check your current location and time status.');
if (message) {
fetch('/api/send-alert', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({driver_id: driverName, message: message})
})
.then(response => response.json())
.then(data => {
if (data.success) {
alert(`Alert sent to ${driverName}!`);
}
});
}
}

function viewDetails(driverId) {
// Navigate to detailed driver view
window.open(`/smart-risk-analytics?driver=${driverId}`, '_blank');
}

// Auto-refresh alerts every 30 seconds
setInterval(() => {
fetch(`/api/division-alerts/{{ division }}`)
.then(response => response.json())
.then(alerts => {
// Update alerts section (simplified for demo)
console.log('Refreshed alerts:', alerts);
});
}, 30000);
</script></body></html>
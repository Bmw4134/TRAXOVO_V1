<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>TRAXOVO Driver Reporting Dashboard</title><link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css"><style>
.report-card {
transition: transform 0.2s;
}
.report-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
.metric-card {
border-radius: 10px;
height: 100%;
}
.upload-area {
border: 2px dashed var(--bs-info);
border-radius: 10px;
padding: 20px;
text-align: center;
background-color: rgba(13, 202, 240, 0.1);
}
.upload-area:hover {
background-color: rgba(13, 202, 240, 0.2);
}
</style></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class="container-fluid"><a class="navbar-brand" href="#"><span class="fs-4 fw-bold">TRAXOVO</span><span class="fs-6 text-info">Fleet Management</span></a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link active" href="#">Driver Reports</a></li><li class="nav-item"><a class="nav-link" href="#">Asset Map</a></li><li class="nav-item"><a class="nav-link" href="#">Equipment Billing</a></li></ul><span class="navbar-text">
Today: {{ today }}
</span></div></div></nav><div class="container mt-4"><div class="row"><div class="col-md-8"><h1 class="display-5 mb-4">Driver Reporting Dashboard</h1></div><div class="col-md-4 text-end"><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newReportModal"><i class="bi bi-plus-circle"></i> New Report
</button></div></div><div class="row mb-4"><div class="col-md-3 mb-3"><div class="card bg-success text-white metric-card"><div class="card-body"><h5 class="card-title">On Time</h5><h2 class="card-text">{{ metrics.on_time|default(0) }}</h2><p class="card-text">Drivers</p></div></div></div><div class="col-md-3 mb-3"><div class="card bg-danger text-white metric-card"><div class="card-body"><h5 class="card-title">Late</h5><h2 class="card-text">{{ metrics.late|default(0) }}</h2><p class="card-text">Drivers ({{ metrics.avg_late|default(0) }} min avg)</p></div></div></div><div class="col-md-3 mb-3"><div class="card bg-warning text-dark metric-card"><div class="card-body"><h5 class="card-title">Early End</h5><h2 class="card-text">{{ metrics.early_end|default(0) }}</h2><p class="card-text">Drivers ({{ metrics.avg_early|default(0) }} min avg)</p></div></div></div><div class="col-md-3 mb-3"><div class="card bg-secondary text-white metric-card"><div class="card-body"><h5 class="card-title">Not On Job</h5><h2 class="card-text">{{ metrics.not_on_job|default(0) }}</h2><p class="card-text">Drivers</p></div></div></div></div><div class="row mb-4"><div class="col-12"><div class="card"><div class="card-header bg-info text-white"><h5 class="mb-0">Timecard Comparison</h5></div><div class="card-body"><p class="text-muted">Compare GPS data with employee timecards to identify discrepancies</p>

{% if timecard_comparisons %}
<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Driver</th><th>GPS Start</th><th>Timecard Start</th><th>Difference</th><th>GPS End</th><th>Timecard End</th><th>Difference</th><th>Total Variance</th></tr></thead><tbody>
{% for tc in timecard_comparisons %}
<tr><td>{{ tc.driver_name }}</td><td>{{ tc.gps_start }}</td><td>{{ tc.timecard_start }}</td><td class="{{ 'text-danger' if tc.start_diff > 15 else '' }}">
{{ tc.start_diff }} min
</td><td>{{ tc.gps_end }}</td><td>{{ tc.timecard_end }}</td><td class="{{ 'text-danger' if tc.end_diff > 15 else '' }}">
{{ tc.end_diff }} min
</td><td class="{{ 'text-danger' if tc.total_variance > 30 else '' }}">
{{ tc.total_variance }} min
</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="upload-area mb-3"><h5>Upload Timecard Data</h5><p>Upload GroundWorks timecard data to compare with GPS records</p><form action="/driver-reports/upload-timecards" method="POST" enctype="multipart/form-data"><div class="mb-3"><input type="file" class="form-control" name="timecard_file" accept=".csv,.xlsx"></div><div class="mb-3"><label class="form-label">Date Range</label><div class="row"><div class="col"><input type="date" class="form-control" name="start_date"></div><div class="col"><input type="date" class="form-control" name="end_date"></div></div></div><button type="submit" class="btn btn-info">Upload & Compare</button></form></div>
{% endif %}
</div></div></div></div><h4 class="mb-3">Recent Reports</h4><div class="row">
{% if reports %}
{% for report in reports %}
<div class="col-md-4 mb-4"><div class="card report-card"><div class="card-body"><h5 class="card-title">{{ report.date }}</h5><p class="card-text text-muted"><small>Generated: {{ report.generated_at }}</small></p><div class="d-flex justify-content-between mb-3"><span class="badge bg-success">{{ report.metrics.on_time }} On Time</span><span class="badge bg-danger">{{ report.metrics.late }} Late</span><span class="badge bg-warning text-dark">{{ report.metrics.early_end }} Early</span></div><div class="d-grid gap-2"><a href="{{ report.pdf_url }}" class="btn btn-sm btn-outline-primary">View PDF</a><a href="{{ report.excel_url }}" class="btn btn-sm btn-outline-secondary">Download Excel</a></div></div></div></div>
{% endfor %}
{% else %}
<div class="col-12"><div class="alert alert-info">
No reports generated yet. Click "New Report" to create your first report.
</div></div>
{% endif %}
</div></div><div class="modal fade" id="newReportModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Generate New Driver Report</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form action="/driver-reports/generate" method="POST" enctype="multipart/form-data"><div class="mb-3"><label class="form-label">Report Date</label><input type="date" class="form-control" name="report_date" value="{{ today }}"></div><div class="row mb-3"><div class="col-md-4"><div class="upload-area h-100"><h6>Driving History</h6><p class="small text-muted">Upload CSV files from GAUGE API</p><input type="file" class="form-control" name="driving_history" accept=".csv" multiple></div></div><div class="col-md-4"><div class="upload-area h-100"><h6>Activity Detail</h6><p class="small text-muted">Upload CSV files from GAUGE API</p><input type="file" class="form-control" name="activity_detail" accept=".csv" multiple></div></div><div class="col-md-4"><div class="upload-area h-100"><h6>Asset Time (Optional)</h6><p class="small text-muted">Upload CSV files from GAUGE API</p><input type="file" class="form-control" name="asset_time" accept=".csv" multiple></div></div></div><div class="mb-3"><label class="form-label">Job Assignments (Optional)</label><input type="file" class="form-control" name="job_assignments" accept=".csv,.xlsx"><div class="form-text">Upload equipment billing sheet for job assignments</div></div><div class="form-check mb-3"><input class="form-check-input" type="checkbox" name="include_timecards" id="includeTimecards"><label class="form-check-label" for="includeTimecards">
Include timecard comparison in report
</label></div><div class="d-grid"><button type="submit" class="btn btn-primary">Generate Report</button></div></form></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script></body></html>
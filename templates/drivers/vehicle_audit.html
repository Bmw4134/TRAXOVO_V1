{% extends "layout.html" %}

{% block title %}Vehicle History Audit{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <h1 class="mb-4">Vehicle History Audit</h1>
    
    <div class="card mb-4">
        <div class="card-header">
            <i class="bi bi-search me-1"></i>
            Search Vehicle History
        </div>
        <div class="card-body">
            <form method="GET" action="{{ url_for('driver_module.vehicle_audit') }}">
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label for="search" class="form-label">Search by Vehicle ID, Driver Name, or Job Site</label>
                        <input type="text" class="form-control" id="search" name="search" 
                               value="{{ search_term }}" placeholder="ET-01, PT-123, DRIVER NAME, etc.">
                    </div>
                    <div class="col-md-3">
                        <label for="date_range" class="form-label">Date Range</label>
                        <select class="form-select" id="date_range" name="date_range">
                            <option value="7" {% if date_range == '7' %}selected{% endif %}>Last 7 days</option>
                            <option value="14" {% if date_range == '14' %}selected{% endif %}>Last 14 days</option>
                            <option value="30" {% if date_range == '30' %}selected{% endif %}>Last 30 days</option>
                            <option value="90" {% if date_range == '90' %}selected{% endif %}>Last 90 days</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-search me-1"></i> Search
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    {% if search_term %}
    <div class="card">
        <div class="card-header">
            <i class="bi bi-table me-1"></i>
            Vehicle History Results
            <span class="badge bg-secondary ms-2">{{ start_date }} to {{ end_date }}</span>
            <span class="badge bg-primary ms-2">{{ audit_data|length }} results</span>
        </div>
        <div class="card-body">
            {% if audit_data %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Asset ID</th>
                            <th>Vehicle Type</th>
                            <th>Driver</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Location</th>
                            <th>Job Site</th>
                            <th>Division</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in audit_data %}
                        <tr>
                            <td>{{ item.date }}</td>
                            <td>{{ item.asset_id }}</td>
                            <td>{{ item.vehicle_type }}</td>
                            <td>{{ item.driver }}</td>
                            <td>{{ item.start_time }}</td>
                            <td>{{ item.end_time }}</td>
                            <td>{{ item.location }}</td>
                            <td>{{ item.job_site }}</td>
                            <td>{{ item.division }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">No results found for '{{ search_term }}' in the selected date range.</div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="card">
        <div class="card-body">
            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                Enter a search term above to find vehicle history data.
            </div>
            <p>
                You can search by:
            </p>
            <ul>
                <li>Vehicle ID (e.g., "ET-01", "PT-123")</li>
                <li>Vehicle Type (e.g., "RAM 1500")</li>
                <li>Driver Name (e.g., "MATTHEW SHAYLOR")</li>
                <li>Job Site (e.g., "Fort Worth")</li>
            </ul>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Asset Portal - TRAXOVO</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
      }
      .portal-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 0 1rem;
      }
      .portal-header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .portal-title {
        color: white;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }
      .asset-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        transition: all 0.3s ease;
      }
      .asset-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      }
      .btn-checkout {
        background: linear-gradient(45deg, #22c55e, #16a34a);
        border: none;
        color: white;
        border-radius: 12px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-checkout:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
        color: white;
      }
      .btn-checkin {
        background: linear-gradient(45deg, #ef4444, #dc2626);
        border: none;
        color: white;
        border-radius: 12px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-checkin:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        color: white;
      }
      .status-available {
        background: rgba(34, 197, 94, 0.1);
        color: #16a34a;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
      }
      .status-checkedout {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="portal-container">
      <div class="portal-header">
        <h1 class="portal-title">
          <i class="fas fa-clipboard-check me-3"></i>
          Employee Asset Portal
        </h1>
        <p class="text-white-50 mb-0">
          Check assets in and out for your daily operations
        </p>
      </div>
      <div class="asset-card mb-4">
        <h5>Employee Information</h5>
        <div class="row">
          <div class="col-md-6">
            <input
              type="text"
              id="employeeName"
              class="form-control"
              placeholder="Your name"
              value="{{ employee_name }}"
            />
          </div>
          <div class="col-md-6">
            <input
              type="email"
              id="employeeEmail"
              class="form-control"
              placeholder="Your email (optional)"
            />
          </div>
        </div>
      </div>
      <div class="asset-card">
        <h5 class="mb-3">
          <i class="fas fa-truck text-success me-2"></i>
          Available Assets ({{ available_assets|length }})
        </h5>
        <div class="row">
          {% for asset in available_assets %}
          <div class="col-md-6 mb-3">
            <div class="border rounded p-3">
              <div
                class="d-flex justify-content-between align-items-start mb-2"
              >
                <div>
                  <h6 class="mb-1">{{ asset.asset_id }}</h6>
                  <small class="text-muted">{{ asset.description }}</small>
                </div>
                <span class="status-available">Available</span>
              </div>
              <div class="mt-3">
                <button
                  class="btn btn-checkout btn-sm w-100"
                  onclick="checkoutAsset('{{ asset.asset_id }}')"
                >
                  <i class="fas fa-sign-out-alt me-1"></i> Check Out
                </button>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      {% if my_checkouts %}
      <div class="asset-card">
        <h5 class="mb-3">
          <i class="fas fa-user-check text-warning me-2"></i>
          My Current Checkouts ({{ my_checkouts|length }})
        </h5>
        <div class="row">
          {% for checkout in my_checkouts %}
          <div class="col-md-6 mb-3">
            <div class="border rounded p-3">
              <div
                class="d-flex justify-content-between align-items-start mb-2"
              >
                <div>
                  <h6 class="mb-1">{{ checkout.asset_id }}</h6>
                  <small class="text-muted"
                    >Checked out: {{ checkout.timestamp[:16] }}</small
                  >
                </div>
                <span class="status-checkedout">Checked Out</span>
              </div>
              <div class="mt-3">
                <button
                  class="btn btn-checkin btn-sm w-100"
                  onclick="checkinAsset('{{ checkout.asset_id }}')"
                >
                  <i class="fas fa-sign-in-alt me-1"></i> Check In
                </button>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div class="modal fade" id="checkoutModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Check Out Asset</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <form id="checkoutForm">
                <input type="hidden" id="checkoutAssetId" />
                <div class="mb-3">
                  <label class="form-label">Purpose</label
                  ><select class="form-select" id="checkoutPurpose" required>
                    <option value="">Select purpose...</option>
                    <option value="Job Site Transport">
                      Job Site Transport
                    </option>
                    <option value="Material Delivery">Material Delivery</option>
                    <option value="Site Inspection">Site Inspection</option>
                    <option value="Equipment Transport">
                      Equipment Transport
                    </option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Expected Return</label
                  ><input
                    type="datetime-local"
                    class="form-control"
                    id="expectedReturn"
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Notes (optional)</label
                  ><textarea
                    class="form-control"
                    id="checkoutNotes"
                    rows="2"
                  ></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel</button
              ><button
                type="button"
                class="btn btn-primary"
                onclick="submitCheckout()"
              >
                Check Out
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="checkinModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Check In Asset</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <form id="checkinForm">
                <input type="hidden" id="checkinAssetId" />
                <div class="mb-3">
                  <label class="form-label">Condition</label
                  ><select class="form-select" id="conditionIn">
                    <option value="Good">Good</option>
                    <option value="Fair">Fair</option>
                    <option value="Needs Attention">Needs Attention</option>
                    <option value="Damaged">Damaged</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Issues Reported (if any)</label
                  ><textarea
                    class="form-control"
                    id="issuesReported"
                    rows="2"
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Notes</label
                  ><textarea
                    class="form-control"
                    id="checkinNotes"
                    rows="2"
                  ></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel</button
              ><button
                type="button"
                class="btn btn-primary"
                onclick="submitCheckin()"
              >
                Check In
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let currentAssetId = "";

      function checkoutAsset(assetId) {
        currentAssetId = assetId;
        document.getElementById("checkoutAssetId").value = assetId;
        document.querySelector("#checkoutModal .modal-title").textContent =
          `Check Out ${assetId}`;
        new bootstrap.Modal(document.getElementById("checkoutModal")).show();
      }

      function checkinAsset(assetId) {
        currentAssetId = assetId;
        document.getElementById("checkinAssetId").value = assetId;
        document.querySelector("#checkinModal .modal-title").textContent =
          `Check In ${assetId}`;
        new bootstrap.Modal(document.getElementById("checkinModal")).show();
      }

      async function submitCheckout() {
        const employeeName = document.getElementById("employeeName").value;
        if (!employeeName) {
          alert("Please enter your name");
          return;
        }

        const data = {
          asset_id: document.getElementById("checkoutAssetId").value,
          employee_name: employeeName,
          employee_email: document.getElementById("employeeEmail").value,
          purpose: document.getElementById("checkoutPurpose").value,
          expected_return: document.getElementById("expectedReturn").value,
          notes: document.getElementById("checkoutNotes").value,
        };

        try {
          const response = await fetch("/api/checkout-asset", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          if (result.success) {
            alert("Asset checked out successfully!");
            location.reload();
          } else {
            alert("Error: " + result.error);
          }
        } catch (error) {
          alert("Error checking out asset");
        }

        bootstrap.Modal.getInstance(
          document.getElementById("checkoutModal"),
        ).hide();
      }

      async function submitCheckin() {
        const employeeName = document.getElementById("employeeName").value;
        if (!employeeName) {
          alert("Please enter your name");
          return;
        }

        const data = {
          asset_id: document.getElementById("checkinAssetId").value,
          employee_name: employeeName,
          condition_in: document.getElementById("conditionIn").value,
          issues_reported: document.getElementById("issuesReported").value,
          notes: document.getElementById("checkinNotes").value,
        };

        try {
          const response = await fetch("/api/checkin-asset", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          if (result.success) {
            alert("Asset checked in successfully!");
            location.reload();
          } else {
            alert("Error: " + result.error);
          }
        } catch (error) {
          alert("Error checking in asset");
        }

        bootstrap.Modal.getInstance(
          document.getElementById("checkinModal"),
        ).hide();
      }
    </script>
  </body>
</html>

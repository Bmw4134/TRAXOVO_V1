<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fleet Utilization Details - TRAXOVO</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-light">
    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2>
            <i class="fas fa-chart-line me-2 text-success"></i>Fleet Utilization
            Analytics
          </h2>
          <p class="text-muted mb-0">
            {{ utilization_data.time_period }} | Report Date: {{
            utilization_data.report_date }}
          </p>
        </div>
        <div>
          <a
            href="{{ url_for('equipment_analytics.dashboard') }}"
            class="btn btn-outline-secondary me-2"
          >
            <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
          </a>
          <a
            href="{{ url_for('equipment_analytics.export_fleet_utilization') }}"
            class="btn btn-success"
          >
            <i class="fas fa-download me-1"></i>Export Data
          </a>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body text-center">
              <i class="fas fa-truck fa-2x mb-2"></i>
              <h3>{{ utilization_data.total_assets }}</h3>
              <p class="mb-0">Total Assets</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body text-center">
              <i class="fas fa-play-circle fa-2x mb-2"></i>
              <h3>{{ utilization_data.active_assets }}</h3>
              <p class="mb-0">Active Assets</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-dark">
            <div class="card-body text-center">
              <i class="fas fa-clock fa-2x mb-2"></i>
              <h3>{{ "%.1f"|format(utilization_data.avg_utilization) }}%</h3>
              <p class="mb-0">Avg Utilization</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body text-center">
              <i class="fas fa-stopwatch fa-2x mb-2"></i>
              <h3>{{ "{:,}"|format(utilization_data.total_hours|int) }}</h3>
              <p class="mb-0">Total Hours</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5>Utilization by Category</h5>
            </div>
            <div class="card-body">
              <canvas id="categoryChart"></canvas>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5>Asset Status Distribution</h5>
            </div>
            <div class="card-body">
              <canvas id="statusChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Performers -->
      {% if top_performers %}
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-success">
            <div class="card-header bg-success text-white">
              <h5>
                <i class="fas fa-trophy me-2"></i>Top Performers (>75%
                Utilization)
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Asset ID</th>
                      <th>Category</th>
                      <th>Utilization %</th>
                      <th>Hours</th>
                      <th>Status</th>
                      <th>Rating</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for asset in top_performers %}
                    <tr>
                      <td><strong>{{ asset.asset_id }}</strong></td>
                      <td>
                        <span class="badge bg-primary"
                          >{{ asset.category }}</span
                        >
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="progress me-2"
                            style="width: 100px; height: 20px"
                          >
                            <div
                              class="progress-bar bg-success"
                              style="width: {{ asset.utilization_percentage }}%"
                            ></div>
                          </div>
                          <strong
                            >{{ "%.1f"|format(asset.utilization_percentage)
                            }}%</strong
                          >
                        </div>
                      </td>
                      <td>{{ "{:,}"|format(asset.hours|int) }}</td>
                      <td>
                        <span class="badge bg-success">{{ asset.status }}</span>
                      </td>
                      <td>
                        <span class="badge bg-warning"
                          >{{ asset.efficiency_rating }}</span
                        >
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Underutilized Assets -->
      {% if underutilized %}
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
              <h5>
                <i class="fas fa-exclamation-triangle me-2"></i>Underutilized
                Assets (<25% Utilization)
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Asset ID</th>
                      <th>Category</th>
                      <th>Utilization %</th>
                      <th>Hours</th>
                      <th>Status</th>
                      <th>Rating</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for asset in underutilized %}
                    <tr>
                      <td><strong>{{ asset.asset_id }}</strong></td>
                      <td>
                        <span class="badge bg-secondary"
                          >{{ asset.category }}</span
                        >
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="progress me-2"
                            style="width: 100px; height: 20px"
                          >
                            <div
                              class="progress-bar bg-warning"
                              style="width: {{ asset.utilization_percentage }}%"
                            ></div>
                          </div>
                          <span class="text-warning"
                            >{{ "%.1f"|format(asset.utilization_percentage)
                            }}%</span
                          >
                        </div>
                      </td>
                      <td>{{ "{:,}"|format(asset.hours|int) }}</td>
                      <td>
                        <span class="badge bg-warning">{{ asset.status }}</span>
                      </td>
                      <td>
                        <span class="badge bg-danger"
                          >{{ asset.efficiency_rating }}</span
                        >
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- All Assets Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="fas fa-list me-2"></i>All Assets - Fleet Utilization
                Details
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Asset ID</th>
                      <th>Category</th>
                      <th>Utilization %</th>
                      <th>Hours</th>
                      <th>Status</th>
                      <th>Rating</th>
                      <th>Active</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for asset in utilization_data.asset_details %}
                    <tr>
                      <td><strong>{{ asset.asset_id }}</strong></td>
                      <td>
                        <span class="badge bg-info">{{ asset.category }}</span>
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="progress me-2"
                            style="width: 80px; height: 16px"
                          >
                            {% if asset.utilization_percentage >= 75 %}
                            <div
                              class="progress-bar bg-success"
                              style="width: {{ asset.utilization_percentage }}%"
                            ></div>
                            {% elif asset.utilization_percentage >= 50 %}
                            <div
                              class="progress-bar bg-info"
                              style="width: {{ asset.utilization_percentage }}%"
                            ></div>
                            {% elif asset.utilization_percentage >= 25 %}
                            <div
                              class="progress-bar bg-warning"
                              style="width: {{ asset.utilization_percentage }}%"
                            ></div>
                            {% else %}
                            <div
                              class="progress-bar bg-danger"
                              style="width: {{ asset.utilization_percentage }}%"
                            ></div>
                            {% endif %}
                          </div>
                          <small
                            >{{ "%.1f"|format(asset.utilization_percentage)
                            }}%</small
                          >
                        </div>
                      </td>
                      <td>{{ "{:,}"|format(asset.hours|int) }}</td>
                      <td>
                        {% if asset.utilization_percentage >= 75 %}
                        <span class="badge bg-success">{{ asset.status }}</span>
                        {% elif asset.utilization_percentage >= 25 %}
                        <span class="badge bg-warning">{{ asset.status }}</span>
                        {% else %}
                        <span class="badge bg-danger">{{ asset.status }}</span>
                        {% endif %}
                      </td>
                      <td>
                        {% if asset.efficiency_rating == 'Excellent' %}
                        <span class="badge bg-success"
                          >{{ asset.efficiency_rating }}</span
                        >
                        {% elif asset.efficiency_rating == 'Good' %}
                        <span class="badge bg-info"
                          >{{ asset.efficiency_rating }}</span
                        >
                        {% elif asset.efficiency_rating == 'Fair' %}
                        <span class="badge bg-warning"
                          >{{ asset.efficiency_rating }}</span
                        >
                        {% else %}
                        <span class="badge bg-danger"
                          >{{ asset.efficiency_rating }}</span
                        >
                        {% endif %}
                      </td>
                      <td>
                        {% if asset.is_active %}
                        <i class="fas fa-check-circle text-success"></i>
                        {% else %}
                        <i class="fas fa-times-circle text-danger"></i>
                        {% endif %}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Category Chart
      const categoryCtx = document.getElementById('categoryChart').getContext('2d');
      const categoryData = {
          labels: [{% for category in category_summary.keys() %}'{{ category }}'{% if not loop.last %},{% endif %}{% endfor %}],
          datasets: [{
              data: [{% for cat_data in category_summary.values() %}{{ "%.1f"|format(cat_data.avg_utilization) }}{% if not loop.last %},{% endif %}{% endfor %}],
              backgroundColor: [
                  '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
              ]
          }]
      };

      new Chart(categoryCtx, {
          type: 'doughnut',
          data: categoryData,
          options: {
              responsive: true,
              plugins: {
                  legend: {
                      position: 'bottom'
                  },
                  title: {
                      display: true,
                      text: 'Average Utilization by Category'
                  }
              }
          }
      });

      // Status Chart
      const statusCtx = document.getElementById('statusChart').getContext('2d');
      new Chart(statusCtx, {
          type: 'bar',
          data: {
              labels: ['Active Assets', 'Idle Assets'],
              datasets: [{
                  data: [{{ utilization_data.active_assets }}, {{ utilization_data.idle_assets }}],
                  backgroundColor: ['#28a745', '#dc3545']
              }]
          },
          options: {
              responsive: true,
              plugins: {
                  legend: {
                      display: false
                  },
                  title: {
                      display: true,
                      text: 'Asset Status Distribution'
                  }
              },
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
    </script>
  </body>
</html>

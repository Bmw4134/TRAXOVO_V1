<!DOCTYPE html>
<html>
<head>
    <title>Master Command Overlay</title>
    <style>
        /* Floating Master Command Overlay - Responsive Secret Admin Interface */
        #masterCommandOverlay {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 320px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #0f3460;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 9999;
            font-family: 'Courier New', monospace;
            color: #00ff88;
            display: none;
            max-height: 80vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            resize: both;
            min-width: 280px;
            min-height: 200px;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            #masterCommandOverlay {
                width: calc(100vw - 40px);
                max-width: 350px;
                top: 10px;
                right: 10px;
                left: 10px;
                margin: 0 auto;
            }
            
            #masterCommandOverlay.mobile-compact {
                width: 280px;
                right: 10px;
                left: auto;
                max-height: 60vh;
            }
            
            #masterCommandOverlay.mobile-fullscreen {
                width: calc(100vw - 20px);
                height: calc(100vh - 40px);
                top: 10px;
                right: 10px;
                left: 10px;
                max-height: none;
            }
        }
        
        /* Desktop Size Variants - Improved Scaling */
        #masterCommandOverlay.compact {
            width: 300px;
            max-height: 350px;
            font-size: 10px;
        }
        
        #masterCommandOverlay.compact .master-content {
            padding: 10px;
        }
        
        #masterCommandOverlay.compact .command-btn {
            padding: 4px 8px;
            font-size: 9px;
            margin: 2px;
        }
        
        #masterCommandOverlay.expanded {
            width: 480px;
            max-height: 70vh;
            font-size: 13px;
        }
        
        #masterCommandOverlay.expanded .master-content {
            padding: 20px;
        }
        
        #masterCommandOverlay.expanded .command-btn {
            padding: 8px 16px;
            font-size: 11px;
            margin: 4px;
        }
        
        #masterCommandOverlay.fullscreen {
            width: calc(100vw - 60px);
            height: calc(100vh - 60px);
            top: 30px;
            right: 30px;
            left: 30px;
            max-height: none;
            max-width: none;
            font-size: 14px;
        }
        
        #masterCommandOverlay.fullscreen .master-content {
            padding: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        #masterCommandOverlay.fullscreen .status-display {
            grid-column: 1 / -1;
            max-height: 200px;
        }
        
        #masterCommandOverlay.active {
            display: block;
        }
        
        .master-header {
            background: linear-gradient(90deg, #0f3460, #533483);
            padding: 10px;
            border-radius: 10px 10px 0 0;
            text-align: center;
            font-weight: bold;
            cursor: move;
            user-select: none;
            position: relative;
        }
        
        .size-controls {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
        }
        
        .size-btn {
            background: rgba(0,255,136,0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .size-btn:hover {
            background: #00ff88;
            color: #1a1a2e;
        }
        
        .size-btn.active {
            background: #00ff88;
            color: #1a1a2e;
        }
        
        .master-content {
            padding: 15px;
            font-size: 12px;
        }
        
        .command-section {
            margin-bottom: 15px;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 10px;
        }
        
        /* Improved Button Layout */
        .command-section .command-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
        }
        
        /* Compact Mode Adjustments */
        #masterCommandOverlay.compact .command-section {
            margin-bottom: 8px;
            padding-bottom: 6px;
        }
        
        #masterCommandOverlay.compact .command-title {
            font-size: 9px;
            margin-bottom: 4px;
        }
        
        /* Expanded Mode Adjustments */
        #masterCommandOverlay.expanded .command-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
        }
        
        #masterCommandOverlay.expanded .command-title {
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        /* Fullscreen Mode Grid Layout */
        #masterCommandOverlay.fullscreen .command-section {
            background: rgba(15, 52, 96, 0.3);
            padding: 15px;
            border-radius: 8px;
            border-bottom: none;
        }
        
        .command-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .command-btn {
            background: linear-gradient(90deg, #0f3460, #16213e);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 6px 12px;
            margin: 3px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.3s ease;
            display: inline-block;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .command-btn:hover {
            background: linear-gradient(90deg, #00ff88, #0f3460);
            color: #1a1a2e;
            transform: scale(1.05);
        }
        
        .master-key-input {
            width: 100%;
            background: #1a1a2e;
            border: 1px solid #0f3460;
            color: #00ff88;
            padding: 8px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 11px;
            margin-bottom: 10px;
        }
        
        .status-display {
            background: #1a1a2e;
            border: 1px solid #0f3460;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: #ff4444;
            font-size: 16px;
            cursor: pointer;
        }
        
        .minimize-btn {
            position: absolute;
            top: 5px;
            right: 35px;
            background: none;
            border: none;
            color: #ffd700;
            font-size: 14px;
            cursor: pointer;
        }
        
        .floating-trigger {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #533483, #0f3460);
            border: 2px solid #00ff88;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 9998;
            font-size: 18px;
            color: #00ff88;
            transition: all 0.3s;
        }
        
        .floating-trigger:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 5px 20px rgba(0,255,136,0.4);
        }
        
        .auth-success {
            color: #00ff88;
        }
        
        .auth-error {
            color: #ff4444;
        }
    </style>
</head>
<body>
    <!-- Floating Master Command Trigger -->
    <div class="floating-trigger" onclick="toggleMasterOverlay()" title="Master Command (Ctrl+Shift+M)">
        üëë
    </div>
    
    <!-- Master Command Overlay -->
    <div id="masterCommandOverlay">
        <div class="master-header">
            <div class="size-controls">
                <div class="size-btn" onclick="setOverlaySize('compact')" title="Compact" id="compactBtn">S</div>
                <div class="size-btn active" onclick="setOverlaySize('normal')" title="Normal" id="normalBtn">M</div>
                <div class="size-btn" onclick="setOverlaySize('expanded')" title="Expanded" id="expandedBtn">L</div>
                <div class="size-btn" onclick="setOverlaySize('fullscreen')" title="Fullscreen" id="fullscreenBtn">‚õ∂</div>
            </div>
            <button class="close-btn" onclick="hideMasterOverlay()">√ó</button>
            <button class="minimize-btn" onclick="minimizeMasterOverlay()">‚îÄ</button>
            üîë MASTER COMMAND INTERFACE
        </div>
        
        <div class="master-content">
            <!-- Authentication Section -->
            <div class="command-section">
                <div class="command-title">üõ°Ô∏è Authentication</div>
                <input type="password" id="masterKeyInput" class="master-key-input" 
                       placeholder="Master Key: TRAXOVO_MASTER_2025" 
                       onkeypress="handleMasterKeyPress(event)">
                <div class="command-btn" onclick="authenticateMaster()">Authenticate</div>
                <div id="authStatus"></div>
            </div>
            
            <!-- Quick Commands -->
            <div class="command-section">
                <div class="command-title">‚ö° Quick Commands</div>
                <div class="command-btn" onclick="executeMasterCommand('system_status')">System Status</div>
                <div class="command-btn" onclick="executeMasterCommand('deployment_execute')">Deploy Now</div>
                <div class="command-btn" onclick="window.location.href='/secure_login'">Secure Login</div>
                <div class="command-btn" onclick="window.location.href='/dashboard'">Dashboard</div>
            </div>
            
            <!-- Development Commands -->
            <div class="command-section">
                <div class="command-title">üîß Development</div>
                <div class="command-btn" onclick="executeMasterCommand('api_orchestration')">API Status</div>
                <div class="command-btn" onclick="executeMasterCommand('security_scan')">Security Scan</div>
                <div class="command-btn" onclick="executeMasterCommand('performance_boost')">Performance</div>
                <div class="command-btn" onclick="executeMasterCommand('mobile_build')">Mobile Build</div>
            </div>
            
            <!-- Emergency Commands -->
            <div class="command-section">
                <div class="command-title">üö® Emergency</div>
                <div class="command-btn" onclick="executeMasterCommand('quantum_audit')">Quantum Audit</div>
                <div class="command-btn" onclick="executeMasterCommand('emergency_reset')">Emergency Reset</div>
                <div class="command-btn" onclick="executeMasterCommand('backup_create')">Create Backup</div>
            </div>
            
            <!-- Navigation Shortcuts -->
            <div class="command-section">
                <div class="command-title">üó∫Ô∏è Navigation</div>
                <div class="command-btn" onclick="window.location.href='/quantum_asi_dashboard'">ASI Dashboard</div>
                <div class="command-btn" onclick="window.location.href='/watson_goals_dashboard'">Goals</div>
                <div class="command-btn" onclick="window.location.href='/technical_testing'">Testing</div>
                <div class="command-btn" onclick="window.location.href='/quantum_devops_audit'">DevOps</div>
            </div>
            
            <!-- Status Display -->
            <div class="status-display" id="commandStatus">
                üîë Enter master key to unlock commands<br>
                üí° Use Ctrl+Shift+M to toggle this overlay<br>
                üëë Only visible to authenticated users
            </div>
        </div>
    </div>

    <script>
        let masterAuthenticated = false;
        let overlayVisible = false;
        let masterKey = 'TRAXOVO_MASTER_2025';
        
        // Keyboard shortcut: Ctrl+Shift+M
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'M') {
                e.preventDefault();
                toggleMasterOverlay();
            }
        });
        
        function toggleMasterOverlay() {
            const overlay = document.getElementById('masterCommandOverlay');
            overlayVisible = !overlayVisible;
            
            if (overlayVisible) {
                overlay.classList.add('active');
                document.getElementById('masterKeyInput').focus();
            } else {
                overlay.classList.remove('active');
            }
        }
        
        function hideMasterOverlay() {
            document.getElementById('masterCommandOverlay').classList.remove('active');
            overlayVisible = false;
        }
        
        function minimizeMasterOverlay() {
            hideMasterOverlay();
        }
        
        function showMasterOverlay() {
            document.getElementById('masterCommandOverlay').classList.add('active');
            overlayVisible = true;
        }
        
        function handleMasterKeyPress(event) {
            if (event.key === 'Enter') {
                authenticateMaster();
            }
        }
        
        function authenticateMaster() {
            const inputKey = document.getElementById('masterKeyInput').value;
            const statusDiv = document.getElementById('authStatus');
            
            if (inputKey === masterKey) {
                masterAuthenticated = true;
                statusDiv.innerHTML = '<span class="auth-success">‚úÖ Master authenticated</span>';
                updateCommandStatus('üîì Master command interface unlocked<br>üëë All administrative functions available');
            } else {
                statusDiv.innerHTML = '<span class="auth-error">‚ùå Invalid master key</span>';
                updateCommandStatus('üîí Authentication failed<br>üí° Hint: TRAXOVO_MASTER_2025');
            }
        }
        
        function executeMasterCommand(command) {
            if (!masterAuthenticated) {
                updateCommandStatus('üîí Authentication required<br>Enter master key first');
                return;
            }
            
            updateCommandStatus(`‚ö° Executing: ${command}<br>üîÑ Processing...`);
            
            fetch('/api/master_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    master_key: masterKey,
                    command: command
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let statusText = `‚úÖ Command: ${command}<br>`;
                    if (data.result) {
                        Object.keys(data.result).forEach(key => {
                            if (typeof data.result[key] === 'string' || typeof data.result[key] === 'boolean') {
                                statusText += `${key}: ${data.result[key]}<br>`;
                            }
                        });
                    }
                    updateCommandStatus(statusText);
                } else {
                    updateCommandStatus(`‚ùå Command failed: ${data.error || 'Unknown error'}`);
                }
            })
            .catch(error => {
                updateCommandStatus(`üö® Network error: ${error.message}`);
            });
        }
        
        function updateCommandStatus(message) {
            const statusDiv = document.getElementById('commandStatus');
            const timestamp = new Date().toLocaleTimeString();
            statusDiv.innerHTML = `[${timestamp}] ${message}`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        function setOverlaySize(size) {
            const overlay = document.getElementById('masterCommandOverlay');
            const isMobile = window.innerWidth <= 768;
            
            // Remove all size classes
            overlay.classList.remove('compact', 'expanded', 'fullscreen', 'mobile-compact', 'mobile-fullscreen');
            
            // Update button states
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
            
            if (isMobile) {
                if (size === 'compact') {
                    overlay.classList.add('mobile-compact');
                    document.getElementById('compactBtn').classList.add('active');
                } else if (size === 'fullscreen') {
                    overlay.classList.add('mobile-fullscreen');
                    document.getElementById('fullscreenBtn').classList.add('active');
                } else {
                    document.getElementById('normalBtn').classList.add('active');
                }
            } else {
                if (size === 'compact') {
                    overlay.classList.add('compact');
                    document.getElementById('compactBtn').classList.add('active');
                } else if (size === 'expanded') {
                    overlay.classList.add('expanded');
                    document.getElementById('expandedBtn').classList.add('active');
                } else if (size === 'fullscreen') {
                    overlay.classList.add('fullscreen');
                    document.getElementById('fullscreenBtn').classList.add('active');
                } else {
                    document.getElementById('normalBtn').classList.add('active');
                }
            }
            
            // Store preference
            localStorage.setItem('masterOverlaySize', size);
        }
        
        function adaptToScreenSize() {
            const overlay = document.getElementById('masterCommandOverlay');
            const isMobile = window.innerWidth <= 768;
            const currentSize = localStorage.getItem('masterOverlaySize') || 'normal';
            
            if (isMobile && overlay.classList.contains('expanded')) {
                setOverlaySize('normal');
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', adaptToScreenSize);
        
        // Make overlay draggable
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;
        
        const overlay = document.getElementById('masterCommandOverlay');
        const header = overlay.querySelector('.master-header');
        
        header.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);
        
        function dragStart(e) {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
            
            if (e.target === header) {
                isDragging = true;
            }
        }
        
        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                xOffset = currentX;
                yOffset = currentY;
                
                overlay.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
            }
        }
        
        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }
        
        // Initialize with saved size preference
        setTimeout(() => {
            const savedSize = localStorage.getItem('masterOverlaySize') || 'normal';
            setOverlaySize(savedSize);
            
            if (window.location.search.includes('debug=master')) {
                showMasterOverlay();
            }
        }, 1000);
    </script>
</body>
</html>
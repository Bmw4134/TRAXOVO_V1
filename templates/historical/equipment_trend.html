{% extends "base.html" %}

{% block title %}Equipment Trend Analysis{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Equipment Trend Analysis</h1>
        <a href="{{ url_for('historical.historical_dashboard') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Equipment Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <p><strong>Equipment ID:</strong> {{ equipment.id }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Type:</strong> {{ equipment.type }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Status:</strong> 
                                <span class="badge {% if equipment.status == 'Active' %}bg-success{% else %}bg-danger{% endif %}">
                                    {{ equipment.status }}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% if trend_data.error is defined %}
    <div class="alert alert-warning">
        {{ trend_data.error }}
    </div>
    {% else %}
    
    {% if trend_data.chart_path is defined %}
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Utilization Trend</h5>
                </div>
                <div class="card-body text-center">
                    <img src="{{ url_for('static', filename=trend_data.chart_path) }}" alt="Equipment Trend Chart" class="img-fluid rounded">
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Trend Analysis</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for key, trend in trend_data.trends.items() %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ key|replace('_', ' ')|title }}
                            <span class="badge {% if trend.direction == 'up' %}bg-success{% elif trend.direction == 'down' %}bg-danger{% else %}bg-secondary{% endif %} rounded-pill">
                                {% if trend.direction == 'up' %}
                                <i class="fas fa-arrow-up"></i> {{ (trend.magnitude * 100)|round(1) }}%
                                {% elif trend.direction == 'down' %}
                                <i class="fas fa-arrow-down"></i> {{ (trend.magnitude * -100)|round(1) }}%
                                {% else %}
                                <i class="fas fa-minus"></i> Steady
                                {% endif %}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Forecasts</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for key, value in trend_data.forecast.items() %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ key|replace('_', ' ')|replace('next', 'Next')|title }}
                            <span class="badge bg-info rounded-pill">
                                {% if 'amount' in key %}
                                ${{ value|round(2)|int|format_number }}
                                {% else %}
                                {{ value|round(1) }}
                                {% endif %}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Monthly Data</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th class="text-center">Days Allocated</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-center">Utilization Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in range(trend_data.data.months|length) %}
                                <tr>
                                    <td>{{ trend_data.data.months[i] }}</td>
                                    <td class="text-center">{{ trend_data.data.days_allocated[i]|round(1) }}</td>
                                    <td class="text-end">${{ trend_data.data.total_amount[i]|round(2)|int|format_number }}</td>
                                    <td class="text-center">
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-success" role="progressbar" 
                                                style="width: {{ trend_data.data.utilization_rate[i] }}%;" 
                                                aria-valuenow="{{ trend_data.data.utilization_rate[i] }}" 
                                                aria-valuemin="0" aria-valuemax="100">
                                                {{ trend_data.data.utilization_rate[i]|round(1) }}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
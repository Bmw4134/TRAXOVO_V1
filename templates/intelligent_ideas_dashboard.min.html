<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TRAXOVO - Intelligent Ideas Hub</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .floating-idea-bubble {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #ff6b6b, #feca57);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        z-index: 1000;
        animation: pulse 2s infinite;
      }

      .floating-idea-bubble:hover {
        transform: scale(1.1);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .idea-input-modal {
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
      }

      .idea-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 15px;
        transition: all 0.3s ease;
      }

      .idea-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      }

      .ai-analysis-badge {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 20px;
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
      }

      .consolidation-alert {
        background: linear-gradient(135deg, #ffeaa7, #fab1a0);
        border: none;
        border-radius: 10px;
        padding: 1rem;
        margin: 1rem 0;
      }

      .development-pipeline {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
      }

      .pipeline-stage {
        background: linear-gradient(135deg, #74b9ff, #0984e3);
        color: white;
        border-radius: 10px;
        padding: 1rem;
        margin: 0.5rem;
        text-align: center;
        transition: all 0.3s ease;
      }

      .pipeline-stage:hover {
        transform: scale(1.05);
      }

      .navbar-custom {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: none;
      }

      .vote-buttons {
        display: flex;
        gap: 0.5rem;
      }

      .vote-btn {
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .vote-btn:hover {
        transform: scale(1.1);
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container">
        <a class="navbar-brand text-white fw-bold" href="/dashboard"
          ><i class="bi bi-arrow-left me-2"></i>TRAXOVO Ideas Hub </a
        ><span class="navbar-text text-white"
          ><i class="bi bi-lightbulb-fill me-1"></i>AI-Powered Innovation
        </span>
      </div>
    </nav>
    <div class="container py-5">
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="idea-card p-4 text-center">
            <h3 class="text-primary">{{ ideas|length }}</h3>
            <p class="mb-0">Total Ideas</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="idea-card p-4 text-center">
            <h3 class="text-success">{{ consolidated_ideas|length }}</h3>
            <p class="mb-0">Consolidated</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="idea-card p-4 text-center">
            <h3 class="text-warning">
              {{ development_pipeline.development_planned|length }}
            </h3>
            <p class="mb-0">In Pipeline</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="idea-card p-4 text-center">
            <h3 class="text-info">
              {{ development_pipeline.deployed|length }}
            </h3>
            <p class="mb-0">Deployed</p>
          </div>
        </div>
      </div>
      <div class="development-pipeline">
        <h4 class="mb-4">
          <i class="bi bi-diagram-3 me-2"></i>Development Pipeline
        </h4>
        <div class="row">
          <div class="col-md-2">
            <div class="pipeline-stage">
              <h6>Pending Review</h6>
              <span class="badge bg-light text-dark"
                >{{ development_pipeline.pending_review|length }}</span
              >
            </div>
          </div>
          <div class="col-md-2">
            <div class="pipeline-stage">
              <h6>Planned</h6>
              <span class="badge bg-light text-dark"
                >{{ development_pipeline.development_planned|length }}</span
              >
            </div>
          </div>
          <div class="col-md-2">
            <div class="pipeline-stage">
              <h6>In Development</h6>
              <span class="badge bg-light text-dark"
                >{{ development_pipeline.in_development|length }}</span
              >
            </div>
          </div>
          <div class="col-md-2">
            <div class="pipeline-stage">
              <h6>Testing</h6>
              <span class="badge bg-light text-dark"
                >{{ development_pipeline.testing|length }}</span
              >
            </div>
          </div>
          <div class="col-md-2">
            <div class="pipeline-stage">
              <h6>Deployed</h6>
              <span class="badge bg-light text-dark"
                >{{ development_pipeline.deployed|length }}</span
              >
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        {% for idea in ideas %}
        <div class="col-md-6 mb-4">
          <div class="idea-card p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h6 class="fw-bold">{{ idea.submitter }}</h6>
              <div class="vote-buttons">
                <button
                  class="btn btn-success vote-btn"
                  onclick="voteIdea('{{ idea.id }}', 'up')"
                >
                  <i class="bi bi-arrow-up"></i></button
                ><span class="align-self-center mx-2">{{ idea.votes }}</span
                ><button
                  class="btn btn-danger vote-btn"
                  onclick="voteIdea('{{ idea.id }}', 'down')"
                >
                  <i class="bi bi-arrow-down"></i>
                </button>
              </div>
            </div>
            <p class="text-muted">{{ idea.text }}</p>

            {% if idea.ai_analysis %}
            <div class="mb-3">
              <span class="ai-analysis-badge"
                >{{ idea.ai_analysis.category }}</span
              ><span
                class="badge bg-{{ 'danger' if idea.ai_analysis.priority == 'High' else 'warning' if idea.ai_analysis.priority == 'Medium' else 'secondary' }}"
              >
                {{ idea.ai_analysis.priority }} Priority </span
              ><span class="badge bg-info"
                >{{ idea.ai_analysis.development_estimate }}</span
              >
            </div>
            {% endif %} {% if idea.similar_ideas %}
            <div class="consolidation-alert">
              <small
                ><i class="bi bi-exclamation-triangle me-1"></i> Similar to {{
                idea.similar_ideas|length }} other ideas - Consider
                consolidation</small
              >
            </div>
            {% endif %}

            <div class="mt-3">
              <button
                class="btn btn-primary btn-sm"
                onclick="generateDevelopmentPlan('{{ idea.id }}')"
              >
                <i class="bi bi-gear me-1"></i>Generate Plan
              </button>
              {% if idea.similar_ideas %}
              <button
                class="btn btn-warning btn-sm"
                onclick="consolidateIdea('{{ idea.id }}')"
              >
                <i class="bi bi-arrows-merge me-1"></i>Consolidate
              </button>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div
      class="floating-idea-bubble"
      data-bs-toggle="modal"
      data-bs-target="#ideaModal"
    >
      <i class="bi bi-lightbulb-fill text-white" style="font-size: 2rem"></i>
    </div>
    <div class="modal fade idea-input-modal" id="ideaModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div
          class="modal-content"
          style="
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
          "
        >
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold">
              <i class="bi bi-lightbulb-fill text-warning me-2"></i>Submit Your
              Breakthrough Idea
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="ideaSubmissionForm">
              <div class="mb-3">
                <label class="form-label fw-bold">Your Name</label
                ><input
                  type="text"
                  class="form-control"
                  id="submitterName"
                  placeholder="Enter your name"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label fw-bold">Describe Your Idea</label
                ><textarea
                  class="form-control"
                  id="ideaText"
                  rows="5"
                  placeholder="Describe your breakthrough idea in detail... AI will analyze it for feasibility, priority, and development timeline."
                  required
                ></textarea>
              </div>
              <div class="alert alert-info">
                <i class="bi bi-robot me-2"></i
                ><strong>AI Enhancement:</strong> Your idea will be
                automatically analyzed for category, priority, feasibility, and
                development estimate. Similar ideas will be identified for
                potential consolidation.
              </div>
            </form>
          </div>
          <div class="modal-footer border-0">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel</button
            ><button
              type="button"
              class="btn btn-primary"
              onclick="submitIdea()"
            >
              <i class="bi bi-send me-1"></i>Submit Idea
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="alertContainer"
      style="position: fixed; top: 20px; right: 20px; z-index: 1050"
    ></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function submitIdea() {
        const submitter = document.getElementById("submitterName").value;
        const ideaText = document.getElementById("ideaText").value;

        if (!submitter || !ideaText) {
          showAlert("Please fill in all fields", "danger");
          return;
        }

        // Show loading state
        const submitBtn = event.target;
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML =
          '<i class="bi bi-hourglass-split me-1"></i>AI Analyzing...';
        submitBtn.disabled = true;

        fetch("/ideas/api/submit-idea", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            submitter: submitter,
            idea_text: ideaText,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Idea submitted and analyzed successfully!", "success");
              document.getElementById("ideaSubmissionForm").reset();
              bootstrap.Modal.getInstance(
                document.getElementById("ideaModal"),
              ).hide();

              // Show AI analysis
              if (data.ai_analysis) {
                setTimeout(() => {
                  showAIAnalysis(
                    data.ai_analysis,
                    data.consolidation_opportunities,
                  );
                }, 1000);
              }

              // Refresh page after short delay
              setTimeout(() => {
                window.location.reload();
              }, 3000);
            } else {
              showAlert("Error: " + data.message, "danger");
            }
          })
          .catch((error) => {
            showAlert("Network error occurred", "danger");
            console.error("Error:", error);
          })
          .finally(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          });
      }

      function voteIdea(ideaId, voteType) {
        fetch("/ideas/api/vote-idea", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            idea_id: ideaId,
            vote_type: voteType,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert(`Vote ${voteType} recorded!`, "success");
              setTimeout(() => window.location.reload(), 1000);
            } else {
              showAlert("Error voting", "danger");
            }
          });
      }

      function generateDevelopmentPlan(ideaId) {
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML =
          '<i class="bi bi-hourglass-split me-1"></i>Generating...';
        btn.disabled = true;

        fetch("/ideas/api/generate-development-plan", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            idea_id: ideaId,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Development plan generated!", "success");
              showDevelopmentPlan(data.development_plan);
            } else {
              showAlert("Error generating plan", "danger");
            }
          })
          .finally(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
          });
      }

      function showAlert(message, type) {
        const alertHtml = `
<div class="alert alert-${type} alert-dismissible fade show" role="alert">
${message}
<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
`;
        document
          .getElementById("alertContainer")
          .insertAdjacentHTML("beforeend", alertHtml);

        // Auto-remove after 5 seconds
        setTimeout(() => {
          const alerts = document.querySelectorAll("#alertContainer .alert");
          if (alerts.length > 0) {
            alerts[0].remove();
          }
        }, 5000);
      }

      function showAIAnalysis(analysis, consolidation) {
        const analysisHtml = `
<div class="alert alert-info"><h6><i class="bi bi-robot me-2"></i>AI Analysis Complete</h6><p><strong>Category:</strong> ${analysis.category}</p><p><strong>Priority:</strong> ${analysis.priority}</p><p><strong>Feasibility:</strong> ${analysis.feasibility}</p><p><strong>Development Estimate:</strong> ${analysis.development_estimate}</p>
${
  consolidation.should_consolidate
    ? `<p class="text-warning"><strong>Consolidation Opportunity:</strong> ${consolidation.recommendation}</p>`
    : ""
}
</div>
`;
        document
          .getElementById("alertContainer")
          .insertAdjacentHTML("beforeend", analysisHtml);
      }

      function showDevelopmentPlan(plan) {
        const planHtml = `
<div class="alert alert-success"><h6><i class="bi bi-gear me-2"></i>Development Plan Generated</h6><p><strong>Timeline:</strong> ${plan.timeline}</p><p><strong>Phases:</strong> ${plan.phases.join(", ")}</p><p><strong>Resources:</strong> ${plan.resources_needed.join(", ")}</p></div>
`;
        document
          .getElementById("alertContainer")
          .insertAdjacentHTML("beforeend", planHtml);
      }

      // Auto-refresh every 30 seconds to show new ideas
      setInterval(() => {
        // Only refresh if no modals are open
        if (!document.querySelector(".modal.show")) {
          window.location.reload();
        }
      }, 30000);
    </script>
  </body>
</html>

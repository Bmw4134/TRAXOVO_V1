<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>TRAXOVO AI Assistant - Internal LLM</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style>
.ai-header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 1.5rem;
border-radius: 10px;
}

.chat-container {
height: 500px;
overflow-y: auto;
border: 1px solid #dee2e6;
border-radius: 10px;
padding: 1rem;
background: #f8f9fa;
}

.message {
margin-bottom: 1rem;
padding: 0.75rem 1rem;
border-radius: 10px;
max-width: 80%;
}

.message.user {
background: #007bff;
color: white;
margin-left: auto;
}

.message.ai {
background: white;
border: 1px solid #dee2e6;
margin-right: auto;
}

.knowledge-card {
background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
color: white;
border-radius: 10px;
padding: 1rem;
}

.insight-card {
border-left: 4px solid #28a745;
transition: transform 0.3s ease;
}

.insight-card:hover {
transform: translateY(-2px);
}

.query-suggestion {
cursor: pointer;
transition: background-color 0.3s ease;
}

.query-suggestion:hover {
background-color: #e9ecef;
}

.typing-indicator {
display: none;
}

.typing-indicator.show {
display: block;
}

.typing-dots {
display: inline-block;
position: relative;
width: 40px;
height: 10px;
}

.typing-dots div {
position: absolute;
top: 0;
width: 8px;
height: 8px;
border-radius: 50%;
background: #007bff;
animation: typing 1.4s infinite ease-in-out both;
}

.typing-dots div:nth-child(1) { left: 0; animation-delay: -0.32s; }
.typing-dots div:nth-child(2) { left: 12px; animation-delay: -0.16s; }
.typing-dots div:nth-child(3) { left: 24px; }

@keyframes typing {
0%, 80%, 100% { transform: scale(0); }
40% { transform: scale(1); }
}
</style></head><body><div class="container-fluid"><div class="row">

{% include 'includes/sidebar.html' %}


<div class="col-lg-10 offset-lg-2 p-4"><div class="ai-header mb-4"><div class="d-flex justify-content-between align-items-center"><div><h1><i class="fas fa-brain me-2"></i>TRAXOVO AI Assistant</h1><p class="mb-0">Internal LLM trained on your construction data</p></div><div class="knowledge-card"><div class="text-center"><h5>Knowledge Base</h5><div class="row"><div class="col-4"><strong>{{ data.knowledge_base.equipment_types }}</strong><small class="d-block">Equipment Types</small></div><div class="col-4"><strong>{{ data.knowledge_base.revenue_categories }}</strong><small class="d-block">Revenue Categories</small></div><div class="col-4"><strong>{{ data.knowledge_base.operational_metrics }}</strong><small class="d-block">Metrics Tracked</small></div></div></div></div></div></div>


{% if data.recent_insights %}
<div class="row mb-4"><div class="col-12"><h5><i class="fas fa-lightbulb me-2"></i>Recent AI Insights</h5><div class="row">
{% for insight in data.recent_insights %}
<div class="col-md-6 mb-2"><div class="card insight-card"><div class="card-body"><div class="d-flex justify-content-between align-items-center"><span>{{ insight.message }}</span><span class="badge bg-{% if insight.priority == 'high' %}danger{% elif insight.priority == 'medium' %}warning{% else %}success{% endif %}">
{{ insight.priority.title() }}
</span></div></div></div></div>
{% endfor %}
</div></div></div>
{% endif %}


<div class="row"><div class="col-md-8"><div class="card"><div class="card-header"><h5><i class="fas fa-comments me-2"></i>Chat with TRAXOVO AI</h5></div><div class="card-body p-0"><div class="chat-container" id="chatContainer"><div class="message ai"><strong>TRAXOVO AI:</strong> Hello! I'm your internal AI assistant trained on your construction fleet data.
I can help you analyze equipment performance, revenue patterns, and operational efficiency.
What would you like to know about your fleet?
</div><div class="typing-indicator" id="typingIndicator"><div class="message ai"><strong>TRAXOVO AI:</strong><div class="typing-dots"><div></div><div></div><div></div></div></div></div></div></div><div class="card-footer"><div class="input-group"><input type="text" class="form-control" id="queryInput"
placeholder="Ask about equipment utilization, revenue analysis, optimization suggestions..."
onkeypress="handleKeyPress(event)"><button class="btn btn-primary" onclick="sendQuery()"><i class="fas fa-paper-plane"></i></button></div></div></div></div><div class="col-md-4"><div class="card mb-3"><div class="card-header"><h6><i class="fas fa-question-circle me-2"></i>Suggested Queries</h6></div><div class="card-body p-0">
{% for query in data.suggested_queries %}
<div class="query-suggestion p-3 border-bottom" onclick="selectQuery('{{ query }}')"><i class="fas fa-arrow-right me-2 text-primary"></i>{{ query }}
</div>
{% endfor %}
</div></div><div class="card"><div class="card-header"><h6><i class="fas fa-info-circle me-2"></i>AI Context</h6></div><div class="card-body"><p><strong>Business:</strong> {{ data.ai_context.business_type }}</p><p><strong>Company:</strong> {{ data.ai_context.company_name }}</p><p><strong>Monthly Revenue:</strong> ${{ "{:,.0f}".format(data.ai_context.monthly_revenue) }}</p><p><strong>Specializations:</strong></p><ul class="list-unstyled">
{% for spec in data.ai_context.specializations %}
<li><i class="fas fa-check text-success me-2"></i>{{ spec }}</li>
{% endfor %}
</ul></div></div></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script>
function handleKeyPress(event) {
if (event.key === 'Enter') {
sendQuery();
}
}

function selectQuery(query) {
document.getElementById('queryInput').value = query;
sendQuery();
}

function sendQuery() {
const queryInput = document.getElementById('queryInput');
const query = queryInput.value.trim();

if (!query) return;

// Add user message to chat
addMessage(query, 'user');

// Clear input
queryInput.value = '';

// Show typing indicator
showTypingIndicator();

// Send query to AI
fetch('/api/ai-query', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ query: query })
})
.then(response => response.json())
.then(result => {
hideTypingIndicator();

if (result.success) {
addMessage(result.response, 'ai');
} else {
addMessage(`I encountered an issue: ${result.error}. ${result.fallback_response || 'Please try rephrasing your question.'}`, 'ai');
}
})
.catch(error => {
hideTypingIndicator();
addMessage('I\'m having trouble connecting to the AI service. Please check your configuration and try again.', 'ai');
});
}

function addMessage(content, sender) {
const chatContainer = document.getElementById('chatContainer');
const messageDiv = document.createElement('div');
messageDiv.className = `message ${sender}`;

if (sender === 'ai') {
messageDiv.innerHTML = `<strong>TRAXOVO AI:</strong> ${content}`;
} else {
messageDiv.innerHTML = content;
}

// Insert before typing indicator
const typingIndicator = document.getElementById('typingIndicator');
chatContainer.insertBefore(messageDiv, typingIndicator);

// Scroll to bottom
chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showTypingIndicator() {
document.getElementById('typingIndicator').classList.add('show');
document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
}

function hideTypingIndicator() {
document.getElementById('typingIndicator').classList.remove('show');
}

// Auto-focus on input
document.addEventListener('DOMContentLoaded', function() {
document.getElementById('queryInput').focus();
});
</script></body></html>
{% extends "base.html" %}

{% block title %}Job Zone Management - TRAXORA{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1>Job Zone Management</h1>
            <p class="text-muted">Manage work zones and working hours for your job sites</p>
        </div>
        <div class="col-md-4 text-end">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createZoneModal">
                <i class="bi bi-plus-circle me-2"></i> Create Job Zone
            </button>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Active Job Zones</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Job Site</th>
                                    <th>Type</th>
                                    <th>Coordinates</th>
                                    <th>Working Days</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if job_zones %}
                                    {% for zone in job_zones %}
                                    <tr>
                                        <td>{{ zone.name }}</td>
                                        <td>{{ zone.job_site.name }}</td>
                                        <td>{{ zone.zone_type|title }}</td>
                                        <td>
                                            <small>
                                                Lat: {{ zone.latitude_min }} to {{ zone.latitude_max }}<br>
                                                Long: {{ zone.longitude_min }} to {{ zone.longitude_max }}
                                            </small>
                                        </td>
                                        <td>
                                            {% for day in zone.working_hours %}
                                                {% if day.is_working_day %}
                                                    {% if day.day_of_week == 0 %}Mon{% elif day.day_of_week == 1 %}Tue{% elif day.day_of_week == 2 %}Wed{% elif day.day_of_week == 3 %}Thu{% elif day.day_of_week == 4 %}Fri{% elif day.day_of_week == 5 %}Sat{% elif day.day_of_week == 6 %}Sun{% endif %},
                                                {% endif %}
                                            {% endfor %}
                                        </td>
                                        <td>
                                            <a href="{{ url_for('job_zone.view_job_zone', job_zone_id=zone.id) }}" class="btn btn-sm btn-info">
                                                <i class="bi bi-eye"></i> View
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center py-4">No job zones found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Job Zone Modal -->
<div class="modal fade" id="createZoneModal" tabindex="-1" aria-labelledby="createZoneModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="createZoneModalLabel">Create New Job Zone</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{{ url_for('job_zone.create_job_zone') }}" method="POST">
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="name" class="form-label">Zone Name</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="job_site_id" class="form-label">Job Site</label>
                            <select class="form-select" id="job_site_id" name="job_site_id" required>
                                <option value="">Select a job site</option>
                                {% for site in job_sites %}
                                <option value="{{ site.id }}">{{ site.name }} ({{ site.job_number }})</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="2"></textarea>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="zone_type" class="form-label">Zone Type</label>
                            <select class="form-select" id="zone_type" name="zone_type">
                                <option value="work">Work Zone</option>
                                <option value="storage">Storage Area</option>
                                <option value="maintenance">Maintenance Area</option>
                                <option value="rest">Rest Area</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="priority" class="form-label">Priority</label>
                            <input type="number" class="form-control" id="priority" name="priority" value="1" min="1" max="10">
                            <small class="text-muted">Higher priority zones take precedence when overlapping</small>
                        </div>
                    </div>
                    
                    <h5 class="mt-4 mb-3">Geofence Boundary</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="latitude_min" class="form-label">Minimum Latitude</label>
                                <input type="number" class="form-control" id="latitude_min" name="latitude_min" step="0.0000001" required>
                            </div>
                            <div class="mb-3">
                                <label for="latitude_max" class="form-label">Maximum Latitude</label>
                                <input type="number" class="form-control" id="latitude_max" name="latitude_max" step="0.0000001" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="longitude_min" class="form-label">Minimum Longitude</label>
                                <input type="number" class="form-control" id="longitude_min" name="longitude_min" step="0.0000001" required>
                            </div>
                            <div class="mb-3">
                                <label for="longitude_max" class="form-label">Maximum Longitude</label>
                                <input type="number" class="form-control" id="longitude_max" name="longitude_max" step="0.0000001" required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Job Zone</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
{% extends 'base.html' %}

{% block title %}Kaizen Dashboard - SYSTEMSMITH{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Kaizen Dashboard</h1>
        <div>
            <a href="{{ url_for('kaizen.health') }}" class="btn btn-outline-primary">System Health</a>
            <a href="{{ url_for('kaizen.suggestions') }}" class="btn btn-outline-primary">Suggestions</a>
            <a href="{{ url_for('kaizen.mappings') }}" class="btn btn-outline-primary">Asset-Employee Mappings</a>
        </div>
    </div>

    <!-- System Health Score -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">System Health Score</h5>
        </div>
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3 text-center">
                    <div class="position-relative d-inline-block">
                        <canvas id="healthChart" width="150" height="150"></canvas>
                        <div class="position-absolute top-50 start-50 translate-middle">
                            <h2 class="mb-0">{{ health_score.overall_health_score|default(0)|round|int }}%</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label d-flex justify-content-between">
                                    <span>Data Completeness</span>
                                    <span class="text-primary">{{ health_score.data_completeness.score|default(0)|round(1) }}%</span>
                                </label>
                                <div class="progress">
                                    <div class="progress-bar bg-primary" role="progressbar" 
                                         style="width: {{ health_score.data_completeness.score|default(0) }}%" 
                                         aria-valuenow="{{ health_score.data_completeness.score|default(0) }}" 
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label d-flex justify-content-between">
                                    <span>File Match Rate</span>
                                    <span class="text-success">{{ health_score.file_match_rate.score|default(0)|round(1) }}%</span>
                                </label>
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         style="width: {{ health_score.file_match_rate.score|default(0) }}%" 
                                         aria-valuenow="{{ health_score.file_match_rate.score|default(0) }}" 
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label d-flex justify-content-between">
                                    <span>Asset Assignment</span>
                                    <span class="text-info">{{ health_score.asset_assignment_accuracy.score|default(0)|round(1) }}%</span>
                                </label>
                                <div class="progress">
                                    <div class="progress-bar bg-info" role="progressbar" 
                                         style="width: {{ health_score.asset_assignment_accuracy.score|default(0) }}%" 
                                         aria-valuenow="{{ health_score.asset_assignment_accuracy.score|default(0) }}" 
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="text-muted mb-0">
                        <i class="fas fa-info-circle me-1"></i> 
                        Last updated: {{ health_score.timestamp|default('Never') }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Improvement Suggestions -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Top Improvement Suggestions</h5>
        </div>
        <div class="card-body">
            {% if suggestions %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Priority</th>
                                <th>Category</th>
                                <th>Suggestion</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for suggestion in suggestions %}
                                <tr>
                                    <td>
                                        <span class="badge {% if suggestion.priority == 1 %}bg-danger
                                                           {% elif suggestion.priority == 2 %}bg-warning
                                                           {% else %}bg-info{% endif %}">
                                            {{ suggestion.priority }}
                                        </span>
                                    </td>
                                    <td>{{ suggestion.category }}</td>
                                    <td>{{ suggestion.description }}</td>
                                    <td>{{ suggestion.timestamp|default('-') }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('kaizen.suggestions') }}" class="btn btn-outline-primary">View All Suggestions</a>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> No improvement suggestions found. The system may need to analyze more data.
                </div>
            {% endif %}
        </div>
    </div>

    <!-- About Kaizen -->
    <div class="card">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">About Kaizen</h5>
        </div>
        <div class="card-body">
            <p>The Kaizen module provides continuous improvement through self-evaluation:</p>
            <div class="row">
                <div class="col-md-6">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex align-items-center">
                            <i class="fas fa-chart-line text-primary me-3"></i>
                            <div>
                                <h6 class="mb-0">System Health Monitoring</h6>
                                <p class="text-muted small mb-0">Continuous monitoring of data quality and system performance</p>
                            </div>
                        </li>
                        <li class="list-group-item d-flex align-items-center">
                            <i class="fas fa-lightbulb text-primary me-3"></i>
                            <div>
                                <h6 class="mb-0">Improvement Suggestions</h6>
                                <p class="text-muted small mb-0">AI-driven insights to enhance system performance</p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex align-items-center">
                            <i class="fas fa-users text-primary me-3"></i>
                            <div>
                                <h6 class="mb-0">Employee-Asset Mapping</h6>
                                <p class="text-muted small mb-0">Intelligent matching of assets to employees</p>
                            </div>
                        </li>
                        <li class="list-group-item d-flex align-items-center">
                            <i class="fas fa-sync-alt text-primary me-3"></i>
                            <div>
                                <h6 class="mb-0">Continuous Adaptation</h6>
                                <p class="text-muted small mb-0">Self-improving processes for better accuracy</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('healthChart').getContext('2d');
    const healthScore = {{ health_score.overall_health_score|default(0) }};
    
    // Determine color based on score
    let color = '#dc3545'; // red
    if (healthScore >= 80) {
        color = '#28a745'; // green
    } else if (healthScore >= 60) {
        color = '#ffc107'; // yellow
    } else if (healthScore >= 40) {
        color = '#fd7e14'; // orange
    }
    
    const healthChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [healthScore, 100 - healthScore],
                backgroundColor: [color, '#e9ecef'],
                borderWidth: 0
            }]
        },
        options: {
            cutout: '75%',
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    enabled: false
                }
            }
        }
    });
});
</script>
{% endblock %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Legacy Timekeeping System - TRAXOVO</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .watson-header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 1.5rem 0;
        border-bottom: 3px solid #e74c3c;
      }
      .legacy-card {
        border: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        margin-bottom: 1.5rem;
      }
      .legacy-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      .metric-display {
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
      }
      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }
      .status-active {
        background-color: #27ae60;
      }
      .status-inactive {
        background-color: #e74c3c;
      }
      .status-pending {
        background-color: #f39c12;
      }
      .timesheet-table {
        font-size: 0.9rem;
      }
      .job-cost-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 1.5rem;
      }
      .automation-status {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="watson-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1><i class="fas fa-clock me-3"></i>Legacy Timekeeping System</h1>
            <p class="lead mb-0">
              Watson Admin Access - Timekeeping, Job Costing & Quantity
              Management
            </p>
          </div>
          <div class="col-md-4 text-end">
            <span class="badge bg-danger fs-6">WATSON ONLY</span>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid mt-4">
      <!-- Autonomous Testing Status -->
      <div class="automation-status">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h5 class="mb-1">
              <i class="fas fa-robot me-2"></i>Autonomous Testing Active
            </h5>
            <small
              >Headless browser automation continuously testing this
              module</small
            >
          </div>
          <div class="col-md-4 text-end">
            <button class="btn btn-light btn-sm" onclick="runAutonomousTest()">
              <i class="fas fa-play me-1"></i>Run Test Suite
            </button>
          </div>
        </div>
      </div>

      <!-- Quick Stats Overview -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
          <div class="card legacy-card">
            <div class="card-body text-center">
              <div class="metric-display" id="activeTimesheets">47</div>
              <div class="text-muted">Active Timesheets</div>
              <small class="text-success"
                ><i class="fas fa-arrow-up"></i> +12% this week</small
              >
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="card legacy-card">
            <div class="card-body text-center">
              <div class="metric-display" id="totalHours">1,847.5</div>
              <div class="text-muted">Total Hours (Week)</div>
              <small class="text-info"
                ><i class="fas fa-clock"></i> Standard tracking</small
              >
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="card legacy-card">
            <div class="card-body text-center">
              <div class="metric-display" id="jobCosts">$89,420</div>
              <div class="text-muted">Job Costs (Week)</div>
              <small class="text-warning"
                ><i class="fas fa-dollar-sign"></i> Under budget</small
              >
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="card legacy-card">
            <div class="card-body text-center">
              <div class="metric-display" id="efficiency">94.7%</div>
              <div class="text-muted">Labor Efficiency</div>
              <small class="text-success"
                ><i class="fas fa-chart-line"></i> Above target</small
              >
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Active Timesheets -->
        <div class="col-lg-8">
          <div class="card legacy-card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-users me-2"></i>Active Employee Timesheets
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table
                  class="table table-hover timesheet-table"
                  id="timesheetTable"
                >
                  <thead class="table-light">
                    <tr>
                      <th>Employee</th>
                      <th>Job Code</th>
                      <th>Hours Today</th>
                      <th>Week Total</th>
                      <th>Status</th>
                      <th>Last Update</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <strong>Rodriguez, M.</strong><br /><small
                          >Equipment Operator</small
                        >
                      </td>
                      <td>JOB-2019-044</td>
                      <td>7.5</td>
                      <td>37.5</td>
                      <td>
                        <span class="status-indicator status-active"></span
                        >Active
                      </td>
                      <td>11:47 AM</td>
                    </tr>
                    <tr>
                      <td>
                        <strong>Thompson, J.</strong><br /><small
                          >Heavy Machinery Op</small
                        >
                      </td>
                      <td>JOB-2021-017</td>
                      <td>8.0</td>
                      <td>40.0</td>
                      <td>
                        <span class="status-indicator status-active"></span
                        >Active
                      </td>
                      <td>11:52 AM</td>
                    </tr>
                    <tr>
                      <td>
                        <strong>Davis, R.</strong><br /><small
                          >Site Supervisor</small
                        >
                      </td>
                      <td>JOB-2019-044</td>
                      <td>6.25</td>
                      <td>31.25</td>
                      <td>
                        <span class="status-indicator status-pending"></span
                        >Break
                      </td>
                      <td>10:15 AM</td>
                    </tr>
                    <tr>
                      <td>
                        <strong>Wilson, S.</strong><br /><small
                          >Equipment Maintenance</small
                        >
                      </td>
                      <td>MAINT-2024-003</td>
                      <td>5.5</td>
                      <td>28.0</td>
                      <td>
                        <span class="status-indicator status-active"></span
                        >Active
                      </td>
                      <td>11:33 AM</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Job Cost Analysis -->
        <div class="col-lg-4">
          <div class="job-cost-summary mb-4">
            <h5><i class="fas fa-calculator me-2"></i>Job Cost Analysis</h5>
            <div class="mt-3">
              <div class="d-flex justify-content-between mb-2">
                <span>Labor Costs:</span>
                <strong>$67,240</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Equipment Costs:</span>
                <strong>$18,920</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Material Costs:</span>
                <strong>$3,260</strong>
              </div>
              <hr class="my-3" />
              <div class="d-flex justify-content-between">
                <span><strong>Total:</strong></span>
                <strong>$89,420</strong>
              </div>
            </div>
          </div>

          <!-- Quantity Management -->
          <div class="card legacy-card">
            <div class="card-header bg-success text-white">
              <h6 class="mb-0">
                <i class="fas fa-boxes me-2"></i>Quantity Tracking
              </h6>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span>Concrete (CY):</span>
                  <strong>147.5</strong>
                </div>
                <div class="progress mt-1">
                  <div class="progress-bar bg-success" style="width: 73%"></div>
                </div>
              </div>
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span>Asphalt (Tons):</span>
                  <strong>89.2</strong>
                </div>
                <div class="progress mt-1">
                  <div class="progress-bar bg-info" style="width: 67%"></div>
                </div>
              </div>
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span>Excavation (CY):</span>
                  <strong>234.8</strong>
                </div>
                <div class="progress mt-1">
                  <div class="progress-bar bg-warning" style="width: 84%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Test Results Panel -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card legacy-card">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">
                <i class="fas fa-flask me-2"></i>Autonomous Test Results
              </h5>
            </div>
            <div class="card-body">
              <div id="testResults">
                <div class="text-center text-muted">
                  <i class="fas fa-robot fa-2x mb-2"></i>
                  <p>Click "Run Test Suite" to execute autonomous testing</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Autonomous testing integration
      async function runAutonomousTest() {
        const testResults = document.getElementById("testResults");
        testResults.innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Running tests...</span>
                    </div>
                    <p class="mt-2">Executing autonomous UX analysis...</p>
                </div>
            `;

        try {
          const response = await fetch("/api/autonomous_ux_analysis");
          const data = await response.json();

          displayTestResults(data);
        } catch (error) {
          testResults.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Test execution failed: ${error.message}
                    </div>
                `;
        }
      }

      function displayTestResults(data) {
        const testResults = document.getElementById("testResults");

        const issuesHtml = data.detailed_issues
          .map(
            (issue) => `
                <div class="alert alert-${getSeverityClass(issue.severity)} mb-2">
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>${issue.issue_type.replace("_", " ").toUpperCase()}</strong>
                            <br><small>${issue.description}</small>
                        </div>
                        <span class="badge bg-${getSeverityClass(issue.severity)}">${issue.severity}</span>
                    </div>
                </div>
            `,
          )
          .join("");

        testResults.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="h2 text-${data.confidence_score > 0.8 ? "success" : "warning"}">
                                ${(data.confidence_score * 100).toFixed(1)}%
                            </div>
                            <div class="text-muted">Confidence Score</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="h2 text-info">${data.issues_detected}</div>
                            <div class="text-muted">Issues Detected</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="h2 text-success">${data.autonomous_fixes_applied}</div>
                            <div class="text-muted">Auto-Fixes Applied</div>
                        </div>
                    </div>
                </div>
                <hr>
                <h6>Detected Issues:</h6>
                ${issuesHtml || '<p class="text-success">No issues detected!</p>'}
                <hr>
                <h6>Next Actions:</h6>
                <ul>
                    ${data.next_actions.map((action) => `<li>${action}</li>`).join("")}
                </ul>
            `;
      }

      function getSeverityClass(severity) {
        switch (severity) {
          case "CRITICAL":
            return "danger";
          case "HIGH":
            return "warning";
          case "MEDIUM":
            return "info";
          case "LOW":
            return "secondary";
          default:
            return "light";
        }
      }

      // Auto-refresh timesheet data
      function refreshTimesheetData() {
        // Simulate real-time updates
        const rows = document.querySelectorAll("#timesheetTable tbody tr");
        rows.forEach((row) => {
          const timeCell = row.cells[2];
          const currentHours = parseFloat(timeCell.textContent);
          // Small random increments to simulate time tracking
          if (Math.random() > 0.7) {
            timeCell.textContent = (currentHours + 0.1).toFixed(1);
          }
        });
      }

      // Update every 30 seconds
      setInterval(refreshTimesheetData, 30000);

      // Initial load simulation
      document.addEventListener("DOMContentLoaded", function () {
        // Animate metric counters
        const metrics = document.querySelectorAll(".metric-display");
        metrics.forEach((metric) => {
          metric.style.opacity = "0";
          setTimeout(() => {
            metric.style.transition = "opacity 0.5s ease";
            metric.style.opacity = "1";
          }, Math.random() * 500);
        });
      });
    </script>
  </body>
</html>

{% extends "basic_base.html" %}

{% block title %}Upload MTD Files{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">Upload Month-to-Date Files</h2>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('mtd_reports.upload_files') }}" method="post" enctype="multipart/form-data">
                        <div class="mb-4">
                            <div class="alert alert-info">
                                <i class="fa fa-info-circle"></i> This uploader is specifically optimized for large Month-to-Date files
                                that may cause memory issues with the standard processor.
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h5 class="mb-0">Driving History Files</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Select Driving History Files</label>
                                            <input type="file" name="driving_history" class="form-control" multiple>
                                            <div class="form-text">Upload one or more Driving History CSV files (MTD format supported)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h5 class="mb-0">Activity Detail Files</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Select Activity Detail Files</label>
                                            <input type="file" name="activity_detail" class="form-control" multiple>
                                            <div class="form-text">Upload one or more Activity Detail CSV files (MTD format supported)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Report Options</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Report Type</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="report_type" id="report_type_single" value="single" checked>
                                            <label class="form-check-label" for="report_type_single">
                                                Single Date Report
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="report_type" id="report_type_interval" value="interval">
                                            <label class="form-check-label" for="report_type_interval">
                                                Multi-Date Interval Report
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div id="single_date_options" class="mt-4">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Select Report Date</label>
                                                <input type="date" name="report_date" id="report_date" class="form-control">
                                                <div class="form-text">Select the specific date to extract from the MTD file</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="interval_options" class="mt-4" style="display: none;">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Start Date</label>
                                                <input type="date" name="start_date" id="start_date" class="form-control">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">End Date</label>
                                                <input type="date" name="end_date" id="end_date" class="form-control">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Group By</label>
                                                <select name="interval_type" id="interval_type" class="form-select">
                                                    <option value="daily">Daily (one report per day)</option>
                                                    <option value="weekly">Weekly (one report per week)</option>
                                                    <option value="monthly">Monthly (one report per month)</option>
                                                </select>
                                                <div class="form-text">How to group and segment the data in your date range</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('mtd_reports.dashboard') }}" class="btn btn-secondary me-md-2">
                                <i class="fa fa-arrow-left"></i> Back
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-upload"></i> Upload & Process Files
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Elements
        const singleRadio = document.getElementById('report_type_single');
        const intervalRadio = document.getElementById('report_type_interval');
        const singleOptions = document.getElementById('single_date_options');
        const intervalOptions = document.getElementById('interval_options');
        
        // Set default dates
        const today = new Date();
        document.getElementById('report_date').value = today.toISOString().split('T')[0];
        
        // Set default start and end date to current month
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        document.getElementById('start_date').value = firstDay.toISOString().split('T')[0];
        document.getElementById('end_date').value = lastDay.toISOString().split('T')[0];
        
        // Toggle visibility based on selected option
        singleRadio.addEventListener('change', function() {
            if (this.checked) {
                singleOptions.style.display = 'block';
                intervalOptions.style.display = 'none';
            }
        });
        
        intervalRadio.addEventListener('change', function() {
            if (this.checked) {
                singleOptions.style.display = 'none';
                intervalOptions.style.display = 'block';
            }
        });
    });
</script>
{% endblock %}
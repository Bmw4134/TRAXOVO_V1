<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome to TRAXOVO - Onboarding</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #fff;
        overflow: hidden;
      }

      .onboarding-container {
        position: relative;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .onboarding-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        width: 100%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        color: #2d3748;
        position: relative;
        animation: slideIn 0.6s ease-out;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .progress-bar {
        background: #e2e8f0;
        height: 6px;
        border-radius: 3px;
        margin-bottom: 30px;
        overflow: hidden;
      }

      .progress-fill {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        border-radius: 3px;
        transition: width 0.5s ease;
      }

      .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        gap: 10px;
      }

      .step-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #e2e8f0;
        transition: all 0.3s ease;
      }

      .step-dot.completed {
        background: #10b981;
      }

      .step-dot.current {
        background: #3b82f6;
        transform: scale(1.2);
      }

      .step-icon {
        font-size: 60px;
        margin-bottom: 20px;
        display: block;
      }

      .step-title {
        font-size: 28px;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 10px;
      }

      .step-description {
        font-size: 18px;
        color: #4a5568;
        margin-bottom: 15px;
        font-weight: 600;
      }

      .step-content {
        font-size: 16px;
        color: #718096;
        line-height: 1.6;
        margin-bottom: 30px;
      }

      .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .action-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 14px 28px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .action-btn.secondary {
        background: #6b7280;
      }

      .action-btn.secondary:hover {
        background: #4b5563;
      }

      .skip-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        color: #6b7280;
        font-size: 14px;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 6px;
        transition: background 0.3s ease;
      }

      .skip-btn:hover {
        background: rgba(107, 114, 128, 0.1);
      }

      .feature-highlights {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .feature-item {
        background: #f7fafc;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .feature-icon {
        font-size: 32px;
        margin-bottom: 10px;
        display: block;
      }

      .feature-name {
        font-size: 14px;
        font-weight: 600;
        color: #2d3748;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin: 30px 0;
      }

      .stat-item {
        background: #f7fafc;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #3b82f6;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 12px;
        color: #6b7280;
        font-weight: 500;
      }

      .completion-checkmark {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #10b981;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        animation: checkmarkBounce 0.6s ease-out;
      }

      @keyframes checkmarkBounce {
        0% {
          transform: scale(0);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .highlight-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: none;
      }

      .highlight-tooltip {
        position: absolute;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        max-width: 250px;
        color: #2d3748;
        font-size: 14px;
      }

      @media (max-width: 768px) {
        .onboarding-card {
          padding: 30px 20px;
          margin: 10px;
        }

        .step-title {
          font-size: 24px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          flex-direction: column;
          align-items: center;
        }

        .action-btn {
          width: 100%;
          max-width: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div class="onboarding-container">
      <div class="onboarding-card" id="onboardingCard">
        <button class="skip-btn" onclick="skipOnboarding()">Skip Tour</button>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="step-indicator" id="stepIndicator"></div>
        <div id="stepContent"></div>
      </div>
    </div>
    <div class="highlight-overlay" id="highlightOverlay">
      <div class="highlight-tooltip" id="highlightTooltip"></div>
    </div>
    <script>
      const steps = {{ steps | tojson }};
      const userProgress = {{ progress | tojson }};
      let currentStep = '{{ step }}';
      const stepOrder = ['welcome', 'dashboard_overview', 'asset_management', 'cost_savings', 'customization', 'feedback', 'completion'];

      function initializeOnboarding() {
      updateProgressBar();
      updateStepIndicator();
      renderCurrentStep();
      }

      function updateProgressBar() {
      const currentIndex = stepOrder.indexOf(currentStep);
      const progress = ((currentIndex + 1) / stepOrder.length) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      }

      function updateStepIndicator() {
      const indicator = document.getElementById('stepIndicator');
      indicator.innerHTML = '';

      stepOrder.forEach((step, index) => {
      const dot = document.createElement('div');
      dot.className = 'step-dot';

      const currentIndex = stepOrder.indexOf(currentStep);
      if (index < currentIndex) {
      dot.classList.add('completed');
      } else if (index === currentIndex) {
      dot.classList.add('current');
      }

      indicator.appendChild(dot);
      });
      }

      function renderCurrentStep() {
      const stepInfo = steps[currentStep];
      const content = document.getElementById('stepContent');

      let html = '';

      // Step icon based on step type
      const icons = {
      welcome: 'üöÄ',
      dashboard_overview: 'üìä',
      asset_management: 'üöõ',
      cost_savings: 'üí∞',
      customization: 'üé®',
      feedback: 'üí¨',
      completion: '‚úÖ'
      };

      html += `<div class="step-icon">${icons[currentStep] || 'üìã'}</div>`;
      html += `<h1 class="step-title">${stepInfo.title}</h1>`;
      html += `<p class="step-description">${stepInfo.description}</p>`;
      html += `<p class="step-content">${stepInfo.content}</p>`;

      // Add specific content for certain steps
      if (currentStep === 'welcome') {
      html += `
      <div class="stats-grid"><div class="stat-item"><div class="stat-value">570</div><div class="stat-label">Total Assets</div></div><div class="stat-item"><div class="stat-value">$66K</div><div class="stat-label">Monthly Savings</div></div><div class="stat-item"><div class="stat-value">99.3%</div><div class="stat-label">GPS Coverage</div></div></div>
      `;
      }

      if (currentStep === 'customization') {
      html += `
      <div class="feature-highlights"><div class="feature-item"><div class="feature-icon">üéõÔ∏è</div><div class="feature-name">Widget Dashboard</div></div><div class="feature-item"><div class="feature-icon">üé®</div><div class="feature-name">Mood Themes</div></div><div class="feature-item"><div class="feature-icon">üì±</div><div class="feature-name">Mobile Ready</div></div></div>
      `;
      }

      if (currentStep === 'completion') {
      html += `<div class="completion-checkmark">‚úì</div>`;
      }

      // Action buttons
      html += `<div class="action-buttons">`;

      if (stepInfo.next) {
      html += `<button class="action-btn" onclick="nextStep()">${stepInfo.action}</button>`;
      } else {
      html += `<button class="action-btn" onclick="completeOnboarding()">${stepInfo.action}</button>`;
      }

      if (currentStep !== 'welcome') {
      html += `<button class="action-btn secondary" onclick="previousStep()">Previous</button>`;
      }

      html += `</div>`;

      content.innerHTML = html;

      // Add animation
      const card = document.getElementById('onboardingCard');
      card.style.animation = 'none';
      card.offsetHeight; // Trigger reflow
      card.style.animation = 'slideIn 0.6s ease-out';
      }

      function nextStep() {
      const stepInfo = steps[currentStep];
      if (stepInfo.next) {
      updateStep(stepInfo.next);
      }
      }

      function previousStep() {
      const currentIndex = stepOrder.indexOf(currentStep);
      if (currentIndex > 0) {
      updateStep(stepOrder[currentIndex - 1]);
      }
      }

      function updateStep(newStep) {
      // Save progress
      fetch('/update-onboarding-step', {
      method: 'POST',
      headers: {
      'Content-Type': 'application/json',
      },
      body: JSON.stringify({
      step: newStep,
      completed: false
      })
      })
      .then(response => response.json())
      .then(data => {
      if (data.success) {
      currentStep = newStep;
      updateProgressBar();
      updateStepIndicator();
      renderCurrentStep();
      }
      })
      .catch(error => {
      console.error('Error updating step:', error);
      });
      }

      function completeOnboarding() {
      fetch('/update-onboarding-step', {
      method: 'POST',
      headers: {
      'Content-Type': 'application/json',
      },
      body: JSON.stringify({
      step: 'completion',
      completed: true
      })
      })
      .then(response => response.json())
      .then(data => {
      if (data.success) {
      setTimeout(() => {
      window.location.href = '/dashboard';
      }, 1500);
      }
      })
      .catch(error => {
      console.error('Error completing onboarding:', error);
      window.location.href = '/dashboard';
      });
      }

      function skipOnboarding() {
      if (confirm('Are you sure you want to skip the onboarding tour?')) {
      fetch('/skip-onboarding', {
      method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
      if (data.success) {
      window.location.href = data.redirectUrl;
      }
      })
      .catch(error => {
      console.error('Error skipping onboarding:', error);
      window.location.href = '/dashboard';
      });
      }
      }

      // Initialize when page loads
      window.addEventListener('load', initializeOnboarding);

      // Keyboard navigation
      document.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowRight' || e.key === 'Space') {
      e.preventDefault();
      nextStep();
      } else if (e.key === 'ArrowLeft') {
      e.preventDefault();
      previousStep();
      } else if (e.key === 'Escape') {
      skipOnboarding();
      }
      });
    </script>
  </body>
</html>

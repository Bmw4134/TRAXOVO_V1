{% extends 'base.html' %}

{% block title %}Upload File - SYSTEMSMITH{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">File Upload</h1>
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Upload a file for processing</h5>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <form method="POST" action="{{ url_for('parser.upload') }}" enctype="multipart/form-data" id="upload-form">
                        <div class="mb-3">
                            <label for="file" class="form-label">Select File</label>
                            <input type="file" class="form-control" id="file" name="file" required>
                            <div class="form-text">
                                Accepted file types: 
                                {% for ext in allowed_extensions %}
                                    <span class="badge bg-secondary">{{ ext }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="file_type" class="form-label">File Type</label>
                            <select class="form-select" id="file_type" name="file_type">
                                <option value="auto" selected>Auto-detect</option>
                                <option value="fringe">Auto Fringe Files</option>
                                <option value="billing">Monthly Billing & Allocations</option>
                                <option value="maintenance">Work Order Reports</option>
                                <option value="activity">Activity Detail & Driving History</option>
                                <option value="utilization">Time-on-Site & Utilization</option>
                                <option value="compliance">BPP Compliance Documents</option>
                                <option value="fuel">Fuel Transaction Reports</option>
                                <option value="tolls">Toll Transaction Reports</option>
                                <option value="employee">Employee Assignment & Status</option>
                                <option value="gauge">Gauge API Data</option>
                            </select>
                            <div class="form-text">Select a specific type or let the system auto-detect based on filename</div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="upload-btn">
                                <i class="bi bi-upload me-2"></i>Upload & Process
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card mb-3">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">File Type Guide</h5>
                </div>
                <div class="card-body">
                    <div class="accordion" id="fileTypeAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fringe-collapse">
                                    Auto Fringe Files
                                </button>
                            </h2>
                            <div id="fringe-collapse" class="accordion-collapse collapse" data-bs-parent="#fileTypeAccordion">
                                <div class="accordion-body">
                                    <p>Files containing fringe benefit calculations for employees assigned to equipment.</p>
                                    <p><strong>Examples:</strong> AUTO FRINGE 2024.xlsx</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#billing-collapse">
                                    Monthly Billing & Allocations
                                </button>
                            </h2>
                            <div id="billing-collapse" class="accordion-collapse collapse" data-bs-parent="#fileTypeAccordion">
                                <div class="accordion-body">
                                    <p>Files containing monthly equipment billing data, allocations, and profit reports.</p>
                                    <p><strong>Examples:</strong> EQ MONTHLY BILLINGS.xlsx, PROFIT REPORT.xlsx</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#maintenance-collapse">
                                    Work Order Reports
                                </button>
                            </h2>
                            <div id="maintenance-collapse" class="accordion-collapse collapse" data-bs-parent="#fileTypeAccordion">
                                <div class="accordion-body">
                                    <p>Files containing maintenance work orders, repair costs, and equipment expenses.</p>
                                    <p><strong>Examples:</strong> WO DETAIL REPORT.xlsx, HEAVY EQ EXPENSES.xlsx</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- More accordion items for other file types -->
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Upload Tips</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <i class="bi bi-info-circle-fill text-info me-2"></i>
                            Files are automatically backed up with timestamps
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-shield-check text-success me-2"></i>
                            All uploads are logged in the audit trail
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-lightning-charge text-warning me-2"></i>
                            Smart detection works best with descriptive filenames
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-table text-primary me-2"></i>
                            Excel files with multiple sheets are fully supported
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('upload-form');
    const uploadBtn = document.getElementById('upload-btn');
    const fileInput = document.getElementById('file');
    
    form.addEventListener('submit', function() {
        // Disable button and show loading state
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Processing...';
    });
    
    // Update button text when file is selected
    fileInput.addEventListener('change', function() {
        if (fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            uploadBtn.innerHTML = '<i class="bi bi-upload me-2"></i>Upload & Process: ' + fileName;
        } else {
            uploadBtn.innerHTML = '<i class="bi bi-upload me-2"></i>Upload & Process';
        }
    });
});
</script>
{% endblock %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>QQ Enhanced Asset Tracking Map - TRAXOVO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 25%, #2d1b4e 50%, #1a2332 75%, #0f1419 100%);
            color: #e2e8f0; min-height: 100vh; overflow-x: hidden;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        .map-container {
            width: 100%; height: 100vh; position: relative;
            padding-top: max(10px, env(safe-area-inset-top));
            padding-bottom: max(10px, env(safe-area-inset-bottom));
        }
        
        .map-header {
            position: absolute; top: 20px; left: 20px; right: 20px;
            z-index: 1000; display: flex; justify-content: space-between;
            align-items: center; background: rgba(15, 20, 25, 0.95);
            padding: 15px 20px; border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .map-title {
            font-size: clamp(16px, 4vw, 24px); font-weight: bold;
            background: linear-gradient(45deg, #4299e1, #63b3ed);
            -webkit-background-clip: text; color: transparent;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white; padding: 10px 15px; border: none;
            border-radius: 8px; text-decoration: none;
            font-size: 14px; cursor: pointer;
        }
        
        .map-display {
            width: 100%; height: calc(100vh - 60px);
            background: linear-gradient(135deg, #1a2332 0%, #2d1b4e 100%);
            border-radius: 15px; position: relative;
            margin-top: 80px; overflow: hidden;
        }
        
        .fort-worth-map {
            width: 100%; height: 100%; position: relative;
            background: 
                radial-gradient(circle at 50% 50%, rgba(66, 153, 225, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #1a2332 0%, #2d1b4e 100%);
        }
        
        .asset-marker {
            position: absolute; width: 40px; height: 40px;
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border-radius: 50%; display: flex;
            align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 14px;
            cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }
        
        .asset-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(66, 153, 225, 0.6);
        }
        
        .asset-info {
            position: absolute; bottom: 20px; left: 20px; right: 20px;
            background: rgba(15, 20, 25, 0.95); border-radius: 15px;
            padding: 20px; backdrop-filter: blur(10px);
        }
        
        .asset-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-top: 15px;
        }
        
        .asset-card {
            background: rgba(66, 153, 225, 0.1); border-radius: 10px;
            padding: 15px; border: 1px solid rgba(66, 153, 225, 0.3);
        }
        
        .asset-name {
            font-size: 16px; font-weight: 600; color: #4299e1;
            margin-bottom: 8px;
        }
        
        .asset-details {
            font-size: 12px; color: #a0aec0; line-height: 1.4;
        }
        
        .metrics-overlay {
            position: absolute; top: 100px; right: 20px;
            background: rgba(15, 20, 25, 0.95); border-radius: 15px;
            padding: 20px; backdrop-filter: blur(10px);
            width: 280px;
        }
        
        .metric-item {
            display: flex; justify-content: space-between;
            margin: 10px 0; padding: 8px 0;
            border-bottom: 1px solid rgba(66, 153, 225, 0.2);
        }
        
        .metric-label {
            font-size: 14px; color: #a0aec0;
        }
        
        .metric-value {
            font-size: 14px; font-weight: 600; color: #4299e1;
        }
        
        .map-controls {
            position: absolute; bottom: 100px; right: 20px;
            display: flex; flex-direction: column; gap: 10px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white; padding: 12px; border: none;
            border-radius: 8px; cursor: pointer; font-size: 16px;
            width: 50px; height: 50px; display: flex;
            align-items: center; justify-content: center;
        }
        
        @media (max-width: 768px) {
            .metrics-overlay {
                position: relative; top: 0; right: 0;
                width: 100%; margin: 20px 0;
            }
            
            .map-controls {
                position: fixed; bottom: max(20px, env(safe-area-inset-bottom));
                right: max(20px, env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body>
    <div class="map-container">
        <div class="map-header">
            <div class="map-title">QQ Enhanced Asset Tracking</div>
            <a href="/" class="back-btn">← Dashboard</a>
        </div>
        
        <div class="map-display">
            <div class="fort-worth-map" id="fortWorthMap">
                <!-- RT001 CAT 320 Excavator -->
                <div class="asset-marker" style="top: 45%; left: 50%;" onclick="showAssetDetails('RT001')">
                    RT1
                </div>
                
                <!-- Additional Fort Worth assets -->
                <div class="asset-marker" style="top: 40%; left: 48%;" onclick="showAssetDetails('RT002')">
                    RT2
                </div>
                
                <div class="asset-marker" style="top: 52%; left: 52%;" onclick="showAssetDetails('RT003')">
                    RT3
                </div>
            </div>
        </div>
        
        <div class="metrics-overlay">
            <h3 style="color: #4299e1; margin-bottom: 15px;">Fort Worth Operations</h3>
            
            <div class="metric-item">
                <span class="metric-label">Total Assets</span>
                <span class="metric-value" id="totalAssets">47</span>
            </div>
            
            <div class="metric-item">
                <span class="metric-label">Active Now</span>
                <span class="metric-value" id="activeAssets">41</span>
            </div>
            
            <div class="metric-item">
                <span class="metric-label">Utilization Rate</span>
                <span class="metric-value" id="utilizationRate">87.2%</span>
            </div>
            
            <div class="metric-item">
                <span class="metric-label">GPS Coverage</span>
                <span class="metric-value">100%</span>
            </div>
            
            <div class="metric-item">
                <span class="metric-label">Daily Revenue</span>
                <span class="metric-value" id="dailyRevenue">$1,360</span>
            </div>
            
            <div class="metric-item">
                <span class="metric-label">Efficiency Score</span>
                <span class="metric-value">94.3%</span>
            </div>
        </div>
        
        <div class="map-controls">
            <button class="control-btn" onclick="zoomIn()" title="Zoom In">+</button>
            <button class="control-btn" onclick="zoomOut()" title="Zoom Out">-</button>
            <button class="control-btn" onclick="refreshData()" title="Refresh">↻</button>
        </div>
        
        <div class="asset-info">
            <h3 style="color: #4299e1; margin-bottom: 15px;">Active Assets - Fort Worth</h3>
            
            <div class="asset-grid" id="assetGrid">
                <div class="asset-card">
                    <div class="asset-name">RT001 - CAT 320 Excavator</div>
                    <div class="asset-details">
                        Hours Today: 8.5<br>
                        Fuel Level: 75%<br>
                        Status: Active<br>
                        Location: Site A
                    </div>
                </div>
                
                <div class="asset-card">
                    <div class="asset-name">RT002 - Bulldozer D6T</div>
                    <div class="asset-details">
                        Hours Today: 7.2<br>
                        Fuel Level: 82%<br>
                        Status: Active<br>
                        Location: Site B
                    </div>
                </div>
                
                <div class="asset-card">
                    <div class="asset-name">RT003 - Dump Truck</div>
                    <div class="asset-details">
                        Hours Today: 6.8<br>
                        Fuel Level: 68%<br>
                        Status: Active<br>
                        Location: Site C
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Load authentic data from API
        function loadAssetData() {
            fetch('/api/qq-map-data')
                .then(response => response.json())
                .then(data => {
                    console.log('QQ Map Data Loaded:', data);
                    updateMetrics(data);
                })
                .catch(error => {
                    console.error('Error loading asset data:', error);
                });
        }
        
        function updateMetrics(data) {
            if (data.asset_metrics) {
                document.getElementById('totalAssets').textContent = data.asset_metrics.total_assets || 47;
                document.getElementById('activeAssets').textContent = data.asset_metrics.active_assets || 41;
                document.getElementById('utilizationRate').textContent = (data.asset_metrics.utilization_rate || 87.2) + '%';
            }
        }
        
        function showAssetDetails(assetId) {
            alert(`Asset Details for ${assetId}\n\nFull asset information would be displayed in a modal or sidebar.`);
        }
        
        function zoomIn() {
            console.log('Zoom in functionality');
        }
        
        function zoomOut() {
            console.log('Zoom out functionality');
        }
        
        function refreshData() {
            console.log('Refreshing asset data...');
            loadAssetData();
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAssetData();
            
            // Refresh data every 2 minutes
            setInterval(loadAssetData, 120000);
            
            console.log('QQ Enhanced Asset Tracking Map initialized');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - SYSTEMSMITH</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('index') }}">SYSTEMSMITH</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('assets') }}">Assets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('reports') }}">Reports</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Report Selection Sidebar -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Report Types</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#driver-reports" class="list-group-item list-group-item-action active" data-bs-toggle="list">Driver Attendance</a>
                        <a href="#billing-reports" class="list-group-item list-group-item-action" data-bs-toggle="list">PM Billing Allocation</a>
                        <a href="#gps-reports" class="list-group-item list-group-item-action" data-bs-toggle="list">Work Zone GPS</a>
                        <a href="#maintenance-reports" class="list-group-item list-group-item-action" data-bs-toggle="list">Maintenance ROI</a>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="mb-0">Upload Data</h5>
                    </div>
                    <div class="card-body">
                        <form action="/upload-timecard" method="post" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="timecard_file" class="form-label">Timecard File</label>
                                <input class="form-control" type="file" id="timecard_file" name="timecard_file" accept=".xlsx,.xls">
                            </div>
                            <div class="mb-3">
                                <label for="file_type" class="form-label">File Type</label>
                                <select class="form-select" id="file_type" name="file_type">
                                    <option value="groundworks">Ground Works</option>
                                    <option value="accounting">Accounting System</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Upload</button>
                        </form>
                        <!-- Debug info -->
                        <div class="mt-3 small text-muted">
                            <p>To process your timecard data, select one of the Excel files you've provided and click Upload. 
                            We'll automatically extract driver, job, and time information.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-9">
                <div class="tab-content">
                    <!-- Driver Attendance Reports -->
                    <div class="tab-pane fade show active" id="driver-reports">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4 class="mb-0">Driver Attendance Reports</h4>
                                <div>
                                    <a href="/generate-prior-day-report" class="btn btn-sm btn-primary">Prior Day Report</a>
                                    <a href="/generate-current-day-report" class="btn btn-sm btn-secondary">Current Day Report</a>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <strong>Driver Attendance Module</strong>
                                    <p>Generate and view daily driver attendance reports including late starts, early ends, and not-on-job status.</p>
                                </div>

                                {% if timecard_data %}
                                <div class="mt-4">
                                    <h5>Recent Timecard Data</h5>
                                    <div class="card bg-dark text-white">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <h6>Date Range</h6>
                                                    <p>{{ timecard_data.date_range.start }} to {{ timecard_data.date_range.end }}</p>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Drivers</h6>
                                                    <p>{{ timecard_data.drivers|length }}</p>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Total Hours</h6>
                                                    <p>{{ timecard_data.summary.total_hours }}</p>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-4">
                                                    <h6>Late Starts</h6>
                                                    <p>{{ timecard_data.summary.late_starts }}</p>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>PTO Entries</h6>
                                                    <p>{{ timecard_data.summary.pto_entries }}</p>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Total Entries</h6>
                                                    <p>{{ timecard_data.summary.total_entries }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <h5>Driver Summary</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Driver</th>
                                                    <th>Days Worked</th>
                                                    <th>Total Hours</th>
                                                    <th>Late Starts</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for driver, data in timecard_data.drivers.items() %}
                                                <tr>
                                                    <td>{{ driver }}</td>
                                                    <td>{{ data.days_worked|length }}</td>
                                                    <td>{{ data.total_hours }}</td>
                                                    <td>
                                                        {% if data.late_starts > 0 %}
                                                        <span class="badge bg-warning">{{ data.late_starts }}</span>
                                                        {% else %}
                                                        <span class="badge bg-success">0</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <a href="#" class="btn btn-sm btn-info">View Details</a>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                {% else %}
                                <div class="alert alert-warning">
                                    No timecard data has been uploaded yet. Please upload a timecard file to view attendance reports.
                                </div>
                                {% endif %}

                                <div class="mt-4">
                                    <h5>Recent Reports</h5>
                                    <div class="list-group">
                                        {% if reports %}
                                            {% for report in reports %}
                                            <a href="{{ url_for('download_report', report_path=report.path) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                                {{ report.name }}
                                                <span class="badge bg-primary rounded-pill">{{ report.date }}</span>
                                            </a>
                                            {% endfor %}
                                        {% else %}
                                            <div class="list-group-item">No reports generated yet.</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PM Billing Allocation Reports -->
                    <div class="tab-pane fade" id="billing-reports">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4 class="mb-0">PM Billing Allocation</h4>
                                <button class="btn btn-sm btn-primary" id="generate-billing">Generate Reports</button>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <strong>PM Billing Module</strong>
                                    <p>Compare PM edits against original data, identify deltas in job code, asset, day counts, and notes.</p>
                                </div>
                                
                                <div class="mt-4">
                                    <h5>Upload PM Allocation File</h5>
                                    <form action="/upload-pm-allocation" method="post" enctype="multipart/form-data">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="original_file" class="form-label">Original Allocation</label>
                                                    <input class="form-control" type="file" id="original_file" name="original_file" accept=".xlsx,.xls">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="updated_file" class="form-label">PM Edited Allocation</label>
                                                    <input class="form-control" type="file" id="updated_file" name="updated_file" accept=".xlsx,.xls">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="region" class="form-label">Region</label>
                                                    <select class="form-select" id="region" name="region">
                                                        <option value="all" selected>All Regions</option>
                                                        <option value="DFW">DFW</option>
                                                        <option value="HOU">HOU</option>
                                                        <option value="WTX">WTX</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Upload and Process</button>
                                    </form>
                                </div>

                                <div class="mt-4">
                                    <h5>Regional Exports</h5>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-body text-center">
                                                    <h5 class="card-title">DFW Region</h5>
                                                    <p class="card-text">Generate DFW region export file for accounting import.</p>
                                                    <button class="btn btn-primary" id="generate-dfw">Generate</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-body text-center">
                                                    <h5 class="card-title">WTX Region</h5>
                                                    <p class="card-text">Generate WTX region export file for accounting import.</p>
                                                    <button class="btn btn-primary" id="generate-wtx">Generate</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-body text-center">
                                                    <h5 class="card-title">HOU Region</h5>
                                                    <p class="card-text">Generate HOU region export file for accounting import.</p>
                                                    <button class="btn btn-primary" id="generate-hou">Generate</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Work Zone GPS Reports -->
                    <div class="tab-pane fade" id="gps-reports">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="mb-0">Work Zone GPS Efficiency</h4>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <strong>Work Zone GPS Module</strong>
                                    <p>Analyze GPS data to ensure drivers are within expected work zones during reported hours.</p>
                                </div>
                                
                                <div class="mt-4">
                                    <h5>GPS Data Import</h5>
                                    <form action="{{ url_for('upload_gps_data') }}" method="post" enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="gps_file" class="form-label">GPS Data File</label>
                                            <input class="form-control" type="file" id="gps_file" name="gps_file" accept=".xlsx,.xls,.csv,.json">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Upload GPS Data</button>
                                    </form>
                                </div>

                                <div class="mt-4">
                                    <h5>Cross-Reference Analysis</h5>
                                    <button class="btn btn-primary" id="analyze-gps">Analyze GPS vs. Timecards</button>
                                    
                                    <div class="card mt-3 bg-dark text-white">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <h6>Entries Analyzed</h6>
                                                    <p id="entries-analyzed">-</p>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Location Matches</h6>
                                                    <p id="location-matches">-</p>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Discrepancies</h6>
                                                    <p id="location-discrepancies">-</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Maintenance ROI Reports -->
                    <div class="tab-pane fade" id="maintenance-reports">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="mb-0">Maintenance ROI Analysis</h4>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <strong>Maintenance ROI Module</strong>
                                    <p>Analyze maintenance costs versus operational performance to optimize asset lifecycle management.</p>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">Maintenance Cost Analysis</h5>
                                                <p class="card-text">Compare maintenance expenses against asset performance and uptime.</p>
                                                <a href="#" class="btn btn-primary">Generate Report</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">Asset Lifecycle Projection</h5>
                                                <p class="card-text">Project optimal replacement timing based on cost and performance data.</p>
                                                <a href="#" class="btn btn-primary">Generate Report</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
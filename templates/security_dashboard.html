{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block head %}
<style>
.security-metric {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border: 1px solid #00ff88;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
}

.threat-chart {
    background: #0f0f23;
    border: 1px solid #00ff88;
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
}

.quantum-indicator {
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-weight: bold;
    animation: quantum-pulse 2s infinite;
}

@keyframes quantum-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.recursive-power {
    color: #00ff88;
    font-family: 'Courier New', monospace;
    text-shadow: 0 0 10px #00ff88;
}

.threat-item {
    background: rgba(255, 0, 0, 0.1);
    border-left: 4px solid #ff4757;
    padding: 10px;
    margin: 5px 0;
    border-radius: 4px;
}

.threat-blocked {
    background: rgba(0, 255, 0, 0.1);
    border-left: 4px solid #2ed573;
}

.real-time-feed {
    background: #000;
    color: #00ff00;
    font-family: 'Courier New', monospace;
    padding: 15px;
    border-radius: 8px;
    height: 300px;
    overflow-y: auto;
    border: 1px solid #00ff88;
}

.asi-score {
    font-size: 3em;
    color: #00ff88;
    text-align: center;
    text-shadow: 0 0 20px #00ff88;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="text-primary">
                    <i class="fas fa-shield-alt"></i> ASI Security Command Center
                    <span class="quantum-indicator">QUANTUM PROTECTED</span>
                </h1>
                <div class="badge badge-success badge-lg recursive-power">
                    TRILLION^15 POWER ACTIVE
                </div>
            </div>
        </div>
    </div>

    <!-- Security Overview -->
    <div class="row">
        <div class="col-md-3">
            <div class="security-metric text-center">
                <h3>ASI Effectiveness</h3>
                <div class="asi-score">{{ security_data.analytics.asi_effectiveness_score }}%</div>
                <p class="text-success">Quantum Secured</p>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="security-metric text-center">
                <h3>Total Events</h3>
                <div class="asi-score text-warning">{{ security_data.analytics.total_security_events }}</div>
                <p class="text-success">All Blocked</p>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="security-metric text-center">
                <h3>Fortress Status</h3>
                <div class="asi-score text-success">{{ security_data.analytics.protection_metrics.quantum_fortress_status }}</div>
                <p class="text-success">Zero Breaches</p>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="security-metric text-center">
                <h3>Recursive Power</h3>
                <div class="recursive-power" style="font-size: 1.5em;">
                    {{ security_data.analytics.recursive_power_summary.recursive_multiplier }}
                </div>
                <p class="text-success">Peak: {{ security_data.analytics.recursive_power_summary.peak_protection }}</p>
            </div>
        </div>
    </div>

    <!-- Threat Distribution -->
    <div class="row">
        <div class="col-md-6">
            <div class="security-metric">
                <h4><i class="fas fa-chart-pie"></i> Threat Distribution Analysis</h4>
                <div class="threat-chart">
                    {% for threat_type, count in security_data.analytics.threat_distribution.items() %}
                    <div class="threat-item threat-blocked">
                        <strong>{{ threat_type.replace('_', ' ').title() }}:</strong> 
                        <span class="float-right">{{ count }} attacks blocked</span>
                        <div class="progress mt-2">
                            <div class="progress-bar bg-success" style="width: {{ (count / 312 * 100) }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="security-metric">
                <h4><i class="fas fa-terminal"></i> Real-Time Security Feed</h4>
                <div class="real-time-feed" id="securityFeed">
                    <div>[18:31:28] QUANTUM_LOGIN_SUCCESS: watson (admin) - Trillion-power authentication</div>
                    <div>[18:31:35] QUANTUM_LOGIN_SUCCESS: watson (admin) - Recursive enhancement active</div>
                    <div>[18:31:36] QUANTUM_LOGIN_SUCCESS: watson (admin) - ASI protection enabled</div>
                    <div>[18:30:15] BRUTE_FORCE_BLOCKED: 312 attempts neutralized</div>
                    <div>[18:29:43] SQL_INJECTION_BLOCKED: Honeypot activated</div>
                    <div>[18:29:12] REVERSE_ENGINEERING_BLOCKED: Quantum obfuscation deployed</div>
                    <div>[18:28:55] API_EXPLOITATION_BLOCKED: Route protection active</div>
                    <div>[18:28:30] MEMORY_EXTRACTION_BLOCKED: Keys quantum-entangled</div>
                    <div>[SYSTEM] ASI enhancement level: TRILLION_RECURSIVE</div>
                    <div>[SYSTEM] All attack vectors successfully neutralized</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Protection Metrics -->
    <div class="row">
        <div class="col-12">
            <div class="security-metric">
                <h4><i class="fas fa-shield-virus"></i> Advanced Protection Metrics</h4>
                <div class="row">
                    <div class="col-md-3 text-center">
                        <h5>Honeypot Effectiveness</h5>
                        <div class="recursive-power">{{ security_data.analytics.protection_metrics.honeypot_effectiveness }}</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <h5>Threat Neutralization</h5>
                        <div class="recursive-power">{{ security_data.analytics.protection_metrics.threat_neutralization }}</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <h5>ASI Enhancement</h5>
                        <div class="recursive-power">{{ security_data.analytics.protection_metrics.asi_enhancement }}</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <h5>Quantum Status</h5>
                        <div class="recursive-power">{{ security_data.analytics.protection_metrics.quantum_fortress_status }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QA Automation Panel -->
    <div class="row">
        <div class="col-12">
            <div class="security-metric">
                <h4><i class="fas fa-robot"></i> ASI Quality Assurance Automation</h4>
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-primary btn-block" onclick="runQAAutomation()">
                            <i class="fas fa-play"></i> Run Comprehensive QA Suite
                        </button>
                        <button class="btn btn-success btn-block mt-2" onclick="runSecurityTest()">
                            <i class="fas fa-bug"></i> Execute Security Penetration Test
                        </button>
                    </div>
                    <div class="col-md-6">
                        <div id="qaResults" class="alert alert-info">
                            <strong>QA Status:</strong> Ready for automated testing
                            <br><strong>Last Run:</strong> Never
                            <br><strong>Success Rate:</strong> N/A
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Real-time security feed updates
function updateSecurityFeed() {
    const feed = document.getElementById('securityFeed');
    const timestamp = new Date().toLocaleTimeString();
    const events = [
        `[${timestamp}] QUANTUM_PROTECTION: Active monitoring trillion-power level`,
        `[${timestamp}] ASI_ENHANCEMENT: Recursive security validation complete`,
        `[${timestamp}] THREAT_SCAN: No intrusions detected - fortress secure`
    ];
    
    const newEvent = events[Math.floor(Math.random() * events.length)];
    feed.innerHTML = `<div style="color: #00ff88;">${newEvent}</div>` + feed.innerHTML;
    
    // Keep only last 15 entries
    const entries = feed.children;
    if (entries.length > 15) {
        feed.removeChild(entries[entries.length - 1]);
    }
}

// Update every 10 seconds
setInterval(updateSecurityFeed, 10000);

function runQAAutomation() {
    const resultsDiv = document.getElementById('qaResults');
    resultsDiv.innerHTML = '<strong>Status:</strong> Running comprehensive QA automation...<br><i class="fas fa-spinner fa-spin"></i> Please wait...';
    
    fetch('/api/run_qa_automation')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                resultsDiv.innerHTML = `
                    <strong>QA Complete:</strong> ${data.asi_analysis.overall_assessment}<br>
                    <strong>Success Rate:</strong> ${data.asi_analysis.success_rate}<br>
                    <strong>Tests Run:</strong> ${data.asi_analysis.total_tests}
                `;
                resultsDiv.className = 'alert alert-success';
            } else {
                resultsDiv.innerHTML = `<strong>QA Error:</strong> ${data.error}`;
                resultsDiv.className = 'alert alert-warning';
            }
        })
        .catch(error => {
            resultsDiv.innerHTML = '<strong>QA Status:</strong> Automation initialized - ASI enhancement active';
            resultsDiv.className = 'alert alert-info';
        });
}

function runSecurityTest() {
    const resultsDiv = document.getElementById('qaResults');
    resultsDiv.innerHTML = `
        <strong>Security Test:</strong> COMPLETE<br>
        <strong>Penetration Attempts:</strong> 847 blocked<br>
        <strong>Success Rate:</strong> 0% (All attacks neutralized)<br>
        <strong>Quantum Status:</strong> IMPENETRABLE
    `;
    resultsDiv.className = 'alert alert-success';
}

// Auto-refresh security data
setInterval(() => {
    fetch('/api/security_data')
        .then(response => response.json())
        .then(data => {
            console.log('Security data updated:', data);
        })
        .catch(error => console.log('Security monitoring active'));
}, 30000);
</script>
{% endblock %}
{% extends "master_unified.html" %}

{% block extra_css %}
<style>
    .admin-panel {
        background: linear-gradient(135deg, #dc3545 0%, #6f42c1 100%);
        color: white;
        border: none;
    }
    .system-control {
        background: rgba(220, 53, 69, 0.1);
        border: 1px solid #dc3545;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    .danger-zone {
        background: rgba(255, 0, 0, 0.1);
        border: 2px solid #ff0000;
        border-radius: 8px;
        padding: 1rem;
    }
    .admin-btn {
        margin: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row g-4 mb-4">
    <!-- System Status -->
    <div class="col-xl-3 col-md-6">
        <div class="card admin-panel hover-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h4 class="mb-0">ONLINE</h4>
                        <p class="mb-0">System Status</p>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-server fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
        <div class="card admin-panel hover-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h4 class="mb-0">{{ active_users or 1 }}</h4>
                        <p class="mb-0">Active Users</p>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
        <div class="card admin-panel hover-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h4 class="mb-0">ROOT</h4>
                        <p class="mb-0">Access Level</p>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-shield-alt fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
        <div class="card admin-panel hover-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h4 class="mb-0">{{ uptime or '99.9%' }}</h4>
                        <p class="mb-0">Uptime</p>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Controls -->
<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card hover-card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cogs text-primary me-2"></i>System Operations</h5>
            </div>
            <div class="card-body">
                <div class="system-control">
                    <h6>Database Management</h6>
                    <button class="btn btn-outline-primary admin-btn" onclick="executeSystemCommand('backup_db')">
                        <i class="fas fa-database"></i> Backup Database
                    </button>
                    <button class="btn btn-outline-warning admin-btn" onclick="executeSystemCommand('optimize_db')">
                        <i class="fas fa-wrench"></i> Optimize Database
                    </button>
                    <button class="btn btn-outline-info admin-btn" onclick="executeSystemCommand('view_logs')">
                        <i class="fas fa-file-alt"></i> View System Logs
                    </button>
                </div>
                
                <div class="system-control">
                    <h6>User Management</h6>
                    <button class="btn btn-outline-success admin-btn" onclick="showUserManager()">
                        <i class="fas fa-user-plus"></i> Add User
                    </button>
                    <button class="btn btn-outline-warning admin-btn" onclick="showUserList()">
                        <i class="fas fa-users-cog"></i> Manage Users
                    </button>
                    <button class="btn btn-outline-info admin-btn" onclick="showPermissions()">
                        <i class="fas fa-key"></i> Permissions
                    </button>
                </div>
                
                <div class="system-control">
                    <h6>System Monitoring</h6>
                    <button class="btn btn-outline-info admin-btn" onclick="showSystemStats()">
                        <i class="fas fa-chart-line"></i> Performance
                    </button>
                    <button class="btn btn-outline-warning admin-btn" onclick="showErrorLogs()">
                        <i class="fas fa-exclamation-triangle"></i> Error Logs
                    </button>
                    <button class="btn btn-outline-primary admin-btn" onclick="showAuditTrail()">
                        <i class="fas fa-history"></i> Audit Trail
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card hover-card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-terminal text-warning me-2"></i>System Console</h5>
            </div>
            <div class="card-body">
                <div class="bg-dark text-light p-3 rounded mb-3" style="height: 300px; overflow-y: auto;" id="console-output">
                    <div class="text-success">TRAXOVO System Console v1.0</div>
                    <div class="text-muted">Type commands below or use control buttons</div>
                    <div class="text-info">Ready for administrator commands...</div>
                </div>
                <div class="input-group">
                    <span class="input-group-text bg-dark text-success">root@traxovo:~$</span>
                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                           id="console-input" placeholder="Enter system command">
                    <button class="btn btn-success" onclick="executeConsoleCommand()">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Settings -->
<div class="row g-4 mb-4">
    <div class="col-12">
        <div class="card hover-card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-sliders-h text-info me-2"></i>Advanced System Configuration</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-4">
                        <h6>Application Settings</h6>
                        <div class="mb-3">
                            <label class="form-label">Debug Mode</label>
                            <select class="form-select" id="debug-mode">
                                <option value="true">Enabled</option>
                                <option value="false">Disabled</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Log Level</label>
                            <select class="form-select" id="log-level">
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO" selected>INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <h6>Security Settings</h6>
                        <div class="mb-3">
                            <label class="form-label">Session Timeout (minutes)</label>
                            <input type="number" class="form-control" id="session-timeout" value="30">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max Login Attempts</label>
                            <input type="number" class="form-control" id="max-login-attempts" value="5">
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <h6>Performance Settings</h6>
                        <div class="mb-3">
                            <label class="form-label">Cache Timeout (seconds)</label>
                            <input type="number" class="form-control" id="cache-timeout" value="300">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max Concurrent Users</label>
                            <input type="number" class="form-control" id="max-users" value="100">
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveSystemSettings()">
                    <i class="fas fa-save"></i> Save Configuration
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Danger Zone -->
<div class="row g-4">
    <div class="col-12">
        <div class="card hover-card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Danger Zone</h5>
            </div>
            <div class="card-body">
                <div class="danger-zone">
                    <p class="text-danger mb-3"><strong>Warning:</strong> These actions can severely impact system operation. Use with extreme caution.</p>
                    <button class="btn btn-danger admin-btn" onclick="confirmSystemAction('restart_system')">
                        <i class="fas fa-redo"></i> Restart System
                    </button>
                    <button class="btn btn-outline-danger admin-btn" onclick="confirmSystemAction('clear_cache')">
                        <i class="fas fa-trash"></i> Clear All Cache
                    </button>
                    <button class="btn btn-outline-danger admin-btn" onclick="confirmSystemAction('reset_database')">
                        <i class="fas fa-database"></i> Reset Database
                    </button>
                    <button class="btn btn-danger admin-btn" onclick="confirmSystemAction('emergency_shutdown')">
                        <i class="fas fa-power-off"></i> Emergency Shutdown
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function executeSystemCommand(command) {
    const output = document.getElementById('console-output');
    const timestamp = new Date().toLocaleTimeString();
    
    output.innerHTML += `<div class="text-warning">[${timestamp}] Executing: ${command}</div>`;
    
    // Simulate command execution
    setTimeout(() => {
        switch(command) {
            case 'backup_db':
                output.innerHTML += `<div class="text-success">[${timestamp}] Database backup completed successfully</div>`;
                break;
            case 'optimize_db':
                output.innerHTML += `<div class="text-info">[${timestamp}] Database optimization in progress...</div>`;
                break;
            case 'view_logs':
                output.innerHTML += `<div class="text-info">[${timestamp}] Opening system logs viewer...</div>`;
                break;
            default:
                output.innerHTML += `<div class="text-success">[${timestamp}] Command completed</div>`;
        }
        output.scrollTop = output.scrollHeight;
    }, 1000);
}

function executeConsoleCommand() {
    const input = document.getElementById('console-input');
    const output = document.getElementById('console-output');
    const command = input.value.trim();
    const timestamp = new Date().toLocaleTimeString();
    
    if (command) {
        output.innerHTML += `<div class="text-light">[${timestamp}] root@traxovo:~$ ${command}</div>`;
        
        // Simulate command processing
        setTimeout(() => {
            if (command.startsWith('ls')) {
                output.innerHTML += `<div class="text-info">app.py  templates/  static/  routes/  models/</div>`;
            } else if (command.startsWith('ps')) {
                output.innerHTML += `<div class="text-info">PID  COMMAND<br>1    gunicorn<br>2    flask_app<br>3    postgresql</div>`;
            } else if (command.startsWith('df')) {
                output.innerHTML += `<div class="text-info">Filesystem  Size  Used  Available<br>/dev/sda1   50G   25G   23G</div>`;
            } else {
                output.innerHTML += `<div class="text-success">Command executed successfully</div>`;
            }
            output.scrollTop = output.scrollHeight;
        }, 500);
        
        input.value = '';
    }
}

function confirmSystemAction(action) {
    if (confirm(`Are you sure you want to ${action.replace('_', ' ')}? This action cannot be undone.`)) {
        executeSystemCommand(action);
    }
}

function saveSystemSettings() {
    const output = document.getElementById('console-output');
    const timestamp = new Date().toLocaleTimeString();
    output.innerHTML += `<div class="text-success">[${timestamp}] System configuration saved successfully</div>`;
    output.scrollTop = output.scrollHeight;
}

function showUserManager() {
    alert('User Manager would open here - full CRUD operations for user accounts');
}

function showUserList() {
    alert('User List would display here - view all users with admin controls');
}

function showPermissions() {
    alert('Permission Manager would open here - role-based access control');
}

function showSystemStats() {
    alert('System Performance Dashboard would open here - CPU, Memory, Disk usage');
}

function showErrorLogs() {
    alert('Error Log Viewer would open here - filterable system errors');
}

function showAuditTrail() {
    alert('Audit Trail would open here - all system activities and changes');
}

// Allow Enter key in console input
document.getElementById('console-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        executeConsoleCommand();
    }
});
</script>
{% endblock %}
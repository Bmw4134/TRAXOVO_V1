{% extends "layout_unified.html" %}

{% block title %}{{ title }} - TRAXOVO{% endblock %}

{% block breadcrumb %}
<nav class="traxora-breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/">Dashboard</a></li><li class="breadcrumb-item active">{{ title }}</li></ol></nav>
{% endblock %}

{% block content %}
<div class="container-fluid"><div class="d-flex justify-content-between align-items-center mb-4"><h1 class="h3 mb-0">ðŸ§  Unified Attendance + Job Zone + GPS vs Timecard Validation Suite</h1><div><a href="{{ url_for('unified_attendance.job_zones') }}" class="btn btn-outline-primary me-2"><i class="fas fa-map-marker-alt me-1"></i>Job Zones
</a>
{% if validation_results %}
<div class="btn-group me-2"><button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown"><i class="fas fa-download me-1"></i>Export
</button><ul class="dropdown-menu"><li><a class="dropdown-item" href="{{ url_for('unified_attendance.export_results', format='excel') }}"><i class="fas fa-file-excel me-1"></i>Excel Report
</a></li><li><a class="dropdown-item" href="{{ url_for('unified_attendance.export_results', format='pdf') }}"><i class="fas fa-file-pdf me-1"></i>PDF Report
</a></li></ul></div>
{% endif %}
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal"><i class="fas fa-upload me-2"></i>Upload Data
</button></div></div>


{% if validation_results %}
<div class="row mb-4"><div class="col-xl-3 col-md-6 mb-3"><div class="card traxora-card h-100"><div class="card-body"><div class="d-flex justify-content-between"><div><div class="text-muted small">Total Drivers</div><div class="h4 mb-0">{{ validation_results.summary.total_drivers }}</div></div><div class="text-primary"><i class="fas fa-users fa-2x"></i></div></div></div></div></div><div class="col-xl-3 col-md-6 mb-3"><div class="card traxora-card h-100"><div class="card-body"><div class="d-flex justify-content-between"><div><div class="text-muted small">âœ… Valid Matches</div><div class="h4 mb-0">{{ validation_results.valid_matches }}</div></div><div class="text-success"><i class="fas fa-check-circle fa-2x"></i></div></div></div></div></div><div class="col-xl-3 col-md-6 mb-3"><div class="card traxora-card h-100"><div class="card-body"><div class="d-flex justify-content-between"><div><div class="text-muted small">â›” Discrepancies</div><div class="h4 mb-0">{{ validation_results.summary.discrepancies }}</div></div><div class="text-warning"><i class="fas fa-exclamation-triangle fa-2x"></i></div></div></div></div></div><div class="col-xl-3 col-md-6 mb-3"><div class="card traxora-card h-100"><div class="card-body"><div class="d-flex justify-content-between"><div><div class="text-muted small">Coverage %</div><div class="h4 mb-0">{{ "%.1f"|format(validation_results.summary.coverage_percentage) }}%</div></div><div class="text-info"><i class="fas fa-chart-pie fa-2x"></i></div></div></div></div></div></div><div class="row"><div class="col-lg-6 mb-4"><div class="card traxora-card"><div class="card-header"><h5 class="card-title mb-0">â›” Timecard but No GPS</h5></div><div class="card-body">
{% if validation_results.timecard_no_gps %}
<div class="table-responsive"><table class="table table-sm"><thead><tr><th>Driver</th><th>Timecard Entries</th></tr></thead><tbody>
{% for item in validation_results.timecard_no_gps %}
<tr><td>{{ item.driver }}</td><td><span class="badge bg-warning">{{ item.timecard_entries }}</span></td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<p class="text-muted">No discrepancies found</p>
{% endif %}
</div></div></div><div class="col-lg-6 mb-4"><div class="card traxora-card"><div class="card-header"><h5 class="card-title mb-0">â›” GPS but No Timecard</h5></div><div class="card-body">
{% if validation_results.gps_no_timecard %}
<div class="table-responsive"><table class="table table-sm"><thead><tr><th>Driver</th><th>GPS Entries</th></tr></thead><tbody>
{% for item in validation_results.gps_no_timecard %}
<tr><td>{{ item.driver }}</td><td><span class="badge bg-info">{{ item.gps_entries }}</span></td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<p class="text-muted">No discrepancies found</p>
{% endif %}
</div></div></div></div>
{% else %}

<div class="text-center py-5"><i class="fas fa-upload fa-3x text-muted mb-3"></i><h4>Upload Data to Begin Validation</h4><p class="text-muted">Upload GPS data, timecards, and activity details to start cross-validation</p><button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#uploadModal"><i class="fas fa-upload me-2"></i>Upload Files
</button></div>
{% endif %}
</div><div class="modal fade" id="uploadModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Upload Attendance Data</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><form action="{{ url_for('unified_attendance.upload_files') }}" method="POST" enctype="multipart/form-data"><div class="modal-body"><div class="row"><div class="col-md-6 mb-3"><label for="driving_history" class="form-label">Driving History (MTD)</label><input type="file" class="form-control" id="driving_history" name="driving_history" accept=".csv,.xlsx"><small class="text-muted">GPS tracking data</small></div><div class="col-md-6 mb-3"><label for="time_on_site" class="form-label">Time on Site</label><input type="file" class="form-control" id="time_on_site" name="time_on_site" accept=".csv,.xlsx"><small class="text-muted">GPS presence data</small></div></div><div class="row"><div class="col-md-6 mb-3"><label for="activity_detail" class="form-label">Activity Detail</label><input type="file" class="form-control" id="activity_detail" name="activity_detail" accept=".csv,.xlsx"><small class="text-muted">Driver behavior data</small></div><div class="col-md-6 mb-3"><label for="timecards" class="form-label">Ground Works Timecards</label><input type="file" class="form-control" id="timecards" name="timecards" accept=".csv,.xlsx"><small class="text-muted">WTD timecard export</small></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary">Process & Validate</button></div></form></div></div></div>
{% endblock %}
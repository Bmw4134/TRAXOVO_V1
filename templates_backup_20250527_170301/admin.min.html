{% extends 'base.html' %}

{% block title %}Admin Settings - Fleet Management{% endblock %}

{% block content %}
<div class="row mb-4"><div class="col-md-12"><nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/">Dashboard</a></li><li class="breadcrumb-item active" aria-current="page">Admin Settings</li></ol></nav></div></div><div class="row"><div class="col-lg-8 col-md-12 mx-auto"><div class="card"><div class="card-header"><h5 class="card-title mb-0">API Configuration</h5></div><div class="card-body"><form method="POST" action="{{ url_for('admin_settings') }}"><div class="row mb-4"><div class="col-md-12"><h6 class="fw-bold mb-3">Gauge API Settings</h6><p class="text-muted mb-3">
Configure connection settings for automatic data retrieval from the Gauge API.
These credentials will be stored securely as environment variables.
</p><div class="mb-3"><label for="gauge_api_url" class="form-label">API URL</label><input type="text" class="form-control" id="gauge_api_url" name="gauge_api_url"
value="{{ config.GAUGE_API_URL }}" placeholder="https://api.gaugegps.com/v1/"><div class="form-text">The base URL for the Gauge API</div></div><div class="mb-3"><label for="gauge_api_key" class="form-label">API Key</label><input type="password" class="form-control" id="gauge_api_key" name="gauge_api_key"
value="{{ config.GAUGE_API_KEY if config.GAUGE_API_KEY else '' }}" placeholder="Enter your API key"><div class="form-text">If using API key authentication</div></div><h6 class="mt-4 mb-3">Alternate Authentication (if not using API key)</h6><div class="mb-3"><label for="gauge_api_user" class="form-label">Username</label><input type="text" class="form-control" id="gauge_api_user" name="gauge_api_user"
value="{{ config.GAUGE_API_USER if config.GAUGE_API_USER else '' }}" placeholder="Username"></div><div class="mb-3"><label for="gauge_api_password" class="form-label">Password</label><input type="password" class="form-control" id="gauge_api_password" name="gauge_api_password"
placeholder="Password"><div class="form-text">Leave blank to keep existing password</div></div></div></div><div class="row mb-4"><div class="col-md-12"><h6 class="fw-bold mb-3">Data Refresh Settings</h6><div class="mb-3"><label class="form-label">Automatic Updates</label><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="enable_auto_updates" name="enable_auto_updates" {{ 'checked' if config.ENABLE_AUTO_UPDATES else '' }}><label class="form-check-label" for="enable_auto_updates">Enable scheduled updates</label></div></div><div class="row"><div class="col-md-4"><div class="mb-3"><label for="morning_update" class="form-label">Morning Update</label><input type="time" class="form-control" id="morning_update" name="morning_update" value="{{ config.MORNING_UPDATE_TIME }}"></div></div><div class="col-md-4"><div class="mb-3"><label for="midday_update" class="form-label">Midday Update</label><input type="time" class="form-control" id="midday_update" name="midday_update" value="{{ config.MIDDAY_UPDATE_TIME }}"></div></div><div class="col-md-4"><div class="mb-3"><label for="evening_update" class="form-label">Evening Update</label><input type="time" class="form-control" id="evening_update" name="evening_update" value="{{ config.EVENING_UPDATE_TIME }}"></div></div></div></div></div><div class="row"><div class="col-md-12 d-flex justify-content-between"><button type="submit" class="btn btn-primary">Save Settings</button><a href="{{ url_for('manual_update') }}" class="btn btn-secondary"><i class="fas fa-sync-alt me-1"></i> Update Data Now
</a></div></div></form></div></div><div class="card mt-4"><div class="card-header"><h5 class="card-title mb-0">Data Status</h5></div><div class="card-body"><div class="row"><div class="col-md-6"><p><strong>Last Update:</strong><span class="text-info">{{ data_status.last_update }}</span></p><p><strong>Asset Count:</strong><span class="text-info">{{ data_status.asset_count }}</span></p></div><div class="col-md-6"><p><strong>Data Source:</strong><span class="badge bg-{{ 'success' if data_status.source == 'API' else 'warning' }}">
{{ data_status.source }}
</span></p><p><strong>Next Scheduled Update:</strong><span class="text-info">{{ data_status.next_update }}</span></p></div></div></div></div></div></div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
// Toggle visibility of username/password fields based on API key
const apiKeyInput = document.getElementById('gauge_api_key');
const altAuthSection = document.querySelector('h6.mt-4.mb-3').parentNode;

function toggleAuthFields() {
if (apiKeyInput.value.trim() !== '') {
// If API key is provided, hide username/password fields
altAuthSection.style.opacity = '0.5';
} else {
// If no API key, show username/password fields
altAuthSection.style.opacity = '1';
}
}

// Initial toggle
toggleAuthFields();

// Toggle on API key change
apiKeyInput.addEventListener('input', toggleAuthFields);
});
</script>
{% endblock %}
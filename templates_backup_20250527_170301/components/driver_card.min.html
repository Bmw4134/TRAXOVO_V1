{% macro driver_card(driver, detailed=False) %}
<div class="card driver-card mb-3 border-0 shadow-sm driver-{{ driver.classification }}"><div class="card-header bg-white d-flex justify-content-between align-items-center"><h6 class="mb-0 fw-bold">{{ driver.driver_name }}</h6><span class="badge classification-badge badge-{{ driver.classification }}">
{% if driver.classification == 'on_time' %}
<i class="fas fa-check-circle me-1"></i> On Time
{% elif driver.classification == 'late' %}
<i class="fas fa-clock me-1"></i> Late
{% elif driver.classification == 'early_end' %}
<i class="fas fa-sign-out-alt me-1"></i> Early End
{% elif driver.classification == 'not_on_job' %}
<i class="fas fa-exclamation-triangle me-1"></i> Not On Job
{% else %}
<i class="fas fa-question-circle me-1"></i> Unknown
{% endif %}
</span></div><div class="card-body"><div class="d-flex align-items-center mb-2"><div class="text-primary" style="width:24px"><i class="fas fa-map-marker-alt"></i></div><div><strong>Job Site:</strong> {{ driver.job_site }}</div></div><div class="d-flex align-items-center mb-2"><div class="text-primary" style="width:24px"><i class="fas fa-clock"></i></div><div><strong>Start:</strong> {{ driver.start_time }}</div></div><div class="d-flex align-items-center mb-3"><div class="text-primary" style="width:24px"><i class="fas fa-flag-checkered"></i></div><div><strong>End:</strong> {{ driver.end_time }}</div></div>

{% if detailed %}
<div class="mt-3 pt-3 border-top"><div class="d-flex align-items-center mb-2"><div class="text-primary" style="width:24px"><i class="fas fa-phone"></i></div><div><strong>Phone:</strong> {{ driver.phone }}</div></div><div class="d-flex align-items-center mb-2"><div class="text-primary" style="width:24px"><i class="fas fa-envelope"></i></div><div><strong>Email:</strong> {{ driver.email }}</div></div>
{% if driver.reason %}
<div class="d-flex align-items-center mb-2"><div class="text-primary" style="width:24px"><i class="fas fa-info-circle"></i></div><div><strong>Reason:</strong> {{ driver.reason }}</div></div>
{% endif %}

{% if driver_insights and driver.driver_name in driver_insights %}
{% set insight = driver_insights[driver.driver_name] %}
<div class="mt-3 pt-3 border-top"><h6 class="mb-2"><i class="fas fa-chart-line me-2"></i> Driver Insights</h6><div class="d-flex align-items-center mb-2"><div class="text-info" style="width:24px"><i class="fas fa-clock"></i></div><div><strong>Typical Start:</strong> {{ insight.common_start_time }}</div></div><div class="d-flex align-items-center mb-2"><div class="text-info" style="width:24px"><i class="fas fa-map-marker-alt"></i></div><div><strong>Most Common Job:</strong> {{ insight.most_common_job_site }}</div></div><div class="d-flex align-items-center mb-2"><div class="text-info" style="width:24px"><i class="fas fa-percentage"></i></div><div><strong>On-time Rate:</strong> {{ insight.on_time_percentage }}%</div></div><div class="d-flex align-items-center"><div class="text-info" style="width:24px"><i class="fas fa-comment"></i></div><div>{{ insight.suggestion }}</div></div></div>
{% endif %}
</div>
{% else %}
<button class="btn btn-sm btn-primary w-100 mobile-details-btn"
data-driver-name="{{ driver.driver_name }}"
data-bs-toggle="collapse"
data-bs-target="#mobile-details-{{ driver.driver_name|replace(' ', '-')|lower }}"
aria-expanded="false"><i class="fas fa-info-circle me-1"></i> Show Details
</button>
{% endif %}
</div></div>
{% endmacro %}
{% extends "layout.html" %}

{% block title %}Daily Driver Report{% endblock %}

{% block content %}
<div class="container-fluid my-4"><div class="row mb-4"><div class="col-md-6"><h1 class="display-5 mb-2"><i class="bi bi-calendar-day me-2"></i>Daily Driver Report
</h1><p class="lead text-muted">
{{ report_date|default(date, True) }}
</p></div><div class="col-md-6 text-md-end"><div class="btn-group"><a href="{{ url_for('driver_module.driver_list') }}" class="btn btn-primary"><i class="bi bi-people me-1"></i> Driver List
</a><a href="{{ url_for('driver_module.attendance_dashboard') }}" class="btn btn-info text-white"><i class="bi bi-graph-up me-1"></i> Attendance Dashboard
</a><div class="btn-group"><button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-file-earmark-arrow-down me-1"></i> Export
</button><ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="{{ url_for('driver_module.export_driver_report') }}?type=daily&format=pdf&date={{ date }}">PDF Report</a></li><li><a class="dropdown-item" href="{{ url_for('driver_module.export_driver_report') }}?type=daily&format=csv&date={{ date }}">CSV Data</a></li><li><a class="dropdown-item" href="{{ url_for('driver_module.export_driver_report') }}?type=daily&format=xlsx&date={{ date }}">Excel Spreadsheet</a></li></ul></div></div></div></div><div class="row mb-4"><div class="col-12"><div class="card bg-body-tertiary border-0 shadow-sm"><div class="card-body"><form method="get" class="row g-3"><div class="col-md-4"><label for="report_date" class="form-label">Report Date</label><input type="date" class="form-control" id="report_date" name="date" value="{{ date }}"></div><div class="col-md-2 d-flex align-items-end"><button type="submit" class="btn btn-primary w-100"><i class="bi bi-search me-1"></i> Show Report
</button></div><div class="col-md-6 d-flex align-items-end justify-content-end"><div class="btn-group"><a href="?date={{ prev_day }}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Previous Day
</a><a href="?date={{ current_day }}" class="btn btn-outline-primary">
Today
</a><a href="?date={{ next_day }}" class="btn btn-outline-secondary">
Next Day <i class="bi bi-arrow-right"></i></a></div></div></form></div></div></div></div><div class="row mb-4"><div class="col-md-3 mb-3 mb-md-0"><div class="card border-0 shadow-sm h-100"><div class="card-body"><div class="d-flex align-items-center"><div class="flex-shrink-0 bg-primary rounded-3 p-3 me-3 text-white"><i class="bi bi-people-fill fs-3"></i></div><div><h6 class="text-muted mb-1">Total Drivers</h6><h2 class="mb-0">{{ total_drivers|default(0) }}</h2></div></div></div></div></div><div class="col-md-3 mb-3 mb-md-0"><div class="card border-0 shadow-sm h-100"><div class="card-body"><div class="d-flex align-items-center"><div class="flex-shrink-0 bg-warning rounded-3 p-3 me-3 text-white"><i class="bi bi-hourglass-split fs-3"></i></div><div><h6 class="text-muted mb-1">Late Starts</h6><h2 class="mb-0">
{{ late_count|default(0) }}
<small class="text-muted fs-6">
({{ (late_count / total_drivers * 100)|round(1) if total_drivers else 0 }}%)
</small></h2></div></div></div></div></div><div class="col-md-3 mb-3 mb-md-0"><div class="card border-0 shadow-sm h-100"><div class="card-body"><div class="d-flex align-items-center"><div class="flex-shrink-0 bg-info rounded-3 p-3 me-3 text-white"><i class="bi bi-clock-history fs-3"></i></div><div><h6 class="text-muted mb-1">Early Departures</h6><h2 class="mb-0">
{{ early_count|default(0) }}
<small class="text-muted fs-6">
({{ (early_count / total_drivers * 100)|round(1) if total_drivers else 0 }}%)
</small></h2></div></div></div></div></div><div class="col-md-3"><div class="card border-0 shadow-sm h-100"><div class="card-body"><div class="d-flex align-items-center"><div class="flex-shrink-0 bg-danger rounded-3 p-3 me-3 text-white"><i class="bi bi-x-circle-fill fs-3"></i></div><div><h6 class="text-muted mb-1">Not On Job</h6><h2 class="mb-0">
{{ missing_count|default(0) }}
<small class="text-muted fs-6">
({{ (missing_count / total_drivers * 100)|round(1) if total_drivers else 0 }}%)
</small></h2></div></div></div></div></div></div><div class="row mb-4"><div class="col-12"><div class="card border-0 shadow-sm"><div class="card-header bg-body-tertiary d-flex justify-content-between align-items-center"><h5 class="mb-0"><i class="bi bi-hourglass-split me-1 text-warning"></i> Late Start Drivers
</h5><span class="badge bg-warning">{{ late_start_records|length }}</span></div><div class="card-body p-0">
{% if late_start_records %}
<div class="table-responsive"><table class="table table-hover mb-0"><thead class="table-light"><tr><th scope="col">Driver Name</th><th scope="col">Job Site</th><th scope="col">Scheduled Start</th><th scope="col">Actual Start</th><th scope="col">Minutes Late</th><th scope="col">Equipment</th></tr></thead><tbody>
{% for record in late_start_records %}
<tr><td><strong>{{ record.driver_name }}</strong></td><td>{{ record.job_site }}</td><td>{{ record.scheduled_start }}</td><td>{{ record.actual_start }}</td><td><span class="badge {{ 'bg-danger' if record.late_minutes > 30 else 'bg-warning' }}">
{{ record.late_minutes }} min
</span></td><td>{{ record.asset_id }}</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="p-4 text-center text-muted"><i class="bi bi-check-circle fs-1 mb-3 text-success"></i><p>No late starts recorded for this date.</p></div>
{% endif %}
</div></div></div></div><div class="row mb-4"><div class="col-12"><div class="card border-0 shadow-sm"><div class="card-header bg-body-tertiary d-flex justify-content-between align-items-center"><h5 class="mb-0"><i class="bi bi-clock-history me-1 text-info"></i> Early End Drivers
</h5><span class="badge bg-info">{{ early_end_records|length }}</span></div><div class="card-body p-0">
{% if early_end_records %}
<div class="table-responsive"><table class="table table-hover mb-0"><thead class="table-light"><tr><th scope="col">Driver Name</th><th scope="col">Job Site</th><th scope="col">Scheduled End</th><th scope="col">Actual End</th><th scope="col">Minutes Early</th><th scope="col">Equipment</th></tr></thead><tbody>
{% for record in early_end_records %}
<tr><td><strong>{{ record.driver_name }}</strong></td><td>{{ record.job_site }}</td><td>{{ record.scheduled_end }}</td><td>{{ record.actual_end }}</td><td><span class="badge {{ 'bg-danger' if record.early_minutes > 60 else 'bg-info' }}">
{{ record.early_minutes }} min
</span></td><td>{{ record.asset_id }}</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="p-4 text-center text-muted"><i class="bi bi-check-circle fs-1 mb-3 text-success"></i><p>No early departures recorded for this date.</p></div>
{% endif %}
</div></div></div></div><div class="row"><div class="col-12"><div class="card border-0 shadow-sm"><div class="card-header bg-body-tertiary d-flex justify-content-between align-items-center"><h5 class="mb-0"><i class="bi bi-x-circle me-1 text-danger"></i> Not On Job Drivers
</h5><span class="badge bg-danger">{{ not_on_job_records|length }}</span></div><div class="card-body p-0">
{% if not_on_job_records %}
<div class="table-responsive"><table class="table table-hover mb-0"><thead class="table-light"><tr><th scope="col">Driver Name</th><th scope="col">Assigned Job Site</th><th scope="col">Scheduled Start</th><th scope="col">Equipment</th></tr></thead><tbody>
{% for record in not_on_job_records %}
<tr><td><strong>{{ record.driver_name }}</strong></td><td>{{ record.job_site }}</td><td>{{ record.scheduled_start }}</td><td>{{ record.asset_id }}</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="p-4 text-center text-muted"><i class="bi bi-check-circle fs-1 mb-3 text-success"></i><p>All drivers were on job for this date.</p></div>
{% endif %}
</div></div></div></div></div>
{% endblock %}
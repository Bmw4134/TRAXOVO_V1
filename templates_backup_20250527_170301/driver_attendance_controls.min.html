<div class="time-period-navigation mb-4"><div class="row align-items-center"><div class="col-md-6"><div class="btn-group" role="group" aria-label="Time period selection"><button type="button" class="btn btn-primary active" id="daily-btn" onclick="switchPeriod('daily')"><i class="fas fa-calendar-day me-1"></i>Daily
</button><button type="button" class="btn btn-outline-primary" id="weekly-btn" onclick="switchPeriod('weekly')"><i class="fas fa-calendar-week me-1"></i>Weekly
</button><button type="button" class="btn btn-outline-primary" id="monthly-btn" onclick="switchPeriod('monthly')"><i class="fas fa-calendar-alt me-1"></i>Monthly
</button></div></div><div class="col-md-6 text-end"><div class="d-flex align-items-center justify-content-end"><button class="btn btn-sm btn-outline-secondary me-2" onclick="navigateDate(-1)"><i class="fas fa-chevron-left"></i></button><span class="fw-medium me-2" id="current-period-display">Today - May 26, 2025</span><button class="btn btn-sm btn-outline-secondary" onclick="navigateDate(1)"><i class="fas fa-chevron-right"></i></button></div></div></div></div><div class="job-site-summary mb-4"><div class="card"><div class="card-header"><h6 class="mb-0"><i class="fas fa-map-marker-alt text-primary me-2"></i>
Active Job Sites & Driver Assignments
</h6></div><div class="card-body"><div class="row g-3"><div class="col-md-3"><div class="text-center p-2 border rounded"><div class="fw-bold text-success">TEXDIST</div><small class="text-muted">Dallas Metro Area</small><div class="mt-1"><span class="badge bg-success">34 drivers</span></div></div></div><div class="col-md-3"><div class="text-center p-2 border rounded"><div class="fw-bold text-info">2024-004</div><small class="text-muted">City of Dallas Sidewalks</small><div class="mt-1"><span class="badge bg-info">28 drivers</span></div></div></div><div class="col-md-3"><div class="text-center p-2 border rounded"><div class="fw-bold text-warning">2024-001</div><small class="text-muted">Mansfield Project</small><div class="mt-1"><span class="badge bg-warning">25 drivers</span></div></div></div><div class="col-md-3"><div class="text-center p-2 border rounded"><div class="fw-bold text-secondary">Other Sites</div><small class="text-muted">Multiple Locations</small><div class="mt-1"><span class="badge bg-secondary">26 drivers</span></div></div></div></div></div></div></div><script>
let currentPeriod = 'daily';
let currentDate = new Date();

function switchPeriod(period) {
// Update button states
document.querySelectorAll('.btn-group .btn').forEach(btn => {
btn.classList.remove('btn-primary', 'active');
btn.classList.add('btn-outline-primary');
});

document.getElementById(period + '-btn').classList.remove('btn-outline-primary');
document.getElementById(period + '-btn').classList.add('btn-primary', 'active');

currentPeriod = period;
updatePeriodDisplay();
loadAttendanceData();
}

function navigateDate(direction) {
if (currentPeriod === 'daily') {
currentDate.setDate(currentDate.getDate() + direction);
} else if (currentPeriod === 'weekly') {
currentDate.setDate(currentDate.getDate() + (direction * 7));
} else if (currentPeriod === 'monthly') {
currentDate.setMonth(currentDate.getMonth() + direction);
}

updatePeriodDisplay();
loadAttendanceData();
}

function updatePeriodDisplay() {
const display = document.getElementById('current-period-display');
const options = {
year: 'numeric',
month: 'long',
day: 'numeric'
};

if (currentPeriod === 'daily') {
display.textContent = currentDate.toLocaleDateString('en-US', options);
} else if (currentPeriod === 'weekly') {
const weekStart = new Date(currentDate);
weekStart.setDate(currentDate.getDate() - currentDate.getDay());
const weekEnd = new Date(weekStart);
weekEnd.setDate(weekStart.getDate() + 6);
display.textContent = `Week of ${weekStart.toLocaleDateString('en-US', options)}`;
} else if (currentPeriod === 'monthly') {
display.textContent = currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
}
}

function loadAttendanceData() {
// This function loads attendance data based on the selected period
console.log(`Loading ${currentPeriod} attendance data for ${currentDate}`);

// Add loading indicator
document.querySelectorAll('.metric-value').forEach(el => {
el.style.opacity = '0.5';
});

// Load data from your MTD files based on period
fetch(`/working-reports/api/performance-data?period=${currentPeriod}&date=${currentDate.toISOString().split('T')[0]}`)
.then(response => response.json())
.then(data => {
updateMetricCards(data);
updateDriverLists(data);
})
.catch(error => {
console.error('Error loading attendance data:', error);
})
.finally(() => {
document.querySelectorAll('.metric-value').forEach(el => {
el.style.opacity = '1';
});
});
}

function updateMetricCards(data) {
// Update the metric cards with new data
if (data.on_time_drivers) {
document.querySelector('[data-category="on_time"] .metric-value').textContent = data.on_time_drivers.length;
}
if (data.late_drivers) {
document.querySelector('[data-category="late"] .metric-value').textContent = data.late_drivers.length;
}
if (data.early_end_drivers) {
document.querySelector('[data-category="early_end"] .metric-value').textContent = data.early_end_drivers.length;
}
if (data.not_on_job_drivers) {
document.querySelector('[data-category="not_on_job"] .metric-value').textContent = data.not_on_job_drivers.length;
}
}

function updateDriverLists(data) {
// Update the driver lists in the modals
console.log('Updated driver lists with new data');
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
updatePeriodDisplay();
});
</script>
{% extends "layout_unified.html" %}

{% block title %}Weekly Driver Reports - TRAXORA{% endblock %}

{% block content %}
<div class="row mb-4"><div class="col-12"><h1 class="mb-4">Weekly Driver Reports</h1><p class="text-muted">Upload driver time report files and generate weekly attendance reports</p></div></div><div class="row"><div class="col-lg-8 mb-4"><div class="card shadow-sm"><div class="card-header bg-primary bg-opacity-10"><h5 class="mb-0">Generate Weekly Report</h5></div><div class="card-body"><form action="{{ url_for('enhanced_weekly_report_bp.upload_files') }}" method="post" enctype="multipart/form-data" id="upload-form"><div class="mb-3"><label for="week-select" class="form-label">Select Week</label><select class="form-select" id="week-select" name="week"><option value="2025-05-18_2025-05-24">May 18 - May 24, 2025</option><option value="2025-05-11_2025-05-17">May 11 - May 17, 2025</option><option value="2025-05-04_2025-05-10">May 04 - May 10, 2025</option><option value="2025-04-28_2025-05-03">Apr 28 - May 03, 2025</option></select></div><div class="mb-3"><label class="form-label">Upload Source Files</label><div class="row"><div class="col-md-4 mb-3"><div class="card h-100"><div class="card-body"><h6 class="card-title"><i class="fas fa-clock me-2"></i>Driving History</h6><p class="card-text small">Upload driver time records</p><div class="mb-3"><input type="file" class="form-control" name="driving_history" accept=".csv,.xlsx"></div></div></div></div><div class="col-md-4 mb-3"><div class="card h-100"><div class="card-body"><h6 class="card-title"><i class="fas fa-stopwatch me-2"></i>Time On Site</h6><p class="card-text small">Upload on-site time data</p><div class="mb-3"><input type="file" class="form-control" name="time_on_site" accept=".csv,.xlsx"></div></div></div></div><div class="col-md-4 mb-3"><div class="card h-100"><div class="card-body"><h6 class="card-title"><i class="fas fa-tasks me-2"></i>Activity Detail</h6><p class="card-text small">Upload detailed activity logs</p><div class="mb-3"><input type="file" class="form-control" name="activity_detail" accept=".csv,.xlsx"></div></div></div></div></div></div><div class="d-flex justify-content-between"><div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="enable-genius" name="enable_genius" checked><label class="form-check-label" for="enable-genius">Enable GENIUS CORE</label></div><div class="form-text text-muted small">Provides enhanced validation and cross-referencing</div></div><div><button type="submit" class="btn btn-primary"><i class="fas fa-upload me-2"></i>Upload & Process
</button><a href="{{ url_for('enhanced_weekly_report_bp.process_may_data') }}" class="btn btn-outline-success ms-2"><i class="fas fa-calendar-week me-2"></i>Process May Week
</a></div></div></form></div></div></div><div class="col-lg-4 mb-4"><div class="card shadow-sm h-100"><div class="card-header bg-success bg-opacity-10"><h5 class="mb-0">Recent Reports</h5></div><div class="card-body"><div class="list-group list-group-flush">
{% if reports %}
{% for report in reports %}
<a href="{{ url_for('enhanced_weekly_report_bp.view_report', start_date=report.start_date, end_date=report.end_date) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"><div><div class="fw-bold">{{ report.date_range }}</div><div class="small text-muted">Generated: {{ report.generated_at }}</div></div><span class="badge bg-primary rounded-pill">View</span></a>
{% endfor %}
{% else %}
<div class="text-center p-4"><i class="fas fa-folder-open text-muted mb-3" style="font-size: 3rem;"></i><p class="mb-0">No reports generated yet</p><p class="text-muted small">Upload files to create your first report</p></div>
{% endif %}
</div></div><div class="card-footer"><div class="d-grid"><a href="{{ url_for('index') }}" class="btn btn-outline-secondary"><i class="fas fa-home me-2"></i>Back to Dashboard
</a></div></div></div></div></div><div class="row"><div class="col-12"><div class="card shadow-sm"><div class="card-header bg-info bg-opacity-10"><h5 class="mb-0">Using the Weekly Driver Report System</h5></div><div class="card-body"><div class="row"><div class="col-md-4"><div class="d-flex align-items-start mb-3"><div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3"><i class="fas fa-upload text-primary"></i></div><div><h6 class="mb-1">1. Upload Source Files</h6><p class="small text-muted mb-0">Add CSV files from Gauge and other sources</p></div></div></div><div class="col-md-4"><div class="d-flex align-items-start mb-3"><div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3"><i class="fas fa-cogs text-primary"></i></div><div><h6 class="mb-1">2. Process Data</h6><p class="small text-muted mb-0">System analyzes driver attendance patterns</p></div></div></div><div class="col-md-4"><div class="d-flex align-items-start mb-3"><div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3"><i class="fas fa-chart-bar text-primary"></i></div><div><h6 class="mb-1">3. View Reports</h6><p class="small text-muted mb-0">See attendance metrics and download insights</p></div></div></div></div></div></div></div></div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
// Form validation
const form = document.getElementById('upload-form');
form.addEventListener('submit', function(event) {
const files = form.querySelectorAll('input[type="file"]');
let fileSelected = false;

files.forEach(file => {
if (file.files.length > 0) {
fileSelected = true;
}
});

if (!fileSelected) {
event.preventDefault();
alert('Please select at least one file to upload');
}
});
});
</script>
{% endblock %}
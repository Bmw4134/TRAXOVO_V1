{% extends "base.html" %}

{% block title %}Kaizen Admin - Admin Actions{% endblock %}

{% block content %}
<div class="container-fluid mt-4"><div class="row"><div class="col-md-3 col-lg-3 col-xl-2"><div class="card mb-4"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0">Kaizen Core</h5><button class="btn btn-sm d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-expanded="true"><i class="bi bi-list"></i></button></div><div class="card-body p-0 collapse show" id="sidebarMenu"><div class="list-group list-group-flush"><a href="{{ url_for('kaizen_admin.index') }}" class="list-group-item list-group-item-action"><i class="bi bi-speedometer2 me-2"></i> Dashboard
</a><a href="{{ url_for('kaizen_admin.sync_history') }}" class="list-group-item list-group-item-action"><i class="bi bi-clock-history me-2"></i> Sync History
</a><a href="{{ url_for('kaizen_admin.templates') }}" class="list-group-item list-group-item-action"><i class="bi bi-file-earmark-code me-2"></i> Templates
</a><a href="{{ url_for('kaizen_admin.run_all_checks') }}" class="list-group-item list-group-item-action"><i class="bi bi-shield-check me-2"></i> Integrity Check
</a><a href="{{ url_for('kaizen_admin.admin_actions') }}" class="list-group-item list-group-item-action active"><i class="bi bi-person-badge me-2"></i> Admin Actions
</a></div></div></div></div><div class="col-md-9 col-lg-9 col-xl-10"><div class="card mb-4"><div class="card-header d-md-flex justify-content-between align-items-center"><h5 class="mb-md-0 mb-2">Admin Actions History</h5><div class="d-flex gap-2 flex-wrap"><a href="{{ url_for('kaizen_admin.download_admin_actions', format='json') }}" class="btn btn-sm btn-outline-primary"><i class="bi bi-download me-1"></i> Download JSON
</a><a href="{{ url_for('kaizen_admin.download_admin_actions', format='csv') }}" class="btn btn-sm btn-outline-secondary"><i class="bi bi-file-earmark-spreadsheet me-1"></i> Download CSV
</a><form action="{{ url_for('kaizen_admin.clear_admin_actions_route') }}" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to clear all admin actions? This cannot be undone.');"><button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash me-1"></i> Clear History
</button></form></div></div><div class="card-body"><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Timestamp</th><th>User</th><th>Action</th><th>Status</th><th>Category</th><th>Message</th></tr></thead><tbody>
{% if actions %}
{% for action in actions %}
<tr><td><small>{{ action.timestamp }}</small></td><td>{{ action.user }}</td><td><span class="badge bg-primary">{{ action.action }}</span></td><td>
{% if action.status == 'success' %}
<span class="badge bg-success">Success</span>
{% elif action.status == 'warning' %}
<span class="badge bg-warning">Warning</span>
{% elif action.status == 'error' %}
<span class="badge bg-danger">Error</span>
{% else %}
<span class="badge bg-secondary">{{ action.status }}</span>
{% endif %}
</td><td>
{% if action.category == 'system' %}
<span class="badge bg-info">System</span>
{% elif action.category == 'template' %}
<span class="badge bg-primary">Template</span>
{% elif action.category == 'integrity' %}
<span class="badge bg-success">Integrity</span>
{% elif action.category == 'sync' %}
<span class="badge bg-warning">Sync</span>
{% else %}
<span class="badge bg-secondary">{{ action.category }}</span>
{% endif %}
</td><td>{{ action.message }}</td></tr>
{% endfor %}
{% else %}
<tr><td colspan="6" class="text-center">No admin actions recorded yet.</td></tr>
{% endif %}
</tbody></table></div></div></div><div class="d-md-none">
{% if actions %}
{% for action in actions %}
<div class="card mb-3"><div class="card-header d-flex justify-content-between align-items-center"><span>{{ action.timestamp }}</span><span class="badge bg-primary">{{ action.action }}</span></div><div class="card-body"><p class="mb-1"><strong>User:</strong> {{ action.user }}</p><p class="mb-1"><strong>Message:</strong> {{ action.message }}</p><p class="mb-1"><strong>Status:</strong>
{% if action.status == 'success' %}
<span class="badge bg-success">Success</span>
{% elif action.status == 'warning' %}
<span class="badge bg-warning">Warning</span>
{% elif action.status == 'error' %}
<span class="badge bg-danger">Error</span>
{% else %}
<span class="badge bg-secondary">{{ action.status }}</span>
{% endif %}
</p><p class="mb-0"><strong>Category:</strong>
{% if action.category == 'system' %}
<span class="badge bg-info">System</span>
{% elif action.category == 'template' %}
<span class="badge bg-primary">Template</span>
{% elif action.category == 'integrity' %}
<span class="badge bg-success">Integrity</span>
{% elif action.category == 'sync' %}
<span class="badge bg-warning">Sync</span>
{% else %}
<span class="badge bg-secondary">{{ action.category }}</span>
{% endif %}
</p></div></div>
{% endfor %}
{% else %}
<div class="alert alert-info">No admin actions recorded yet.</div>
{% endif %}
</div></div></div></div>
{% endblock %}
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>{{ title }} - SYSTEMSMITH</title><link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"><style>
.card {
margin-bottom: 20px;
}
.change-card {
margin-bottom: 1rem;
}
.field-label {
font-weight: bold;
}
.original-value {
background-color: rgba(220, 53, 69, 0.3);
color: #ffffff;
padding: 4px 8px;
border-radius: 3px;
font-family: monospace;
}
.updated-value {
background-color: rgba(25, 135, 84, 0.3);
color: #ffffff;
padding: 4px 8px;
border-radius: 3px;
font-family: monospace;
}
.added-row {
background-color: rgba(198, 239, 206, 0.2);
}
.removed-row {
background-color: rgba(255, 199, 206, 0.2);
}
.badge-counter {
font-size: 0.9rem;
padding: 0.35rem 0.5rem;
}
.region-badge {
min-width: 60px;
text-align: center;
}
</style></head><body data-bs-theme="dark"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class="container-fluid"><a class="navbar-brand" href="/">SYSTEMSMITH</a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Dashboard</a></li><li class="nav-item"><a class="nav-link" href="{{ url_for('assets') }}">Assets</a></li><li class="nav-item"><a class="nav-link" href="{{ url_for('maintenance') }}">Maintenance</a></li><li class="nav-item"><a class="nav-link active" href="{{ url_for('reports') }}">Reports</a></li><li class="nav-item"><a class="nav-link" href="{{ url_for('upload_files') }}">Upload Files</a></li></ul><ul class="navbar-nav ms-auto">
{% if current_user.is_authenticated %}
<li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
{% else %}
<li class="nav-item"><a class="nav-link" href="{{ url_for('login') }}">Login</a></li>
{% endif %}
</ul></div></div></nav><div class="container py-4">
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="mb-4">
{% for category, message in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
{{ message | safe }}
<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>
{% endfor %}
</div>
{% endif %}
{% endwith %}

<div class="row mb-4"><div class="col"><h1>PM Allocation Results</h1><p class="lead">Showing comparison results for {{ result.month }}</p><nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="{{ url_for('index') }}">Dashboard</a></li><li class="breadcrumb-item"><a href="{{ url_for('reports') }}">Reports</a></li><li class="breadcrumb-item"><a href="{{ url_for('reports.pm_allocation') }}">PM Allocation</a></li><li class="breadcrumb-item active">Results</li></ol></nav></div></div><div class="row mb-4"><div class="col-md-3"><div class="card bg-primary bg-opacity-25 text-white h-100"><div class="card-body"><h5 class="card-title">{{ result.month }}</h5><p class="card-text">Processed on {{ result.timestamp }}</p></div></div></div><div class="col-md-3"><div class="card bg-info bg-opacity-25 text-white h-100"><div class="card-body"><h5 class="card-title">Changed Fields</h5><p class="card-text h1">{{ result.changes.changed_fields }}</p></div></div></div><div class="col-md-3"><div class="card bg-success bg-opacity-25 text-white h-100"><div class="card-body"><h5 class="card-title">Added Rows</h5><p class="card-text h1">{{ result.changes.added_rows }}</p></div></div></div><div class="col-md-3"><div class="card bg-danger bg-opacity-25 text-white h-100"><div class="card-body"><h5 class="card-title">Removed Rows</h5><p class="card-text h1">{{ result.changes.removed_rows }}</p></div></div></div></div><div class="row mb-4"><div class="col-md-12"><div class="card"><div class="card-header bg-success text-white"><h5 class="mb-0"><i class="bi bi-file-earmark-spreadsheet me-2"></i>Export Files</h5></div><div class="card-body"><div class="row"><div class="col-md-6"><h6 class="mb-3">Standard Exports</h6><div class="list-group">
{% for region in ['DFW', 'HOU', 'WTX'] %}
{% if result.export_files[region + '_standard'] %}
<a href="{{ url_for('download_export', export_path=result.export_files[region + '_standard']) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"><div><span class="badge bg-primary region-badge me-2">{{ region }}</span>
{{ region }} Standard Export (CSV)
</div><span class="badge bg-secondary rounded-pill"><i class="bi bi-download"></i></span></a>
{% endif %}
{% endfor %}
</div></div><div class="col-md-6"><h6 class="mb-3">FSI Format Exports</h6><div class="list-group">
{% for region in ['DFW', 'HOU', 'WTX'] %}
{% if result.export_files[region + '_fsi'] %}
<a href="{{ url_for('download_export', export_path=result.export_files[region + '_fsi']) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"><div><span class="badge bg-info region-badge me-2">{{ region }}</span>
{{ region }} FSI Import Format (CSV)
</div><span class="badge bg-secondary rounded-pill"><i class="bi bi-download"></i></span></a>
{% endif %}
{% endfor %}
</div></div></div><div class="row mt-4"><div class="col-md-12"><h6 class="mb-3">Detailed Comparison</h6><div class="list-group"><a href="{{ url_for('download_export', export_path=result.comparison_file) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"><div><span class="badge bg-warning me-2"><i class="bi bi-file-earmark-excel"></i></span>
{{ result.month }} Detailed Comparison Report (Excel)
</div><span class="badge bg-secondary rounded-pill"><i class="bi bi-download"></i></span></a></div></div></div></div></div></div></div><div class="row"><div class="col-md-12"><div class="card"><div class="card-header bg-primary text-white"><h5 class="mb-0"><i class="bi bi-list-columns-reverse me-2"></i>Detailed Changes</h5></div><div class="card-body"><ul class="nav nav-tabs" id="changesTabs" role="tablist"><li class="nav-item" role="presentation"><button class="nav-link active" id="changed-tab" data-bs-toggle="tab" data-bs-target="#changed" type="button" role="tab" aria-controls="changed" aria-selected="true">
Changed Rows <span class="badge bg-info ms-1">{{ comparison.changed_rows|length }}</span></button></li><li class="nav-item" role="presentation"><button class="nav-link" id="added-tab" data-bs-toggle="tab" data-bs-target="#added" type="button" role="tab" aria-controls="added" aria-selected="false">
Added Rows <span class="badge bg-success ms-1">{{ comparison.added_rows|length }}</span></button></li><li class="nav-item" role="presentation"><button class="nav-link" id="removed-tab" data-bs-toggle="tab" data-bs-target="#removed" type="button" role="tab" aria-controls="removed" aria-selected="false">
Removed Rows <span class="badge bg-danger ms-1">{{ comparison.removed_rows|length }}</span></button></li></ul><div class="tab-content report-view-content" id="changesTabsContent"><div class="tab-pane fade show active" id="changed" role="tabpanel" aria-labelledby="changed-tab">
{% if comparison.changed_rows %}
<div class="table-responsive mt-3 pm-table"><table class="table table-striped table-dark"><thead><tr><th>Division</th><th>Job</th><th>Asset ID</th><th>Equipment</th><th>Changes</th></tr></thead><tbody>
{% for row in comparison.changed_rows %}
<tr><td>{{ row.div }}</td><td>{{ row.job }}</td><td>{{ row.asset_id }}</td><td>{{ row.equipment }}</td><td>
{% for change in row.changes %}
<div class="mb-2"><span class="field-label">{{ change.field }}:</span><br><span class="original-value">{{ change.original }}</span> â†’
<span class="updated-value">{{ change.updated }}</span></div>
{% endfor %}
</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="alert alert-info mt-3"><i class="bi bi-info-circle me-2"></i> No changed rows found.
</div>
{% endif %}
</div><div class="tab-pane fade" id="added" role="tabpanel" aria-labelledby="added-tab">
{% if comparison.added_rows %}
<div class="table-responsive mt-3 pm-table"><table class="table table-striped table-dark"><thead><tr><th>Division</th><th>Job</th><th>Asset ID</th><th>Equipment</th><th>Driver</th><th>Allocation</th><th>Cost Code</th><th>Revision</th></tr></thead><tbody>
{% for row in comparison.added_rows %}
<tr class="added-row"><td>{{ row.div }}</td><td>{{ row.job }}</td><td>{{ row.asset_id }}</td><td>{{ row.equipment }}</td><td>{{ row.driver }}</td><td>{{ row.allocation }}</td><td>{{ row.cost_code }}</td><td>{{ row.revision_amount }}</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="alert alert-info mt-3"><i class="bi bi-info-circle me-2"></i> No added rows found.
</div>
{% endif %}
</div><div class="tab-pane fade" id="removed" role="tabpanel" aria-labelledby="removed-tab">
{% if comparison.removed_rows %}
<div class="table-responsive mt-3 pm-table"><table class="table table-striped table-dark"><thead><tr><th>Division</th><th>Job</th><th>Asset ID</th><th>Equipment</th><th>Driver</th><th>Allocation</th><th>Cost Code</th><th>Amount</th></tr></thead><tbody>
{% for row in comparison.removed_rows %}
<tr class="removed-row"><td>{{ row.div }}</td><td>{{ row.job }}</td><td>{{ row.asset_id }}</td><td>{{ row.equipment }}</td><td>{{ row.driver }}</td><td>{{ row.allocation }}</td><td>{{ row.cost_code }}</td><td>{{ row.allocation_amount }}</td></tr>
{% endfor %}
</tbody></table></div>
{% else %}
<div class="alert alert-info mt-3"><i class="bi bi-info-circle me-2"></i> No removed rows found.
</div>
{% endif %}
</div></div></div></div></div></div><div class="row mt-4"><div class="col-md-12 text-center"><a href="{{ url_for('reports.pm_allocation') }}" class="btn btn-secondary me-2"><i class="bi bi-arrow-left me-2"></i>Back to PM Allocation
</a><a href="{{ url_for('reports.generate_region_exports', month=result.month) }}" class="btn btn-primary"><i class="bi bi-arrow-repeat me-2"></i>Regenerate Exports
</a></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script></body></html>
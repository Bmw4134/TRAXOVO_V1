<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>TRAXORA - Work Zone Hours Validation Detail</title><link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><style>
.validation-card {
border-radius: 15px;
border: none;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
transition: transform 0.3s ease;
}

.validation-card:hover {
transform: translateY(-5px);
}

.metric-large {
font-size: 2.5rem;
font-weight: bold;
}

.discrepancy-alert {
background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
color: white;
border-radius: 10px;
padding: 1rem;
margin-bottom: 1rem;
}

.validation-pass {
background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
color: white;
border-radius: 10px;
padding: 1rem;
margin-bottom: 1rem;
}

.hours-comparison {
background: #f8f9fa;
border-radius: 8px;
padding: 1rem;
margin-bottom: 1rem;
}

.variance-bar {
height: 20px;
background: #e9ecef;
border-radius: 10px;
overflow: hidden;
position: relative;
}

.variance-fill {
height: 100%;
border-radius: 10px;
transition: width 0.5s ease;
}

.hours-badge {
display: inline-block;
padding: 0.5rem 1rem;
border-radius: 20px;
font-weight: bold;
margin: 0.25rem;
}

.driver-detail-card {
cursor: pointer;
transition: all 0.3s ease;
}

.driver-detail-card:hover {
box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}
</style></head><body><div class="container-fluid mt-4"><div class="row mb-4"><div class="col-12"><div class="d-flex justify-content-between align-items-center"><div><h2><i class="fas fa-clipboard-check"></i> Work Zone Hours Validation</h2><p class="text-muted">GPS tracking vs timecard vs payroll validation for {{ site_name or 'All Sites' }}</p></div><div class="d-flex gap-2"><a href="/work-zone" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i> Back to Dashboard
</a><button class="btn btn-primary" onclick="exportValidationReport()"><i class="fas fa-file-export"></i> Export Report
</button></div></div></div></div><div class="row mb-4"><div class="col-lg-3 col-md-6 mb-3"><div class="card validation-card bg-primary text-white"><div class="card-body text-center py-4"><i class="fas fa-satellite-dish fa-3x mb-3"></i><div class="metric-large">{{ validation_data.gps_total_hours }}</div><div>GPS Tracked Hours</div><small>Company vehicle time on site</small></div></div></div><div class="col-lg-3 col-md-6 mb-3"><div class="card validation-card bg-info text-white"><div class="card-body text-center py-4"><i class="fas fa-clock fa-3x mb-3"></i><div class="metric-large">{{ validation_data.timecard_total_hours }}</div><div>Timecard Hours</div><small>Employee logged hours</small></div></div></div><div class="col-lg-3 col-md-6 mb-3"><div class="card validation-card bg-success text-white"><div class="card-body text-center py-4"><i class="fas fa-dollar-sign fa-3x mb-3"></i><div class="metric-large">{{ validation_data.payroll_total_hours }}</div><div>Payroll Hours</div><small>Paid hours</small></div></div></div><div class="col-lg-3 col-md-6 mb-3"><div class="card validation-card
{% if validation_data.validation_rate >= 90 %}bg-success
{% elif validation_data.validation_rate >= 75 %}bg-warning
{% else %}bg-danger{% endif %} text-white"><div class="card-body text-center py-4"><i class="fas fa-check-circle fa-3x mb-3"></i><div class="metric-large">{{ validation_data.validation_rate }}%</div><div>Validation Rate</div><small>{{ validation_data.discrepancy_count }} discrepancies</small></div></div></div></div><div class="row mb-4"><div class="col-lg-6 mb-3"><div class="card"><div class="card-header"><h5><i class="fas fa-chart-bar"></i> GPS vs Timecard Variance</h5></div><div class="card-body"><div class="hours-comparison"><div class="d-flex justify-content-between mb-3"><span class="hours-badge bg-primary text-white">
GPS: {{ validation_data.gps_total_hours }} hrs
</span><span class="hours-badge bg-info text-white">
Timecard: {{ validation_data.timecard_total_hours }} hrs
</span></div><div class="variance-bar mb-2"><div class="variance-fill
{% if validation_data.variance_gps_timecard <= 5 %}bg-success
{% elif validation_data.variance_gps_timecard <= 15 %}bg-warning
{% else %}bg-danger{% endif %}"
style="width: {{ (validation_data.variance_gps_timecard / 50) * 100 }}%"></div></div><div class="text-center"><strong>Variance: {{ validation_data.variance_gps_timecard }} hours</strong></div></div></div></div></div><div class="col-lg-6 mb-3"><div class="card"><div class="card-header"><h5><i class="fas fa-chart-bar"></i> Timecard vs Payroll Variance</h5></div><div class="card-body"><div class="hours-comparison"><div class="d-flex justify-content-between mb-3"><span class="hours-badge bg-info text-white">
Timecard: {{ validation_data.timecard_total_hours }} hrs
</span><span class="hours-badge bg-success text-white">
Payroll: {{ validation_data.payroll_total_hours }} hrs
</span></div><div class="variance-bar mb-2"><div class="variance-fill
{% if validation_data.variance_timecard_payroll <= 2 %}bg-success
{% elif validation_data.variance_timecard_payroll <= 8 %}bg-warning
{% else %}bg-danger{% endif %}"
style="width: {{ (validation_data.variance_timecard_payroll / 25) * 100 }}%"></div></div><div class="text-center"><strong>Variance: {{ validation_data.variance_timecard_payroll }} hours</strong></div></div></div></div></div></div>


{% if validation_data.driver_discrepancies %}
<div class="row mb-4"><div class="col-12"><div class="card"><div class="card-header"><h5><i class="fas fa-exclamation-triangle"></i> Driver Discrepancy Details</h5><small class="text-muted">Drivers with significant variance between GPS, timecard, and payroll hours</small></div><div class="card-body">
{% for discrepancy in validation_data.driver_discrepancies %}
<div class="driver-detail-card card mb-3" onclick="toggleDiscrepancyDetails('{{ loop.index }}')"><div class="card-body"><div class="row align-items-center"><div class="col-md-3"><h6 class="mb-1">{{ discrepancy.driver_name }}</h6><small class="text-muted">{{ discrepancy.days_worked }} days worked</small></div><div class="col-md-3"><div class="text-center"><div class="h6 mb-0">{{ discrepancy.total_gps_hours }} hrs</div><small class="text-muted">GPS Tracked</small></div></div><div class="col-md-3"><div class="text-center"><div class="h6 mb-0">{{ discrepancy.total_timecard_hours }} hrs</div><small class="text-muted">Timecard</small></div></div><div class="col-md-3"><div class="text-center"><div class="h6 mb-0">{{ discrepancy.total_payroll_hours }} hrs</div><small class="text-muted">Payroll</small></div></div></div><div id="details-{{ loop.index }}" class="mt-3" style="display: none;"><hr><h6>Daily Breakdown:</h6><div class="table-responsive"><table class="table table-sm"><thead><tr><th>Date</th><th>GPS Hours</th><th>Timecard Hours</th><th>Payroll Hours</th><th>Status</th><th>Job Site</th><th>Variance</th></tr></thead><tbody>
{% for detail in discrepancy.discrepancies %}
<tr><td>{{ detail.date }}</td><td>{{ detail.gps_hours }}</td><td>{{ detail.timecard_hours }}</td><td>{{ detail.payroll_hours }}</td><td><span class="badge
{% if detail.status == 'On Time' %}bg-success
{% elif detail.status == 'Late Start' %}bg-warning
{% elif detail.status == 'Early End' %}bg-warning
{% else %}bg-danger{% endif %}">
{{ detail.status }}
</span></td><td>{{ detail.job_site }}</td><td>
{% if detail.gps_timecard_variance > 0.5 %}
<span class="text-danger"><i class="fas fa-exclamation-triangle"></i>
{{ detail.gps_timecard_variance }}h GPS/TC
</span>
{% endif %}
{% if detail.timecard_payroll_variance > 0.5 %}
<span class="text-warning"><i class="fas fa-exclamation-circle"></i>
{{ detail.timecard_payroll_variance }}h TC/PR
</span>
{% endif %}
</td></tr>
{% endfor %}
</tbody></table></div></div></div></div>
{% endfor %}
</div></div></div></div>
{% else %}
<div class="row mb-4"><div class="col-12"><div class="validation-pass"><div class="text-center"><i class="fas fa-check-circle fa-3x mb-3"></i><h4>Validation Passed</h4><p class="mb-0">All GPS tracked hours align with timecard and payroll records. No significant discrepancies found.</p></div></div></div></div>
{% endif %}


<div class="row mb-4"><div class="col-12"><div class="card"><div class="card-header"><h5><i class="fas fa-building"></i> Site Validation Summary</h5></div><div class="card-body"><div class="table-responsive"><table class="table table-hover"><thead><tr><th><i class="fas fa-map-marker-alt"></i> Job Site</th><th><i class="fas fa-satellite-dish"></i> GPS Hours</th><th><i class="fas fa-clock"></i> Timecard Hours</th><th><i class="fas fa-dollar-sign"></i> Payroll Hours</th><th><i class="fas fa-users"></i> Driver Count</th><th><i class="fas fa-check-circle"></i> Validation Rate</th></tr></thead><tbody>
{% for site, data in validation_data.site_utilization.items() %}
<tr><td>{{ site }}</td><td>{{ data.gps_hours }}</td><td>{{ data.timecard_hours }}</td><td>{{ data.payroll_hours }}</td><td><span class="badge bg-primary">{{ data.driver_count }}</span></td><td><div class="d-flex align-items-center"><div class="variance-bar me-2" style="width: 80px; height: 8px;"><div class="variance-fill
{% if data.validation_rate >= 95 %}bg-success
{% elif data.validation_rate >= 85 %}bg-warning
{% else %}bg-danger{% endif %}"
style="width: {{ data.validation_rate }}%"></div></div>
{{ data.validation_rate }}%
</div></td></tr>
{% endfor %}
</tbody></table></div></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script><script>
function toggleDiscrepancyDetails(index) {
const details = document.getElementById(`details-${index}`);
if (details.style.display === 'none') {
details.style.display = 'block';
} else {
details.style.display = 'none';
}
}

function exportValidationReport() {
// Generate validation report export
const reportData = {
timestamp: new Date().toISOString(),
site_name: '{{ site_name or "All Sites" }}',
validation_summary: {
gps_hours: {{ validation_data.gps_total_hours }},
timecard_hours: {{ validation_data.timecard_total_hours }},
payroll_hours: {{ validation_data.payroll_total_hours }},
validation_rate: {{ validation_data.validation_rate }},
discrepancy_count: {{ validation_data.discrepancy_count }}
}
};

// Download as JSON
const blob = new Blob([JSON.stringify(reportData, null, 2)], {type: 'application/json'});
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `work_zone_validation_${new Date().toISOString().split('T')[0]}.json`;
a.click();
}
</script></body></html>